{
  "title": "ファーストビューからはみ出した部分だけ、touch*イベントが発火しない",
  "html": "<p>記事らしいものではないんですけど、<br />\n書いておかないと忘れそう<br />\n+<br />\nそのうちなんかの足しになればいいなと思ったのでメモ。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>発生した機種</h3>\n    <p>Android4.0 GalaxyS3(SC-06D) 標準ブラウザで確認。</p>\n\n</div>\n<div class=\"section\">\n    <h3>どんなページ</h3>\n    <p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Twitter\">Twitter</a>のタイムラインのような、なんでもないリストビューのページ。<br />\nで、そのリストをタップすると詳細画面に遷移して・・っていう。</p>\n\n</div>\n<div class=\"section\">\n    <h3>コードでみる</h3>\n    <p>Marionetteです。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synComment\">/**</span>\n<span class=\"synComment\"> * ul</span>\n<span class=\"synComment\"> *   li.list</span>\n<span class=\"synComment\"> *     img.thumb</span>\n<span class=\"synComment\"> *     div</span>\n<span class=\"synComment\"> *       span.name</span>\n<span class=\"synComment\"> *   li</span>\n<span class=\"synComment\"> *   li</span>\n<span class=\"synComment\"> *</span>\n<span class=\"synComment\"> * って感じのHTMLで。CollectionViewじゃないのには深い理由があるので割愛</span>\n<span class=\"synComment\"> */</span>\n<span class=\"synIdentifier\">var</span> SampleTimelineView = Marionette.ItemView.extend(<span class=\"synIdentifier\">{</span>\n  ui: <span class=\"synIdentifier\">{</span>\n    list:  <span class=\"synConstant\">'.list'</span>,\n    thumb: <span class=\"synConstant\">'.thumb'</span>,\n    name:  <span class=\"synConstant\">'.name'</span>\n  <span class=\"synIdentifier\">}</span>,\n  events: <span class=\"synIdentifier\">{</span>\n    <span class=\"synConstant\">'tap @ui.list'</span>:  <span class=\"synConstant\">'_showPostDetail'</span>,\n    <span class=\"synConstant\">'tap @ui.thumb'</span>: <span class=\"synConstant\">'_showUserDetail'</span>,\n    <span class=\"synConstant\">'tap @ui.name'</span>:  <span class=\"synConstant\">'_showUserDetail'</span>\n  <span class=\"synIdentifier\">}</span>,\n  <span class=\"synComment\">// ...</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>tapイベントは、それ用のライブラリを入れてて、<br />\ntouchstart->touchendで何かとよしなに判別してtapイベントを発火してくれるやつです。</p>\n\n</div>\n<div class=\"section\">\n    <h3>そして事件は起きる</h3>\n    <p>ファーストビューから見きれた部分に対して、イベントが発火しない。<br />\nファーストビューに収まってる部分は、問題なくイベント発火して動く。</p>\n\n<div class=\"section\">\n    <h4>仮説1: tapイベントが悪い</h4>\n    <p>たしかに、tapではなくclickイベントでやると動く。</p><p>ならtapの実装に問題がある・・？<br />\n他のとこではまったく問題なく動いてるけど・・。</p>\n\n</div>\n<div class=\"section\">\n    <h4>仮説2: touchstartが死んでる</h4>\n    <p>tapをやめればいいだけなら、clickじゃなくて単にtouchstartでも動くはずよね、と思い試す。<br />\nでもダメ。</p><p>そこでこんな記事を見つける。<br />\n関係ないけどしばし絶望する。</p>\n\n    <blockquote>\n        <p><a href=\"http://stackoverflow.com/questions/11390902/webview-in-ics-touch-events-not-being-fired-properly\" target=\"_blank\" title=\"android 4.0 - WebView in ICS touch events not being fired properly - Stack Overflow\">android 4.0 - WebView in ICS touch events not being fired properly - Stack Overflow</a></p>\n\n    </blockquote>\n<p>そんなことありえんのか・・。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>そして突然なおる</h3>\n    <p>ほんと偶然なんですけど、以下のコードで動くように。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> SampleTimelineView = Marionette.ItemView.extend(<span class=\"synIdentifier\">{</span>\n  events: <span class=\"synIdentifier\">{</span>\n    <span class=\"synComment\">//...</span>\n\n    <span class=\"synComment\">// まさかの何もしない関数をはさむとなおる</span>\n    <span class=\"synConstant\">'touchstart'</span>: <span class=\"synConstant\">'_noop'</span>\n  <span class=\"synIdentifier\">}</span>,\n  _noop: <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{}</span>\n  <span class=\"synComment\">// ...</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>そう、何もしない関数をかませただけ。</p><p>いままでうんともすんとも言わなかったtapイベント。<br />\nそんな彼が元気に動き回る姿がそこにはありました！<br />\n感動！</p><p>意味わからん！</p>\n\n</div>\n<div class=\"section\">\n    <h3>真面目に考えてみる</h3>\n    \n<div class=\"section\">\n    <h4>ファーストビューというか</h4>\n    <p>このView、実はposition: absoluteで、その親要素のheight: 100%の高さと実際のコンテンツの高さが違う。<br />\nそこで何かあるとか？</p><p>でもclickで動くなら関係ないと思うし・・。</p>\n\n</div>\n<div class=\"section\">\n    <h4>touch*イベント</h4>\n    <p>2013年10月に勧告なこいつ。</p>\n\n    <blockquote>\n        <p><a href=\"http://www.w3.org/blog/news/archives/3309\" target=\"_blank\" title=\"Touch Events is a W3C Recommendation | W3C News\">Touch Events is a W3C Recommendation | W3C News</a><br />\n<a href=\"http://www.w3.org/TR/2013/REC-touch-events-20131010/\" target=\"_blank\" title=\"Touch Events\">Touch Events</a></p>\n\n    </blockquote>\n<p>そしてこの端末の発売は2012年6月。</p><p>なんか実装がバグってんのでは！<br />\nどうなんですかサム○ンさん！</p><p>でもなら要素全体をtouchstartで動くようになる理由に一歩足りないような・・。</p>\n\n</div>\n<div class=\"section\">\n    <h4>空関数になんかある</h4>\n    <p>空の関数をバインドすると何か内部的に動作変わるとかないんかね？<br />\n<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%D9%A5%F3%A5%C8%A5%CF%A5%F3%A5%C9%A5%E9\">イベントハンドラ</a>の優先度がどうにかなるとか！</p>\n\n</div>\n<div class=\"section\">\n    <h4>答えは闇の中</h4>\n    <p>やー(モバイル)フロントエンド楽しくて泣きそう。</p>\n\n</div>\n</div>"
}
