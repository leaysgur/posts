{
  "title": "最小構成でSocket.IOを試すサンプル",
  "html": "<p>Nodeの勉強の足がかりとして、ぜひとも一緒に使いたいSocket.IOを勉強中。</p><p>Websocketの存在は知ってるものの、実際に何ができそうとかアイデアレベルに達するほどの知識はなかったんですよね。<br />\nというわけで、まずは最小構成からどんなものかをチェックチェック。</p>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>準備</h3>\n    <p>Nodeはインストール済という前提で。</p>\n<pre class=\"code\" data-unlink>mkdir socketio &amp;&amp; cd socketio\nnpm install socket.io\n\ntouch index.html app.js</pre>\n<div class=\"section\">\n    <h4>index.html</h4>\n    <pre class=\"code\" data-unlink><span class=\"synComment\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">html</span><span class=\"synIdentifier\"> </span><span class=\"synType\">lang</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;ja&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">head</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">charset</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;UTF-8&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">title</span><span class=\"synIdentifier\">&gt;</span>Hello SocketIO<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">title</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">name</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;viewport&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">content</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">name</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;format-detection&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">content</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;telephone=no&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">head</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">body</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">input</span><span class=\"synIdentifier\"> </span><span class=\"synType\">type</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;text&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;msg&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">value</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;Hello from Client!&quot;</span><span class=\"synIdentifier\"> /&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;send&quot;</span><span class=\"synIdentifier\">&gt;</span>Send!<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\"> </span><span class=\"synType\">src</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;/socket.io/socket.io.js&quot;</span><span class=\"synIdentifier\">&gt;&lt;/</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synComment\">// Client side.</span>\n<span class=\"synSpecial\">;</span>(<span class=\"synIdentifier\">function</span>(<span class=\"synSpecial\">io, doc</span>)<span class=\"synIdentifier\">{</span>\n<span class=\"synSpecial\">\t</span><span class=\"synIdentifier\">var</span><span class=\"synSpecial\"> msg = doc.getElementById</span>(<span class=\"synConstant\">'msg'</span>)<span class=\"synSpecial\">,</span>\n<span class=\"synSpecial\">\tsendBtn = doc.getElementById</span>(<span class=\"synConstant\">'send'</span>)<span class=\"synSpecial\">;</span>\n<span class=\"synSpecial\">\tsendBtn.addEventListener</span>(<span class=\"synConstant\">'click'</span><span class=\"synSpecial\">, emit, </span><span class=\"synConstant\">false</span>)<span class=\"synSpecial\">;</span>\n\n<span class=\"synComment\">///////////////////////////////////////////////////////////</span>\n<span class=\"synComment\">// こっからが本題</span>\n\n<span class=\"synSpecial\">\t</span><span class=\"synIdentifier\">var</span><span class=\"synSpecial\"> socket = io.connect</span>(<span class=\"synConstant\">'http://{NodeをインストールしたサーバーのIPなど}'</span>)<span class=\"synSpecial\">;</span>\n<span class=\"synSpecial\">\t</span>\n<span class=\"synSpecial\">\tsocket.on</span>(<span class=\"synConstant\">'myFitstRecieving'</span><span class=\"synSpecial\">, </span><span class=\"synIdentifier\">function</span><span class=\"synSpecial\"> </span>(<span class=\"synSpecial\">data</span>)<span class=\"synSpecial\"> </span><span class=\"synIdentifier\">{</span>\n<span class=\"synSpecial\">\t\tconsole.log</span>(<span class=\"synSpecial\">data</span>)<span class=\"synSpecial\">;</span>\n<span class=\"synSpecial\">\t</span><span class=\"synIdentifier\">}</span>)<span class=\"synSpecial\">;</span>\n\n<span class=\"synSpecial\">\t</span><span class=\"synIdentifier\">function</span><span class=\"synSpecial\"> emit</span>()<span class=\"synIdentifier\">{</span>\n<span class=\"synSpecial\">\t\tsocket.emit</span>(<span class=\"synConstant\">'myFirstSending'</span><span class=\"synSpecial\">, </span><span class=\"synIdentifier\">{</span>\n<span class=\"synSpecial\">\t\t\tmsg: msg.value</span>\n<span class=\"synSpecial\">\t\t</span><span class=\"synIdentifier\">}</span>)<span class=\"synSpecial\">;</span>\n<span class=\"synSpecial\">\t</span><span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>(<span class=\"synSpecial\">io, </span><span class=\"synStatement\">document</span>))<span class=\"synSpecial\">;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">body</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">html</span><span class=\"synIdentifier\">&gt;</span>\n</pre><p>{NodeをインストールしたサーバーのIPなど}ってなってるとこは、ご自身の環境のIP・URLを。</p>\n\n</div>\n<div class=\"section\">\n    <h4>app.js</h4>\n    <pre class=\"code\" data-unlink><span class=\"synComment\">// Server side.</span>\n<span class=\"synIdentifier\">var</span> app = require(<span class=\"synConstant\">'http'</span>).createServer(handler),\nio = require(<span class=\"synConstant\">'socket.io'</span>).listen(app),\nfs = require(<span class=\"synConstant\">'fs'</span>);\napp.listen(9999);\n\n<span class=\"synIdentifier\">function</span> handler(req, res) <span class=\"synIdentifier\">{</span>\n\tfs.readFile(__dirname + <span class=\"synConstant\">'/index.html'</span>, <span class=\"synIdentifier\">function</span>(err, data) <span class=\"synIdentifier\">{</span>\n\t\t<span class=\"synStatement\">if</span> (err) <span class=\"synIdentifier\">{</span>\n\t\t\tres.writeHead(500);\n\t\t\t<span class=\"synStatement\">return</span> res.end(<span class=\"synConstant\">'Error loading index.html'</span>);\n\t\t<span class=\"synIdentifier\">}</span>\n\t\tres.writeHead(200);\n\t\tres.end(data);\n\t<span class=\"synIdentifier\">}</span>);\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synComment\">///////////////////////////////////////////////////////////</span>\n<span class=\"synComment\">// こっからが本題</span>\n\nio.sockets.on(<span class=\"synConstant\">'connection'</span>, <span class=\"synIdentifier\">function</span>(socket) <span class=\"synIdentifier\">{</span>\n\tsocket.emit(<span class=\"synConstant\">'myFitstRecieving'</span>, <span class=\"synIdentifier\">{</span>\n\t\tmsg: <span class=\"synConstant\">'Hello from Server!'</span>,\n\t\t<span class=\"synStatement\">status</span>: <span class=\"synConstant\">'Connected.'</span>\n\t<span class=\"synIdentifier\">}</span>);\n\n\tsocket.on(<span class=\"synConstant\">'myFirstSending'</span>, <span class=\"synIdentifier\">function</span>(data) <span class=\"synIdentifier\">{</span>\n\t\tconsole.log(<span class=\"synConstant\">'From client: '</span> + data.msg);\n\t<span class=\"synIdentifier\">}</span>);\n<span class=\"synIdentifier\">}</span>);\n</pre><p>app.listen(9999) ってなってるとこは、ご自身の環境のお好きなポート番号を。</p><p>そして起動！</p>\n<pre class=\"code\" data-unlink>node app.js</pre>\n</div>\n</div>\n<div class=\"section\">\n    <h3>emit → on</h3>\n    <p>サーバーからでもクライアントからでも、emitしたものをonするようになってます。<br />\n正確にはonで待ち受けてるところにemitかな？</p><p>その際、イベント名をきめてやり取りする。<br />\nこの例でいうところの</p>\n<pre class=\"code\" data-unlink><span class=\"synComment\">// Server side.</span>\nsocket.on(<span class=\"synConstant\">'myFirstSending'</span>, <span class=\"synIdentifier\">function</span>(data) <span class=\"synIdentifier\">{</span>\n\tconsole.log(<span class=\"synConstant\">'From client: '</span> + data.msg);\n<span class=\"synIdentifier\">}</span>);\n</pre><p>と</p>\n<pre class=\"code\" data-unlink><span class=\"synComment\">// Client side.</span>\nsocket.emit(<span class=\"synConstant\">'myFirstSending'</span>, <span class=\"synIdentifier\">{</span>\n\tmsg: msg.value\n<span class=\"synIdentifier\">}</span>);\n</pre><p>がセット。</p>\n\n</div>\n<div class=\"section\">\n    <h3>どんな動きになるか</h3>\n    <p>接続した瞬間に、サーバー側から通信があって、クライアント側：ブラウザのコンソールに受信があるはずです。</p><p>そして、</p><p>ブラウザでSendボタンを連打すると、テキストフィールドの内容がサーバー側のコンソールに流れ込むはず・・！</p><p>なんかそれっぽい！</p>\n\n</div>\n<div class=\"section\">\n    <h3>まだ序の口</h3>\n    <p>とはいえThe Websocketっぽい要素はまだまだ先にあります。<br />\nbroadcastとか、namespaceとか。</p><p>それも追って試して記事にするつもりですです。</p><p>日本語の記事はまだそんなに多くなかったので、もっと増えるといいなぁ。(例のごとくめっちゃレベル高い記事はあるけど、入門系があまりに少ない)</p>\n\n    <blockquote>\n        <p>参考：<a href=\"https://github.com/LearnBoost/socket.io\" target=\"_blank\" title=\"LearnBoost/socket.io · GitHub\">LearnBoost/socket.io · GitHub</a></p>\n\n    </blockquote>\n\n</div>\n</div>"
}
