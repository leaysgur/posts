{
  "title": "NodeとSocket.IOで作るルーム機能つきチャットのサンプル",
  "html": "<p>というわけで、最近勉強してたSocket.IOでサンプルを作りました。<br />\nこのソースをまるごと持って行ってIPなりポートなり調整すれば動くはずです。</p><p>おかげでロジック自体はシンプルになったけど、使い勝手云々いじると必然的にクライアント側のコードが多く・・。<br />\n今回は久しぶりにjQueryも使ってます。</p>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>仕様</h3>\n    \n<ul>\n<li>部屋とニックネームを決めて入室し、その部屋でリアルタイムチャット</li>\n<li>違う部屋の内容は見れない</li>\n<li>エンターキーでPOSTできる</li>\n<li>一回入った部屋を出て、違う部屋に入れる</li>\n<li>スマートフォンでもキレイに見れる</li>\n<li>システムメッセージとユーザーのメッセージは住み分ける</li>\n</ul><p>などなど。</p>\n\n</div>\n<div class=\"section\">\n    <h3>ソース</h3>\n    \n<div class=\"section\">\n    <h4>Html</h4>\n    <pre class=\"code lang-html\" data-lang=\"html\" data-unlink><span class=\"synComment\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">html</span><span class=\"synIdentifier\"> </span><span class=\"synType\">lang</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;en&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">head</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">charset</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;UTF-8&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">name</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;viewport&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">content</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">meta</span><span class=\"synIdentifier\"> </span><span class=\"synType\">name</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;format-detection&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">content</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;telephone=no&quot;</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">title</span><span class=\"synIdentifier\">&gt;</span>Hello Socket.IO<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">title</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">style</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synComment\">/* 後述 */</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">style</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">head</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">body</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;container&quot;</span><span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;</span>header<span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">h1</span><span class=\"synIdentifier\">&gt;</span>Socket IO chat<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">h1</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;leave&quot;</span><span class=\"synIdentifier\">&gt;</span>Leave<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;/</span>header<span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;page1&quot;</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">p</span><span class=\"synIdentifier\">&gt;</span>\n      This is sample of socket.IO chat.<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">br</span><span class=\"synIdentifier\">&gt;</span>\n      Select [Room] and type your [Name].<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">br</span><span class=\"synIdentifier\">&gt;</span>\n      And press [Join] to start!\n    <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">p</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;init&quot;</span><span class=\"synIdentifier\">&gt;</span>\n      <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">label</span><span class=\"synIdentifier\">&gt;</span>\n        <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">span</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;title&quot;</span><span class=\"synIdentifier\">&gt;</span>Room:<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">span</span><span class=\"synIdentifier\">&gt;</span>\n        <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">select</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;room&quot;</span><span class=\"synIdentifier\">&gt;</span>\n          <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\"> </span><span class=\"synType\">value</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;roomA&quot;</span><span class=\"synIdentifier\">&gt;</span>#A<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\">&gt;</span>\n          <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\"> </span><span class=\"synType\">value</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;roomB&quot;</span><span class=\"synIdentifier\">&gt;</span>#B<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\">&gt;</span>\n          <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\"> </span><span class=\"synType\">value</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;roomC&quot;</span><span class=\"synIdentifier\">&gt;</span>#C<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">option</span><span class=\"synIdentifier\">&gt;</span>\n        <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">select</span><span class=\"synIdentifier\">&gt;</span>\n      <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">label</span><span class=\"synIdentifier\">&gt;</span>\n      <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">label</span><span class=\"synIdentifier\">&gt;</span>\n        <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">span</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;title&quot;</span><span class=\"synIdentifier\">&gt;</span>Name:<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">span</span><span class=\"synIdentifier\">&gt;</span> \n        <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">input</span><span class=\"synIdentifier\"> </span><span class=\"synType\">type</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;text&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">value</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;John&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;name&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">maxlength</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;10&quot;</span><span class=\"synIdentifier\">/&gt;</span>\n      <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">label</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;join&quot;</span><span class=\"synIdentifier\">&gt;</span>Join<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">button</span><span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;page2&quot;</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">ul</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;view&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;list&quot;</span><span class=\"synIdentifier\">&gt;&lt;/</span><span class=\"synStatement\">ul</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;msgBox&quot;</span><span class=\"synIdentifier\">&gt;</span>\n      <span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">input</span><span class=\"synIdentifier\"> </span><span class=\"synType\">type</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;text&quot;</span><span class=\"synIdentifier\"> placeholder=</span><span class=\"synConstant\">&quot;Please type messages here.&quot;</span><span class=\"synIdentifier\"> </span><span class=\"synType\">id</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;message&quot;</span><span class=\"synIdentifier\"> /&gt;</span>\n    <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n  <span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\"> </span><span class=\"synType\">src</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;/socket.io/socket.io.js&quot;</span><span class=\"synIdentifier\">&gt;&lt;/</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\"> </span><span class=\"synType\">src</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&quot;</span><span class=\"synIdentifier\">&gt;&lt;/</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synComment\">// 後述</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">script</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">body</span><span class=\"synIdentifier\">&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">html</span><span class=\"synIdentifier\">&gt;</span>\n</pre>\n</div>\n<div class=\"section\">\n    <h4>Css</h4>\n    <pre class=\"code lang-css\" data-lang=\"css\" data-unlink><span class=\"synStatement\">body</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">0</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">0</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synStatement\">p</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">0</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synStatement\">h1</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">position</span>:<span class=\"synType\">fixed</span>;\n  <span class=\"synType\">top</span>:<span class=\"synConstant\">0</span>;\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">0</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">8px</span> <span class=\"synConstant\">0</span>;\n  <span class=\"synType\">width</span>:<span class=\"synConstant\">100%</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">32px</span>;\n  <span class=\"synType\">background</span>:<span class=\"synConstant\">#000</span>;\n  <span class=\"synType\">color</span>:<span class=\"synConstant\">#fff</span>;\n  <span class=\"synType\">text-align</span>:<span class=\"synType\">center</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.2</span>rem;\n  <span class=\"synType\">line-height</span>:<span class=\"synConstant\">32px</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">#leave</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">position</span>:<span class=\"synType\">fixed</span>;\n  <span class=\"synType\">top</span>:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">right</span>:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">3px</span> <span class=\"synConstant\">5px</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">32px</span>;\n  <span class=\"synType\">border</span>-radius:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">background</span>:<span class=\"synConstant\">#165e83</span>;\n  <span class=\"synType\">color</span>:<span class=\"synConstant\">#fff</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">#page1</span>,<span class=\"synIdentifier\">#page2</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin-top</span>:<span class=\"synConstant\">48px</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">#page1</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">8px</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>init <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">16px</span> <span class=\"synType\">auto</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">border</span>:<span class=\"synConstant\">1px</span> <span class=\"synType\">solid</span> <span class=\"synConstant\">#ccc</span>;\n  <span class=\"synType\">background</span>:<span class=\"synConstant\">#eee</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>init <span class=\"synSpecial\">&gt;</span> <span class=\"synStatement\">label</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">display</span>:<span class=\"synType\">block</span>;\n  <span class=\"synType\">margin-bottom</span>:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">44px</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.4</span>rem;\n  <span class=\"synType\">line-height</span>:<span class=\"synConstant\">44px</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>init <span class=\"synSpecial\">&gt;</span> <span class=\"synStatement\">label</span> <span class=\"synSpecial\">&gt;</span> <span class=\"synSpecial\">.</span><span class=\"synStatement\">title</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">display</span>:<span class=\"synType\">inline</span>-<span class=\"synType\">block</span>;\n  <span class=\"synType\">width</span>:<span class=\"synConstant\">30%</span>;\n  <span class=\"synType\">color</span>:<span class=\"synConstant\">#aaa</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>init <span class=\"synSpecial\">&gt;</span> <span class=\"synStatement\">label</span> <span class=\"synSpecial\">&gt;</span> <span class=\"synStatement\">input</span><span class=\"synSpecial\">[</span>type<span class=\"synSpecial\">=</span><span class=\"synConstant\">&quot;text&quot;</span><span class=\"synSpecial\">]</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">display</span>:<span class=\"synType\">inline</span>-<span class=\"synType\">block</span>;\n  <span class=\"synType\">width</span>:<span class=\"synConstant\">61%</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">38px</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.2</span>rem;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">#page1</span> <span class=\"synSpecial\">&gt;</span> <span class=\"synStatement\">button</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">display</span>:<span class=\"synType\">block</span>;\n  box-sizing:<span class=\"synType\">border</span>-box;\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">0</span> <span class=\"synType\">auto</span>;\n  <span class=\"synType\">width</span>:<span class=\"synConstant\">100%</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">44px</span>;\n  <span class=\"synType\">border</span>-radius:<span class=\"synConstant\">4px</span>;\n  <span class=\"synType\">background</span>:<span class=\"synConstant\">#0094c8</span>;\n  <span class=\"synType\">color</span>:<span class=\"synConstant\">#fff</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.5</span>rem;\n  -webkit-appearance:<span class=\"synType\">none</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">#page2</span> <span class=\"synSpecial\">.</span>msgBox <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">8px</span> <span class=\"synType\">auto</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">0</span> <span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">text-align</span>:<span class=\"synType\">center</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>msgBox <span class=\"synStatement\">input</span><span class=\"synSpecial\">[</span>type<span class=\"synSpecial\">=</span><span class=\"synConstant\">&quot;text&quot;</span><span class=\"synSpecial\">]</span> <span class=\"synIdentifier\">{</span>\n  -webkit-box-sizing:<span class=\"synType\">border</span>-box;\n  <span class=\"synType\">width</span>:<span class=\"synConstant\">100%</span>;\n  <span class=\"synType\">height</span>:<span class=\"synConstant\">38px</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.2</span>rem;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>list <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">margin</span>:<span class=\"synConstant\">0</span> <span class=\"synType\">auto</span>;\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">0</span>;\n  <span class=\"synType\">border-top</span>:<span class=\"synConstant\">1px</span> <span class=\"synType\">solid</span> <span class=\"synConstant\">#ccc</span>;\n  <span class=\"synType\">border-bottom</span>:<span class=\"synConstant\">1px</span> <span class=\"synType\">solid</span> <span class=\"synConstant\">#fff</span>;\n  <span class=\"synType\">list-style</span>:<span class=\"synType\">none</span>;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>list <span class=\"synStatement\">li</span> <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">padding</span>:<span class=\"synConstant\">8px</span>;\n  <span class=\"synType\">border-top</span>:<span class=\"synConstant\">1px</span> <span class=\"synConstant\">#fff</span> <span class=\"synType\">solid</span>;\n  <span class=\"synType\">border-bottom</span>:<span class=\"synConstant\">1px</span> <span class=\"synConstant\">#ccc</span> <span class=\"synType\">solid</span>;\n  <span class=\"synType\">font-size</span>:<span class=\"synConstant\">1.1</span>rem;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synSpecial\">.</span>list <span class=\"synStatement\">li</span>:nth-child(even) <span class=\"synIdentifier\">{</span>\n  <span class=\"synType\">background</span>:<span class=\"synConstant\">#eee</span>;\n<span class=\"synIdentifier\">}</span>\n</pre>\n</div>\n<div class=\"section\">\n    <h4>Client side JavaScript</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>$(<span class=\"synIdentifier\">function</span>(io, $) <span class=\"synIdentifier\">{</span>\n  <span class=\"synIdentifier\">var</span> socket = io.connect(<span class=\"synConstant\">'http://localhost/chat'</span>),\n    $html = $(<span class=\"synConstant\">'html,body'</span>),\n    page1 = $(<span class=\"synConstant\">'#page1'</span>),\n    page2 = $(<span class=\"synConstant\">'#page2'</span>).hide(),\n    leaveBtn = $(<span class=\"synConstant\">'#leave'</span>).hide(),\n    roomBox = $(<span class=\"synConstant\">'#room'</span>),\n    nameBox = $(<span class=\"synConstant\">'#name'</span>),\n    joinBtn = $(<span class=\"synConstant\">'#join'</span>),\n    msgBox = $(<span class=\"synConstant\">'#message'</span>),\n    msgList = $(<span class=\"synConstant\">'#view'</span>);\n\n  socket.on(<span class=\"synConstant\">'connected'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    console.log(<span class=\"synConstant\">'[System]Welcome to simple chat!'</span>);\n  <span class=\"synIdentifier\">}</span>);\n\n  joinBtn.on(<span class=\"synConstant\">'click'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> r = roomBox.val();\n    <span class=\"synIdentifier\">var</span> n = nameBox.val();\n    chat(r, n);\n  <span class=\"synIdentifier\">}</span>);\n\n  <span class=\"synIdentifier\">function</span> chat(room, name) <span class=\"synIdentifier\">{</span>\n    socket.json.emit(<span class=\"synConstant\">'init'</span>, <span class=\"synIdentifier\">{</span>\n      <span class=\"synConstant\">'room'</span>: room,\n      <span class=\"synConstant\">'name'</span>: name\n    <span class=\"synIdentifier\">}</span>);\n  <span class=\"synIdentifier\">}</span>\n\n  socket.on(<span class=\"synConstant\">'initialized'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    page1.hide();\n    page2.show();\n    leaveBtn.show();\n  <span class=\"synIdentifier\">}</span>);\n\n  leaveBtn.on(<span class=\"synConstant\">'click'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    socket.emit(<span class=\"synConstant\">'leave'</span>);\n    page2.hide();\n    leaveBtn.hide();\n    page1.show();\n    msgList.empty();\n  <span class=\"synIdentifier\">}</span>);\n\n  <span class=\"synIdentifier\">function</span> send() <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> data = msgBox.val();\n    socket.json.send(data);\n    msgBox.val(<span class=\"synConstant\">''</span>);\n  <span class=\"synIdentifier\">}</span>\n\n  msgBox.focus(<span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    page2.bind(<span class=\"synConstant\">'keypress'</span>, sendByTypeEnter);\n  <span class=\"synIdentifier\">}</span>);\n  msgBox.blur(<span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    page2.unbind(<span class=\"synConstant\">'keypress'</span>, sendByTypeEnter);\n  <span class=\"synIdentifier\">}</span>);\n\n  <span class=\"synIdentifier\">var</span> sendByTypeEnter = <span class=\"synIdentifier\">function</span>(e) <span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">if</span> (e.keyCode === 13) <span class=\"synIdentifier\">{</span>\n      send();\n    <span class=\"synIdentifier\">}</span>\n  <span class=\"synIdentifier\">}</span>;\n\n  <span class=\"synIdentifier\">function</span> update(data, systemFlag) <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> list = $(<span class=\"synConstant\">'&lt;li&gt;'</span>).html(data);\n    <span class=\"synStatement\">if</span> (systemFlag) <span class=\"synIdentifier\">{</span>\n      list.css(<span class=\"synConstant\">'color'</span>, <span class=\"synConstant\">'#aaa'</span>);\n    <span class=\"synIdentifier\">}</span>\n    msgList.append(list);\n    $html.animate(<span class=\"synIdentifier\">{</span>\n      scrollTop: list.offset().<span class=\"synStatement\">top</span>\n    <span class=\"synIdentifier\">}</span>, <span class=\"synConstant\">'fast'</span>);\n  <span class=\"synIdentifier\">}</span>\n\n  socket.on(<span class=\"synConstant\">'message'</span>, <span class=\"synIdentifier\">function</span>(data) <span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">if</span> (data) <span class=\"synIdentifier\">{</span>\n      update(data);\n    <span class=\"synIdentifier\">}</span>\n  <span class=\"synIdentifier\">}</span>);\n  socket.on(<span class=\"synConstant\">'System'</span>, <span class=\"synIdentifier\">function</span>(data) <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> systemFlag = <span class=\"synConstant\">true</span>;\n    <span class=\"synStatement\">if</span> (data) <span class=\"synIdentifier\">{</span>\n      update(data, systemFlag);\n    <span class=\"synIdentifier\">}</span>\n  <span class=\"synIdentifier\">}</span>);\n\n<span class=\"synIdentifier\">}</span>(io, jQuery));\n</pre>\n</div>\n<div class=\"section\">\n    <h4>Server side JavaScript</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> app = require(<span class=\"synConstant\">'http'</span>).createServer(handler),\n  io = require(<span class=\"synConstant\">'socket.io'</span>).listen(app),\n  fs = require(<span class=\"synConstant\">'fs'</span>)\n  app.listen(8080);\n\n<span class=\"synIdentifier\">function</span> handler(req, res) <span class=\"synIdentifier\">{</span>\n  fs.readFile(__dirname + <span class=\"synConstant\">'/index.html'</span>, <span class=\"synIdentifier\">function</span>(err, data) <span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">if</span> (err) <span class=\"synIdentifier\">{</span>\n      res.writeHead(500);\n      <span class=\"synStatement\">return</span> res.end(<span class=\"synConstant\">'Error loading index.html'</span>);\n    <span class=\"synIdentifier\">}</span>\n    res.writeHead(200);\n    res.end(data);\n  <span class=\"synIdentifier\">}</span>);\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">function</span> getRoomAndNameObj(client, obj) <span class=\"synIdentifier\">{</span>\n  client.get(<span class=\"synConstant\">'room'</span>, <span class=\"synIdentifier\">function</span>(err, $room) <span class=\"synIdentifier\">{</span>\n    obj.room = $room;\n  <span class=\"synIdentifier\">}</span>);\n  client.get(<span class=\"synConstant\">'name'</span>, <span class=\"synIdentifier\">function</span>(err, $name) <span class=\"synIdentifier\">{</span>\n    obj.name = $name;\n  <span class=\"synIdentifier\">}</span>);\n  <span class=\"synStatement\">return</span> obj;\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synIdentifier\">var</span> socket = io.of(<span class=\"synConstant\">'/chat'</span>).on(<span class=\"synConstant\">'connection'</span>, <span class=\"synIdentifier\">function</span>(client) <span class=\"synIdentifier\">{</span>\n  client.emit(<span class=\"synConstant\">'connected'</span>);\n\n  client.on(<span class=\"synConstant\">'init'</span>, <span class=\"synIdentifier\">function</span>(req) <span class=\"synIdentifier\">{</span>\n    client.set(<span class=\"synConstant\">'room'</span>, req.room);\n    client.set(<span class=\"synConstant\">'name'</span>, req.name);\n\n    socket.to(req.room).emit(<span class=\"synConstant\">'System'</span>, <span class=\"synConstant\">'['</span> + req.name + <span class=\"synConstant\">'] has come.'</span>);\n    client.emit(<span class=\"synConstant\">'System'</span>, <span class=\"synConstant\">'Join ['</span> + req.room + <span class=\"synConstant\">'] as ['</span> + req.name + <span class=\"synConstant\">']. Enjoy!'</span>);\n    client.join(req.room);\n\n    client.emit(<span class=\"synConstant\">'initialized'</span>);\n  <span class=\"synIdentifier\">}</span>);\n\n  client.on(<span class=\"synConstant\">'message'</span>, <span class=\"synIdentifier\">function</span>(data) <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> obj = <span class=\"synIdentifier\">{}</span>;\n    getRoomAndNameObj(client, obj);\n    socket.to(obj.room).emit(<span class=\"synConstant\">'message'</span>, obj.name + <span class=\"synConstant\">': '</span> + data);\n  <span class=\"synIdentifier\">}</span>);\n\n  client.on(<span class=\"synConstant\">'leave'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> obj = <span class=\"synIdentifier\">{}</span>;\n    getRoomAndNameObj(client, obj);\n    <span class=\"synStatement\">if</span> (obj.name) <span class=\"synIdentifier\">{</span>\n      socket.to(obj.room).emit(<span class=\"synConstant\">'System'</span>, <span class=\"synConstant\">'['</span> + obj.name + <span class=\"synConstant\">'] has left..'</span>);\n    <span class=\"synIdentifier\">}</span>\n    client.leave(obj.room);\n  <span class=\"synIdentifier\">}</span>);\n\n  client.on(<span class=\"synConstant\">'disconnect'</span>, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> obj = <span class=\"synIdentifier\">{}</span>;\n    getRoomAndNameObj(client, obj);\n    <span class=\"synStatement\">if</span> (obj.name) <span class=\"synIdentifier\">{</span>\n      socket.to(obj.room).emit(<span class=\"synConstant\">'System'</span>, <span class=\"synConstant\">'['</span> + obj.name + <span class=\"synConstant\">'] has disconnected..'</span>);\n    <span class=\"synIdentifier\">}</span>\n  <span class=\"synIdentifier\">}</span>);\n<span class=\"synIdentifier\">}</span>);\n</pre><p>いろいろ中途半端なのは突っ込んじゃダメです。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>所感</h3>\n    <p>そもそも最初に検証したかったのは、Socket.IOもといWebsocketでどんなことができそうかを把握することと、3G回線で使い物になるのかという点。</p>\n\n<div class=\"section\">\n    <h4>できそうなこと</h4>\n    <p>やっぱNodeもそうやけど、APIのエンドポイントみたいな使い方がしっくりきそう。<br />\n結局Nodeは単純にサーバーやので、どういう使い方するか・・やけど。</p><p>Httpに代わるWebsocketという意味では、いろいろアイデアが沸いてきました。<br />\nやっぱTwitterのアレとLocationのアレでアレしてみたい。</p>\n\n</div>\n<div class=\"section\">\n    <h4>3Gで</h4>\n    <p>個人的に収穫だと思ったのはこっち。<br />\n一旦コネクションを張るまではやっぱ遅いんですけど、繋いでからは上々かと。<br />\nアップロードはモタつきがあったりSocket.IOさまのお力に頼りまくりですが、ダウンロードは早かったです。</p><p>今回のチャットのサンプルでも、閲覧専用にしてしまえばストレスなくスイスイでした。<br />\nもっと最適化できる部分もあると思いますが、個人的には満足。</p><p>サーバー側でエグい処理をさせて、結果だけを落とすってパターンで何か作ってみようと画策中です。</p><p>PCは？って言われると・・早いけどAjaxとかでも良いんじゃ・・と思ってしまう。<br />\nリアルタイム性は置いておくならば。</p>\n\n</div>\n</div>\n</div>"
}
