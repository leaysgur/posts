{
  "title": "TwitterのAPIのリミット(制限)について勘違いしてたことと、そのまとめ",
  "html": "<p>流行ってますよね、Twitter。<br />\nちょっくらWebサービスでも・・ということで、色々検索してみますが、やはり公式リファレンスにかなうものはありません。<br />\nということで、現時点での最新の内容をまとめておきます。</p><p>どういうものがあるかは過去に書きました。</p>\n\n    <blockquote>\n        <p>過去記事：<a href=\"http://lealog.hateblo.jp/entry/2011/12/12/204848\" target=\"_blank\" title=\"[Twitter][Web]TwitterのAPIについてのメモ\">[Twitter][Web]TwitterのAPIについてのメモ</a></p>\n\n    </blockquote>\n<p>今回は、開発者が気になるリクエストの回数とか、規制とかそういうところを。</p>\n\n    <blockquote>\n        <p>参考：<a href=\"https://dev.twitter.com/docs/rate-limiting\" target=\"_blank\" title=\"Rate Limiting | Twitter Developers\">Rate Limiting | Twitter Developers</a></p>\n\n    </blockquote>\n<p>このページをまるごと意訳してみます。</p>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>APIの制限について</h3>\n    <p>TwitterのAPIから呼べるものには種類があります。</p>\n\n<ul>\n<li>認証が必要なもの</li>\n<li>認証が不要のもの</li>\n</ul><p>それらによって、取得できる内容が違ってきます。<br />\nそりゃもちろん、認証なしにDMとか見れたり、つぶやけたらまずいですもんね、納得。</p><p>ただ区分けはこれだけではなくて、APIの呼び出しに制限：規制がかかってきます。</p>\n\n<ul>\n<li>呼び出し回数に制限があるもの</li>\n<li>呼び出し回数に制限のないもの</li>\n</ul><p>ほとんどのAPIは前者、呼び出し回数に制限があります。<br />\n唯一の後者が、検索APIです。</p>\n\n    <blockquote>\n        <p>参考：<a href=\"https://dev.twitter.com/docs/api/1/get/search\" target=\"_blank\" title=\"GET search | Twitter Developers\">GET search | Twitter Developers</a></p>\n\n    </blockquote>\n<p>※正確には、呼び出し回数での制限がないです。</p><p>検索するキーワードの複雑さ具合によっては、呼び出しに失敗します。</p><p></p>\n\n<div class=\"section\">\n    <h4>肝心の規制について</h4>\n    \n    <blockquote>\n        <p><b>REST API Rate Limiting</b></p><p>The default rate limit for calls to the REST API varies depending on the authorization method being used and whether the method itself requires authentication.</p><p>・Unauthenticated calls are permitted 150 requests per hour. Unauthenticated calls are measured against the public facing IP of the server or device making the request.<br />\n・OAuth calls are permitted 350 requests per hour and are measured against the oauth_token used in the request.</p>\n\n    </blockquote>\n<p>意訳：<br />\nREST APIの呼び出し回数に関する制限は、認証の有無など条件によって変わってくる。<br />\n・認証なし呼び出しの場合は、150回/時間まで。<br />\n　これはリクエストを行ったサーバーのIPでカウントされる。<br />\n・認証あり呼び出しの場合は、350回/時間まで。<br />\n　こっちはリクエストを行ったトークン(認証したユーザー)でのカウントになる。</p><p>認証ありなら350枚、なしなら150枚のチケットをもらえて、それを使っていく、と。<br />\nなくなったらその1時間は遊べません！と。</p>\n\n</div>\n<div class=\"section\">\n    <h4>GET/POST</h4>\n    <p>主に制限つきになっているのは、GETでのAPI取得のもの。<br />\n基本的にPOSTに制限は設けていないが、一部は制限している。<br />\n詳しくは各API仕様を確認。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>Search API</h3>\n    <p>ここがややこしい。</p>\n\n    <blockquote>\n        <p>Some features, such as the GET search method, have additional feature rate limits which are applied in conjunction with the main REST API rate limit. Calls to users/search will count against both the feature and default request rate limit. If either limit is exhausted, the method will fail. You can monitor the status of the feature rate limit by inspecting the HTTP response headers that are returned.</p>\n\n    </blockquote>\n<p>意訳：<br />\nSearch APIなど幾つかのものには、他のREST APIの制限と一緒にカウントされるものもあります。<br />\nユーザー検索APIの場合、それとは別に、通常のREST APIも呼んだとみなされます。<br />\nどっちかのカウントでもなくなると、呼び出しに失敗します。</p><p>つまり・・・？<br />\n基本的な認証なしAPI呼び出しの場合、IP単位で150回/時の呼び出しが可能。<br />\nただ、検索系のAPIは呼び出し回数に制限がないが、呼び出し時にはそのIPが本来もっている150回分のチケットがあるかどうかを確認される。<br />\nもしそのチケットがなかった場合、回数制限のない検索APIといえども失敗する。<br />\n（ってことかしら？多分そう。</p><p>先ほど、検索APIだけは回数制限なしと書きましたが、半分本当で半分嘘でしたね。<br />\nちなみに、users/search APIは、60回/時という制限がついてるそうな。</p>\n\n<div class=\"section\">\n    <h4>Search APIの制限について</h4>\n    \n    <blockquote>\n        <p>Requests to the Search API, hosted on search.twitter.com, do not count towards the REST API limit. However, all requests coming from an IP address are applied to a Search Rate Limit. The Search Rate Limit isn't made public to discourage unnecessary search usage and abuse, but it is higher than the REST Rate Limit. We feel the Search Rate Limit is both liberal and sufficient for most applications and know that many application vendors have found it suitable for their needs.</p>\n\n    </blockquote>\n<p>意訳：<br />\n検索APIは、RESTチケットを使わずに呼び出せます。<br />\nというか、実はTwitterAPIに向かってくるリクエストは全部まとめて数えられてて、実は一定の値で制限してます。<br />\n基本的には青天井と思ってて構わんけど、無駄遣いはやめてほしい。<br />\nまぁ、普通に使う分には困らない回数にしてあるから安心しなさい、と。</p>\n\n</div>\n<div class=\"section\">\n    <h4>他の注意</h4>\n    \n    <blockquote>\n        <p>Search API usage requires that applications include a unique and identifying User Agent string. An HTTP Referrer is expected but is not required. Applications using the Search API but failing to include a User Agent string will receive a lower rate limit.</p>\n\n    </blockquote>\n<p>意訳：<br />\n検索APIといえど、リクエストするときにはUserAgentをつけて欲しい。<br />\nそれがないと、ある場合に比べて少ない回数でも例の青天井リミットに規制されるかもしれません、だそうな。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>その他書いてあること。</h3>\n    \n<ul>\n<li>ホワイトリストは今のところないよ（表向きには</li>\n<li>めっちゃ検索するつもりなら、StreamingAPIを使ってください</li>\n<li>キャッシュするとか、検索クエリに日付を入れて必要な分だけ取得するとか、そういう思いやりが大事</li>\n<li>ブラックリストに入れられるケースはもちろんあるのでお気をつけて。</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3>勘違いって？</h3>\n    <p>SearchAPIだけが認証なしで使い放題、他は全部認証なしじゃ使えない・・って勘違いしてました。</p><p>正確には、<br />\n認証なしでも使えるAPIが他にも沢山ある。<br />\nただ、認証なしの場合は呼び出し元IPが1つに集中するため、150回/時の規制にかかる可能性が高い。<br />\n検索APIだけを使うなら実質使い放題、ただ他のも使う可能性があるなら要注意。</p><p>という感じのメモでした。</p><p><b>※超あとがきですが、英語は苦手でも得意でもない程度なので、間違ってる箇所はビシっとご指摘いただけると大変助かります！</b></p>\n\n</div>\n</div>"
}
