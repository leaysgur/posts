{
  "title": "Slackからのリクエストを正しく検証する",
  "html": "<p>たとえばSlash Commandsを<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/AWS\">AWS</a>で作っていて、そのコマンドからPOSTリク<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A8%A5%B9\">エス</a>トが飛んでくるエンドポイントの実装をしているときの話。</p><p>別に誰に叩かれてもいい<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>なら問題ないけど、ちゃんとSlash Commandsから飛んできたリク<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A8%A5%B9\">エス</a>トであることを判定したい場合がほとんどのはず。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>Deprecated: Verification Tokenを使う</h3>\n    <p>これまで一般的だった、SlackアプリのBasic InformationのページにあるVerification Tokenを使う方法。</p><p>リク<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A8%A5%B9\">エス</a>トボディに入ってる<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A1%BC%A5%AF\">トーク</a>ンと照合するだけのお手軽なやつだった。</p><p>しかしこの方法は、もうすぐ使えなくなるらしい。</p>\n\n    <blockquote>\n        <p>This deprecated Verification Token can still be used to verify that requests come from Slack, but we strongly recommend using the above, more secure, signing secret instead.</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>Signing Secretを使う</h3>\n    <p>こっちが最新のやり方。</p><p>大筋としては、</p>\n\n<ul>\n<li>Basic Informationのページから、シークレットを控えておく\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4\">環境変数</a>とかに入れて使う</li>\n</ul></li>\n<li>リク<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A8%A5%B9\">エス</a>トヘッダとボディを見て、自分でもシークレットを生成する\n<ul>\n<li>ヘッダの<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B7%A5%B0%A5%CD%A5%C1%A5%E3\">シグネチャ</a>とタイムスタンプと、ボディで</li>\n<li>HMAC/SHA256</li>\n</ul></li>\n<li>本物と比較する</li>\n</ul><p>という感じ。</p><p>コードはGistに上げた。</p><p><script src=\"https://gist.github.com/6bcf41d13673954f2abc6fead298fcff.js\"> </script></p><p>これをLambdaとかで使えばよし。</p>\n\n    <blockquote>\n        <p><a href=\"https://api.slack.com/authentication/verifying-requests-from-slack\">Verifying requests from Slack | Slack</a></p>\n\n    </blockquote>\n\n</div>"
}
