{
  "title": "はてなブログで「続きを読む」を実現する",
  "html": "<p>絶賛機能追加中のはてなブログなので、そのうち公式でできるようになるとは思いますが、一応。</p>\n\n    <blockquote>\n        <p>はてな記法なりで「=====」を使って、続きを書いてることが条件です。</p>\n\n    </blockquote>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>続き部分を隠す</h3>\n    <p>最初に続きを隠します。<br />\nパフォーマンス的には隠すというよりかは出力しないようにしたいですが、それはどうにもならんので・・。</p><p>ソースを見てみると、続きはこのようになっています。</p>\n\n<div class=\"section\">\n    <h4>Html</h4>\n    <pre class=\"code lang-html\" data-lang=\"html\" data-unlink>    <span class=\"synComment\">&lt;!-- ヘッダやら --&gt;</span>\n    <span class=\"synComment\">&lt;!-- ここに冒頭の本文 --&gt;</span>\n\n<span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\"> </span><span class=\"synType\">class</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;seemore&quot;</span><span class=\"synIdentifier\">&gt;</span>\n    <span class=\"synComment\">&lt;!-- ここに続きの本文 --&gt;</span>\n<span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">div</span><span class=\"synIdentifier\">&gt;</span>\n\n    <span class=\"synComment\">&lt;!-- フッタやら --&gt;</span>\n</pre><p>というわけで、seemoreってやつがそれです。</p>\n\n</div>\n<div class=\"section\">\n    <h4>JavaScript</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> seemore = $(<span class=\"synConstant\">'body.page-index article.entry div.seemore'</span>).hide();\n</pre><p>bodyタグで現在のページを割り当ててるみたいなので、トップ画面のみで有効になるようにしておきます。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>続きを読むボタンをつける</h3>\n    <p>サイドバーにJavaScriptを自由に書けるようになったので、そこを利用します。<br />\nまたも管理画面のサイドバーから、「HTML」を選択して、以下のように書きます。<br />\nサイドバーはタイトルを空にすることもできるので、目立たずこっそり設置です。</p><p>今回はjQueryを使って書きますが、はてなブログとしても元からjQueryを使ってるみたいなので、新規で呼ぶ必要はないです。<br />\nバージョンは最新じゃなかったですが・・。</p>\n\n<div class=\"section\">\n    <h4>JavaScript</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>(<span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n  <span class=\"synIdentifier\">var</span> seemore = $(<span class=\"synConstant\">'body.page-index article.entry div.seemore'</span>).hide();\n  <span class=\"synIdentifier\">var</span> readmore = $(<span class=\"synConstant\">'&lt;a class=&quot;readmore&quot; href=&quot;#&quot;&gt;続きを読む&lt;/a&gt;'</span>).appendTo(<span class=\"synConstant\">'body.page-index article.entry div.entry-content'</span>);\n  $.each(readmore, <span class=\"synIdentifier\">function</span>()<span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> $<span class=\"synIdentifier\">this</span> = $(<span class=\"synIdentifier\">this</span>);\n    <span class=\"synIdentifier\">var</span> url = $<span class=\"synIdentifier\">this</span>.parents(<span class=\"synConstant\">'article.entry'</span>).find(<span class=\"synConstant\">'a.entry-title-link'</span>).attr(<span class=\"synConstant\">'href'</span>);\n    $<span class=\"synIdentifier\">this</span>.attr(<span class=\"synConstant\">'href'</span>, url);\n  <span class=\"synIdentifier\">}</span>);\n<span class=\"synIdentifier\">}</span>)(jQuery);\n</pre><p>これで、続き以下の本文が消えて、ボタンを押すとそれぞれの記事ページに飛ぶようになります。<br />\nページ内で表示・非表示を切り替えたい場合も同じような要領ですね！</p>\n\n<ol>\n<li>ボタンクリックでseemoreを表示</li>\n<li>押されたボタンは非表示に or もっかい押せるように残す</li>\n</ol><p>みたいな。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>書き直し＠0328</h3>\n    <p>気になるところがあったので、全部書き直しました。<br />\n以下のJavaScriptだけで対応します。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>(<span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n  <span class=\"synIdentifier\">var</span> isDetail = $(<span class=\"synConstant\">'body'</span>).hasClass(<span class=\"synConstant\">'page-entry'</span>);\n  <span class=\"synComment\">// 記事の詳細ページ以外で有効にする</span>\n  <span class=\"synStatement\">if</span>( ! isDetail )<span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">var</span> seemore = $(<span class=\"synConstant\">'article.entry'</span>).find(<span class=\"synConstant\">'div.seemore'</span>).hide();\n    <span class=\"synIdentifier\">var</span> readmore = $(<span class=\"synConstant\">'&lt;a class=&quot;readmore&quot; href=&quot;#&quot;&gt;続きを読む&lt;/a&gt;'</span>).appendTo(<span class=\"synConstant\">'div.entry-content'</span>);\n    $.each(readmore, <span class=\"synIdentifier\">function</span>()<span class=\"synIdentifier\">{</span>\n      <span class=\"synIdentifier\">var</span> $<span class=\"synIdentifier\">this</span> = $(<span class=\"synIdentifier\">this</span>);\n      <span class=\"synIdentifier\">var</span> url = $<span class=\"synIdentifier\">this</span>.parents(<span class=\"synConstant\">'article.entry'</span>).find(<span class=\"synConstant\">'a.entry-title-link'</span>).attr(<span class=\"synConstant\">'href'</span>);\n      $<span class=\"synIdentifier\">this</span>.attr(<span class=\"synConstant\">'href'</span>, url);\n    <span class=\"synIdentifier\">}</span>);\n  <span class=\"synIdentifier\">}</span><span class=\"synStatement\">else</span><span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">return</span>;\n  <span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>)(jQuery);\n</pre><p>これでJavaScriptに何かあったときは、今までと同じ表示になります。</p>\n\n</div>\n<div class=\"section\">\n    <h3>さらに書き直し@1231</h3>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>  <span class=\"synIdentifier\">var</span> seeMore = $(<span class=\"synConstant\">'.seemore'</span>),\n  len = seeMore.length;\n  <span class=\"synStatement\">if</span>(len &gt; 1)<span class=\"synIdentifier\">{</span>\n    seeMore.remove();\n    $(<span class=\"synConstant\">'.comment-box'</span>).remove();\n\n    <span class=\"synIdentifier\">var</span> readmore = $(<span class=\"synConstant\">'&lt;p class=&quot;readmore&quot;&gt;&lt;a href=&quot;#&quot;&gt;続きを読む&lt;/a&gt;&lt;/p&gt;'</span>).appendTo(<span class=\"synConstant\">'.entry-content'</span>);\n    $.each(readmore, <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n      <span class=\"synIdentifier\">var</span> $<span class=\"synIdentifier\">this</span> = $(<span class=\"synIdentifier\">this</span>);\n      <span class=\"synIdentifier\">var</span> url = $<span class=\"synIdentifier\">this</span>.parents(<span class=\"synConstant\">'.entry'</span>).find(<span class=\"synConstant\">'.entry-title-link'</span>).attr(<span class=\"synConstant\">'href'</span>);\n      $<span class=\"synIdentifier\">this</span>.children(<span class=\"synConstant\">'a'</span>).attr(<span class=\"synConstant\">'href'</span>, url);\n    <span class=\"synIdentifier\">}</span>);\n  <span class=\"synIdentifier\">}</span>\n</pre><p>そもそもページ多すぎで判別するのはナンセンスなので、seemoreあったら起動。</p>\n\n</div>\n</div>"
}
