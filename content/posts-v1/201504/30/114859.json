{
  "title": "モバイル向けにSPAをつくってた話",
  "html": "<p>実は4月の頭にリリースされてて、今さら感のあるつくって\"た\"話です。<br />\nもちろん仕事でなのですが、ココはあくまで個人ブログなので、ある程度ぼやかしつつ書きます。</p><p>知ってる人は知ってると思いますが、<a href=\"https://www.google.co.jp/webhp?hl=ja#hl=ja&q=%E5%98%98%E3%81%A8%E7%9C%9F%E5%AE%9F\" target=\"_blank\" title=\"嘘と真実 - Google 検索\">コレ</a>です。</p>\n\n<div class=\"section\">\n    <h3>作ったもの</h3>\n    <p>何もしらないとイメージしづらいと思うので、いちおう。</p>\n\n<ul>\n<li>モバイルメインのWebサービス</li>\n<li>ゲームではないが、ゲーム性の強いWebサービス</li>\n<li>シナリオゲーみたいなやつ</li>\n<li>複数のSPAと多数のページから成るそれなりの規模</li>\n<li>ネイティブでもShell-Appでもなく純ブラウザ向け</li>\n<li>iOS5.x/Android4.x以上が対応OS</li>\n<li>Safari/標準ブラウザ/Chrome/各種WebViewが対象ブラウザ</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3>この記事を書こうと思ったわけ</h3>\n    <p>新しいFWやらライブラリやら、流行り廃りが激しい最近ですが、<br />\n実績といえばなんのアテにもならないTODOアプリとか、たかだか3,4ルートのSPAだったりで、<br />\n実際のサービスでそれなりの規模で動いてるものの情報ってあんまり無いですよね・・？</p><p>それがなんだかなーと思ってたので、自分から一つ情報提供してみようかと思い。<br />\n右クリックするくらいしかできないと思いますが、なにとぞ。</p>\n\n</div>\n<div class=\"section\">\n    <h3>支える技術</h3>\n    \n<div class=\"section\">\n    <h4>HTML/CSS</h4>\n    <p>いちおうHTML5ですが、Googleさんの巡回範囲外は伝家のdiv工芸です。<br />\ndiv職人をマークアップエンジニアとは言いません。</p><p>Sass/Compassを使ってて、OOCSSでもBEMでもSMACCSでもないオレオレな感じになってます。<br />\nこのへんもいつかまとめたいなー。</p>\n\n</div>\n<div class=\"section\">\n    <h4>JavaScript</h4>\n    \n<ul>\n<li>jQuery</li>\n<li>Lodash</li>\n<li>Backbone.js</li>\n<li>Marionette.js</li>\n<li>Require.js</li>\n<li>Velocity.js</li>\n<li>Create.js</li>\n<li><a href=\"https://github.com/dameleon/paw.js\" target=\"_blank\" title=\"dameleon/paw.js\">dameleon/paw.js</a></li>\n<li><a href=\"https://github.com/leader22?tab=repositories\" target=\"_blank\" title=\"leader22 (Yuji Sugiura)\">うちのリポジトリ</a>にある細々したライブラリたち</li>\n<li>その他もろもろ</li>\n</ul><p>jQueryはカスタムビルド、LodashはJST(テンプレ）としても使ってます。<br />\nMarionetteはリリース時点で最新！のv2.4.0です。<br />\nCreate.jsも一応使ってますが、Flashの出番は多くないです。</p><p>AltJSではなくて、生JavaScriptです。</p>\n\n</div>\n<div class=\"section\">\n    <h4>裏方</h4>\n    \n<ul>\n<li>各種Gruntタスク</li>\n<li>jshint</li>\n<li>csslint</li>\n<li>stylestats</li>\n<li>その他もろもろ</li>\n</ul><p>細々書いて捨てた系のNodeのスクリプトたちもいっぱいいました。<br />\n運用ツールにnwjsとかjson5とかも使ってたりもしましたね。</p><p>Gruntタスクは増えてきた時にちゃんとファイル分割すれば、別になんの問題もないです。<br />\n<br />\n</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>技術選定時の振り返り</h3>\n    \n<div class=\"section\">\n    <h4>Marionette.js</h4>\n    <p>あの頃はReactのRの字も出てない頃で、SPA作るならBackboneかAngularかって頃でした。<br />\nVueはまだ知る人ぞ知る・・って頃です。</p><p>Angularは身の回りに大した前例がないのと、Vueは周辺機器が揃ってなかったこともあり、<br />\nあっさりBackbone、ソースコメントの日本語化とかやって興味があったMarionetteって感じで選びました。</p><p>細かいパフォーマンス的なとこや、いくつか実装に異議ありポイントはもちろんありますが、<br />\nそれを差し置いても良いものです。<br />\n開発後期にメジャーバージョンアップがあって追従するのは大変だったものの、<br />\nそれでも対応する価値はあったかなーと。</p><p>ModelがあってViewがあってRouterがあって、アプリ一式作るのに必要なものが完備されてる安心感採用です。</p><p>・・・採用事例とかに載せてくれへんかなｗ</p>\n\n</div>\n<div class=\"section\">\n    <h4>Require.js</h4>\n    <p>世間のムードは「Require(というかAMD)はオワコン、これからはBrowserify！」って感じですが、私は依然としてRequire派です。</p><p>正確には、開発中はAMD、配布時はrjs(でもなんでもいいけど固めたい)派です。</p>\n\n</div>\n<div class=\"section\">\n    <h4>jQuery / Velocity.js</h4>\n    <p>カスタムビルドして不要なAPIを削りまくってます。</p><p>実際のところ、class操作とon/off、セレクタ周りもfindくらいしか使ってないです。<br />\n車輪の再発明するか最後まで悩んでやらなかったやつ。</p><p>jQueryのfadeIn/Outの代役がVelocityです。<br />\nCSSのtransitionEndとanimationEndのイベントが挙動不審なのが全部悪いです。<br />\n<br />\n</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>2015年に思うモバイル開発</h3>\n    \n<div class=\"section\">\n    <h4>シェア的なもの</h4>\n    <p>新規のサービスを作るなら、Android2系はさすがに切っていい頃だと思います。<br />\nどっかでIE8よりシェア低いみたいなのを見た気がする。</p><p>ただ4.4(KitKat)以上のみにするにはまだ早くて、2系からのアップデートで4系になったお上りさんがまだまだ多い印象。<br />\nそしてバグるのはだいたいココ(ヽ´ω`)</p><p>iOSはさすがで、iOS7以上が圧倒的に多いです。<br />\nってもiPhone4でもiOS7にはなれるのでもうちょい細かく見なきゃなりませぬ。</p><p>その他のOSは、依然として息してません！</p>\n\n</div>\n<div class=\"section\">\n    <h4>ヤバいのはメモリより描画</h4>\n    <p>jQueryのセレクタの書き方がどうとか、あんなもんは大した問題じゃないです。<br />\n(やらかしてるなら問題以前に論外です)<br />\nリークしないようにするとか、イベントは貼ったら剥がすとかも、注意すればいいだけです。</p>\n\n<ul>\n<li>いかに描画を間引くか</li>\n<li>いっぺんにまとめて処理しない</li>\n<li>CompositeLayerを綺麗に敷く</li>\n<li>動かす必要の無いときは消す(せめて止める)</li>\n<li>無駄なCSSは書かない</li>\n</ul><p>こういう描画まわりの方がパフォーマンス改善には効きます。<br />\nというか、やんないと動かないです・・。</p><p>jsの計算はそこそこ速いのに、ただのfadeInでガタつくのがAndroidです。<br />\njsから取れる値はちゃんとしてるのに、描画が追いつかないのがAndroidです！！<br />\n人の目には見えてないのに、そこに要素があると言いはるのがAndroidです！！！</p><p>JavaScriptは書けるけどCSSよーわからんみたいな人だと、ちょっと辛い分野なのかも？<br />\nposition: fixedとかoverflow: scrollとか、やっぱりまだまだ闇です。</p>\n\n    <blockquote>\n        <p>こういうのに日々接してると、VirtualDOMとかほんと大丈夫なのかと心配で仕方がないですね</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h4>WebViewやらChromeやら</h4>\n    <p>1年前と違うのは、FacebookやらTwitterやらLINEやらの、いわゆるWebViewで表示したい需要が増えたこと。</p><p>まぁコレはWebViewかブラウザかを判別するのがすこぶる大変なくらいで、<br />\n挙動に関しては特に何も変わりません。</p>\n\n    <blockquote>\n        <p><a href=\"http://lealog.hateblo.jp/entry/2014/10/09/130344\" target=\"_blank\" title=\"ブラウザかWebViewか、どちらで開かれたのかを判別するには - console.lealog();\">ブラウザかWebViewか、どちらで開かれたのかを判別するには - console.lealog();</a></p>\n\n    </blockquote>\n<p>Chromeが増えてきて、標準ブラウザのバグ地獄から解放されるーとか思ってる皆さーん。<br />\nダウトです。</p><p>SafariとChromeで微妙に挙動違うとか、Android標準ブラウザと微妙に挙動が違うとかあります。<br />\n単純に敵が増えただけです。</p><p>アドレスバーの挙動が違うだけで高さ計算は狂う、ブラウザバックの挙動も違う、リロード周りの挙動も違う！<br />\n標準ブラウザのくせにUAではChromeって名乗るやつがいる！</p>\n\n</div>\n<div class=\"section\">\n    <h4>Androidへの気持ち</h4>\n    <p>箇条書きで参ります。</p>\n\n<ul>\n<li>Galaxyシリーズの2.x->4.0系がヤバい(4.1以上だとマシ)</li>\n<li>HTCシリーズはアニメーションgifが動きません</li>\n<li>SH***シリーズ、シェア多いくせに安定して低スペックが生き残ってる</li>\n<li>Xperiaシリーズ、基本的には安定してるのにたまに抜けてる</li>\n<li>Nexusシリーズは新しいのと古いのの差がスゴい</li>\n<li>Arrowsシリーズは2.x時代からの成長がうかがえます</li>\n</ul><p>脳内で擬人化して扱うと、ちょっとだけ心が落ち着きますね。<br />\n#fxxk_android_sushiとかないんですかね。</p>\n\n    <blockquote>\n        <p><a href=\"http://ja.wikipedia.org/wiki/Android%E7%AB%AF%E6%9C%AB%E4%B8%80%E8%A6%A7#.E7.A7.BB.E5.8B.95.E4.BD.93.E9.80.9A.E4.BF.A1.E4.BA.8B.E6.A5.AD.E8.80.85.E7.B6.B2.E5.AF.BE.E5.BF.9C.E7.AB.AF.E6.9C.AB.E4.B8.80.E8.A6.A7\" target=\"_blank\" title=\"Android端末一覧 - Wikipedia\">Android端末一覧 - Wikipedia</a></p>\n\n    </blockquote>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>おわりに</h3>\n    <p>こういう分野で日々疲弊してる仲間がいれば是非ともお近づきになりたいのですが、やはりもう誰もモバイルで頑張ってないんですか・・？<br />\niOS8になってもAndroid5になっても、まだバグっぽい挙動はいっぱいあるのにぜーんぜん情報見つからなくて困ってます！</p><p>少なくとも目に見えるエッジな人々はみなPCばっかで、モバイルをそこまで相手にしてない印象があるので・・。(個人の感想です)</p><p>これからどうしようかなー。</p>\n\n</div>"
}
