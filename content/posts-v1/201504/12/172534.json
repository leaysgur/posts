{
  "title": "モバイルブラウザからアプリを開くには",
  "html": "<p>あいも変わらずモバイル情報です。</p><p>成果物はこちら。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/leader22/app-opener\" target=\"_blank\" title=\"leader22/app-opener\">leader22/app-opener</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h3>事の発端</h3>\n    <p>よく見ますよね、モバイルサイトの至る所にある「Twitterでシェア」、「Facebookでシェア」ってボタン。<br />\nよく見るんですけど・・・押しますか？アレ。</p><p>TwitterもFacebookも、もちろんアプリを使ってますよね。<br />\nブラウザでなんて、誰もログインしてないですよね。</p><p>てことは誰も押さないですよね？！！</p><p>ネイティブアプリ全盛期にブラウザWebでシェアしてね！ったって、<br />\nわざわざログインしてまでやってくれる人が、果たしてどれくらいいるでしょうか。</p><p>うー、Webつらい！アプリ強い！<br />\nせめてこのボタンを押すとアプリが起動し・・たら素敵ではありませんか？！</p>\n\n</div>\n<div class=\"section\">\n    <h3>どうにかなるのか</h3>\n    <p>別に目新しい技術ではないのですが、実は\"URIScheme\"っていうものがあります。</p>\n\n    <blockquote>\n        <p>URLスキーマって言われたりスキームって言われたり、色々呼ばれてます。<br />\nAndroidだとインテントって呼んでたりもするらしい。</p>\n\n    </blockquote>\n<p>\"http://\" だとブラウザが起動するのと同じように、特定のアプリを呼び出すやつです。<br />\nTwitterなら\"twitter://\"とかです。<br />\nこれらはアプリ側で定義されてある必要があります。</p>\n\n</div>\n<div class=\"section\">\n    <h3>それならそうと</h3>\n    <pre class=\"code lang-html\" data-lang=\"html\" data-unlink><span class=\"synIdentifier\">&lt;</span><span class=\"synStatement\">a</span><span class=\"synIdentifier\"> </span><span class=\"synType\">href</span><span class=\"synIdentifier\">=</span><span class=\"synConstant\">&quot;twitter://timeline&quot;</span><span class=\"synIdentifier\">&gt;</span><span class=\"synUnderlined\">TwitterAppのタイムラインを表示！</span><span class=\"synIdentifier\">&lt;/</span><span class=\"synStatement\">a</span><span class=\"synIdentifier\">&gt;</span>\n</pre><p>ってすりゃいいわけです。<br />\n楽勝です。</p><p>と言いたいところですが・・・。</p>\n\n<ul>\n<li>アプリがインストールされてなかったら？</li>\n<li>Androidでも動くのか？</li>\n</ul><p>とか気になってきますよね？<br />\n確かに動くし良いっちゃ良いのですが、そこは気にしないといけません。</p>\n\n</div>\n<div class=\"section\">\n    <h3>app-opner.js</h3>\n    <p>てなわけで作りました。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/leader22/app-opener\" target=\"_blank\" title=\"leader22/app-opener\">leader22/app-opener</a></p>\n\n    </blockquote>\n<p>iOS5以上、Android4以上で動くと思います。<br />\n厳密に色んな端末で検証したわけではないですが、手元のいくつかの端末では動いてました。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> isAndroid = navigator.userAgent.toLowerCase().indexOf(<span class=\"synConstant\">'android'</span>) !== -1;\n<span class=\"synIdentifier\">var</span> shareText = encodeURIComponent(<span class=\"synConstant\">'Webからアプリが開いたよ！！ @leader22++ https://github.com/leader22/app-opener'</span>) + <span class=\"synConstant\">' '</span>;\n<span class=\"synIdentifier\">var</span> schemeStr = (isAndroid) ? <span class=\"synConstant\">'intent://post?message='</span> + shareText + <span class=\"synConstant\">'#Intent;scheme=twitter;package=com.twitter.android;end;'</span>\n                            : <span class=\"synConstant\">'twitter://post?message='</span> + shareText;\n<span class=\"synStatement\">new</span> AppOpener(<span class=\"synIdentifier\">{</span>\n    schemeStr:   schemeStr,\n    fallbackUrl: <span class=\"synConstant\">'http://lealog.net'</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>って定義されたページでも用意しておけば、リンク踏むだけでおっけーです。<br />\nschemeStrさえ用意すれば、後はなんとかしてくれるライブラリです。<br />\n<br />\n</p>\n\n</div>\n<div class=\"section\">\n    <h3>OS別の挙動について</h3>\n    \n<div class=\"section\">\n    <h4>iOS</h4>\n    <p>有効なスキームだった場合は、思った通り動作します。<br />\niOS Chromeでも、アプリ内WebViewでも問題なかったです。</p><p>ログインしてない場合などは、アプリは開きますがもちろんログイン画面に行きます。</p><p>普通のaタグだったりで直接コレを開こうとすると、<br />\nアプリがインストールされてない場合などに、無効なリンクとして処理されるっぽく、処理できない旨のalertが表示されます。</p><p>この味気ないalertではなく、それなりにハンドリングしたい・・ってあなた！<br />\niframeを使えばなんとかなります！</p><p>冒頭のリポジトリからコードを見てみてくださいまし。</p>\n\n    <blockquote>\n        <p><a href=\"http://wiki.akosma.com/IPhone_URL_Schemes\" target=\"_blank\" title=\"IPhone URL Schemes - akosma wiki\">IPhone URL Schemes - akosma wiki</a></p>\n\n    </blockquote>\n<p>URIスキーム自体を探すのにはココが便利です。</p>\n\n</div>\n<div class=\"section\">\n    <h4>Android</h4>\n    <p>またもこいつに手を焼かれるのかとおもいきや、割とすんなりです。<br />\nただAndroidのプロセス管理？の挙動がちょっとiOS民からすると特殊で、そこだけ注意します。</p><p>Androidの場合はインテントなる仕組みを使って実現します。<br />\niOSと同じスキームでも動くっぽいのですが、どのアプリを使うかをユーザーに判断させるようなフローになるっぽい。<br />\nURL開く時に、「ブラウザで開く？それともChromeで開く？」って出るアレ。</p><p>アレもまぁある種親切なのですが・・・、<br />\nこれを回避したい場合には、このインテントを使ってアプリを直接指定する他ないようです。</p><p>たとえばTwitterなら、</p>\n<pre class=\"code\" data-lang=\"\" data-unlink>iOS: &#39;twitter://post?message={{TEXT}}&#39;\nANDROID: &#39;intent://post?message={{TEXT}}#Intent;scheme=twitter;package=com.twitter.android;end;&#39;</pre><p>って感じです。</p><p>棚ぼた的な感じですが、この指定の仕方をしていると、該当するアプリがインストールされていない場合、<br />\nGooglePlayを開いてくれるという謎のフォールバック機能が！</p><p>どうやらAndroid Chromeではiframeから呼べないっぽいので、どちらでも動く愚直に開く方式にしました。</p><p>あ、一つ言い忘れました。<br />\nS Browser、お前だけは許さねぇ！</p>\n\n    <blockquote>\n        <p><a href=\"https://gist.github.com/uupaa/b25c9cf47bbeedea5a7f\" target=\"_blank\" title=\"おや… S Browser 三銃士 の様子が…\">おや… S Browser 三銃士 の様子が…</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h4>いんたーねっと情報</h4>\n    \n    <blockquote>\n        <p><a href=\"http://aawaara.com/post/74543339755/smallest-piece-of-code-thats-going-to-change-the\">Smallest piece of code that&#39;s going to change the... - Aawaara</a></p>\n\n    </blockquote>\n<p>こういう感じ？</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>これで晴れてアプリでシェアできる</h3>\n    <p>できます。が。</p><p>実はいちばんやりたかったFacebookアプリの起動がどうにもこうにもできませんで・・。<br />\n正確には、起動まではいけるが、「1タップで即シェアな状態」までもっていくスキームが見つけられず・・。<br />\nGoogle先生に聞いてありとあらゆるパターンを試しましたがダメでした。</p><p>せっかく作ったのに勿体無いなーと思いつつ、<br />\nTwitterやLINE、その他のアプリはスキームさえあればコレで動くので、成果としてはまあ満足してはいるんですけどねー。</p><p>Facebookでシェアするスキーム！WANTED！</p>\n\n<div class=\"section\">\n    <h4>ほんとは</h4>\n    <p>iOSとAndroidのschemeStrの差まで吸収して、各SNSにシェアするメソッドまで定義しようと思ってました。<br />\nただ、Facebookさまが使えないとなるともはや・・なので、自由に渡すカタチにしました。</p><p>iOSの場合のインストールされてなかったフックくらいは提供しても良かったのですが、特に使い道がないのでそっとしておきました。</p>\n\n</div>\n<div class=\"section\">\n    <h4>ちなみに</h4>\n    <p>Facebookさま曰く、</p>\n\n    <blockquote>\n        <p>Don't prefill captions, comments, messages, or the user message parameter of posts with content a person didn’t create, even if the person can edit or remove the content before sharing.</p>\n\n    </blockquote>\n<p>つまり、できたところでポリシー違反にはなるので、それはそれでアレなんですが・・。</p>\n\n    <blockquote>\n        <p><a href=\"https://developers.facebook.com/policy#control\" target=\"_blank\" title=\"Platform Policy\">Platform Policy</a></p>\n\n    </blockquote>\n<p>やっぱりWebはWebらしく謙虚にいきましょうと思った春のひとときでした。</p>\n\n</div>\n</div>"
}
