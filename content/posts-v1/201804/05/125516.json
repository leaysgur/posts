{
  "title": "CircleCIでFirefoxHeadlessを使う",
  "html": "<p>まあ手動でインストールすればいいんですけど、それより身近な手段あるやん！って飛びついてダメだった学びをメモ。</p><p>ちなみにHeadlessモードは、`-headless`フラグで有効にできて、プラットフォームによりつつ`v55` or `v56`から使える。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>愚直にapt-get</h3>\n    <pre class=\"code lang-sh\" data-lang=\"sh\" data-unlink>apt-get update\napt-get install <span class=\"synSpecial\">-y</span> firefox\n</pre><p>これダメ。</p><p>`v49`くらいの古いやつが落ちてくる。</p>\n\n</div>\n<div class=\"section\">\n    <h3>circleci/node</h3>\n    <p>手動でインストールすればいいって言っても、やっぱりブラウザを<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%DE%A5%F3%A5%C9%A5%E9%A5%A4%A5%F3\">コマンドライン</a>からいちいちインストールするのは面倒くさい。</p><p>ありがたいことに、CircleCIが公式イメージとして用意してくれてるのでそれを使いたくなるのが怠惰なエンジニアなはず。</p>\n\n    <blockquote>\n        <p><a href=\"https://hub.docker.com/r/circleci/node/\">https://hub.docker.com/r/circleci/node/</a></p>\n\n    </blockquote>\n<p>たとえばこのイメージで`circleci/node:8.11.0-browsers`とかすると、Nodeだけでなく<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>と<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>がついてくる。</p><p>ただ、この<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>のバージョンも古い・・。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/circleci/circleci-images/issues/86\">Please include Firefox 56+ in the browsers image &middot; Issue #86 &middot; circleci/circleci-images &middot; GitHub</a></p>\n\n    </blockquote>\n<p>そして残念ながら当面はアップデートされなそう。</p>\n\n</div>\n<div class=\"section\">\n    <h3>なので</h3>\n    <p>↑のIssueにあるコードを参考にして、自分で`run`でインストールする。</p>\n\n<ul>\n<li>GeckoDriverは必要に応じて</li>\n<li>`apt-get remove <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/firefox\">firefox</a>-<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/mozilla\">mozilla</a>-build`は、既に<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>が入ってるイメージでのみ必要</li>\n</ul><p>得体の知れないイメージ使うのも抵抗あるけど、自分で秘伝のRUNコマンドでイメージ作るのも抵抗ある・・。</p>\n\n    <blockquote>\n        <p>まあ<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>だけじゃなく、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>も若干古いバージョンなんやけど、Headlessモードは使えるのでまあ・・。</p>\n\n    </blockquote>\n\n</div>"
}
