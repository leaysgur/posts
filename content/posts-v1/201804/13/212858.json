{
  "title": "CDN Study (Akamai/Fastly) に行ってきたメモ #CDN_study",
  "html": "\n    <blockquote>\n        <p><a href=\"https://http2study.connpass.com/event/81469/\">CDN Study (Akamai/Fastly) - connpass</a></p>\n\n    </blockquote>\n<p>久しぶりにすごい人混みに身をおいたわ・・。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>どんな勉強会だったか</h3>\n    \n<ul>\n<li>CDNにもいろんな歴史がある</li>\n<li>あの頃のCDNといまのCDNでは、世界観も役割も変わってきてる</li>\n<li>気がする</li>\n<li>ので、中の人に聞いてみよう！</li>\n</ul><p>という主旨の会。</p>\n\n</div>\n<div class=\"section\">\n    <h3>from Akamai</h3>\n    \n    <blockquote>\n        <p>資料は見つけたら</p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h4>CDNの過去と現在</h4>\n    \n<ul>\n<li>1995年の時点で、中央集権的なWebは破綻するといわれていた\n<ul>\n<li>中央集権型ゆえに</li>\n<li>インターネットの混雑が問題になるだろう</li>\n<li>from Tim Berners-Lee</li>\n</ul></li>\n<li>インターネットは網の目\n<ul>\n<li>ただ実際は地震でケーブルが切れて不安定になったり</li>\n<li>去年のGoogleの経路のアレとかも</li>\n</ul></li>\n<li>爆発的なトラフィックによる負荷\n<ul>\n<li>スターウォーズの新作トレーラーとか</li>\n<li>インドのプレミアリーグとか</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>CDNってそもそも</h4>\n    \n<ul>\n<li>インターネットの不安定さを避けるためにどうすれば</li>\n<li>ユーザーに近いところにコンテンツを再配置すればいいのでは</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Akamai</h4>\n    \n<ul>\n<li>そして1998年にAkamaiが創業！</li>\n<li>PoP数は1700\n<ul>\n<li>他社より1桁多い（圧倒的に多い）</li>\n<li>Point of Presence = いたるところにサーバーがある</li>\n</ul></li>\n<li>どうやって最寄りのサーバーを見つけるのか\n<ul>\n<li>DNSの名前解決の時点でアクセス元を把握</li>\n<li>Aレコードを動的に変える</li>\n<li>2019年まではAkamaiの特許</li>\n</ul></li>\n<li>最適なエッジサーバーとは\n<ul>\n<li>CPU・ディスク・メモリなどなど、それぞれを使う処理がある</li>\n</ul></li>\n<li>Akamaiの解決策\n<ul>\n<li>Stable marriage problem(安定結婚問題)</li>\n<li>Gale-Shapleyアルゴリズム</li>\n<li>Algorithmic Nuggets in Content Delivery\n<ul>\n<li><a href=\"https://people.cs.umass.edu/~ramesh/Site/HOME_files/CCRpaper.pdf\">https://people.cs.umass.edu/~ramesh/Site/HOME_files/CCRpaper.pdf</a></li>\n</ul></li>\n</ul></li>\n<li>Akamaiのエッジサーバーは高機能\n<ul>\n<li>やりたいことはだいたいできると思ってよい</li>\n<li>日本のエンジニアだけでも</li>\n<li>XMLベースのDSLで書ける</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>CDNでやりたかったこと（これまで・これから）</h4>\n    \n<ul>\n<li>インターネットの経路の不安定さを解消したかった</li>\n<li>静的ファイル配信を速くしたい</li>\n<li>画像や動画などの配信も最適化（ストリーミングとか）</li>\n<li>DDoS対策、Bot対策など</li>\n<li>もはやContentsDeliveryNetworkではない\n<ul>\n<li>Akamai内部ではもうそう呼んでない</li>\n<li>CloudDeliveryNetwork</li>\n</ul></li>\n<li>CDNのEdgeでやろうとすることが増えてきた</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>CDNベンダによる標準化</h4>\n    \n<ul>\n<li>IETFなどに社員を派遣してる\n<ul>\n<li>HTTP/2, QUIC, TLS 1.3などの標準化</li>\n</ul></li>\n<li>ブラウザが進化しないと、CDNとしても意味ない</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Akamai x HTTP/2</h4>\n    \n<ul>\n<li>デフォルトで有効</li>\n<li>Akamaiの後に立つサーバーがHTTP1.1でも大丈夫</li>\n<li>ServerPushも一部対応\n<ul>\n<li>CSS, JSが対象</li>\n<li>測定用のJSを埋め込んで返す、そこで計測した内容を元にPUSH</li>\n</ul></li>\n<li>PiezというChrome拡張で、効果測定できる\n<ul>\n<li><a href=\"https://chrome.google.com/webstore/detail/piez/npbccjkjemgagjioahfccljgnlkdleod\">Piez - Chrome Web Store</a></li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Akamai x QUIC</h4>\n    \n<ul>\n<li>6月より利用できる</li>\n<li>HLSの動画ファイル10個の取得にかかる時間が半分になった</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Akamai x TLS 1.3</h4>\n    \n<ul>\n<li>1.3が使える`openssl`のバージョン次第で、既に接続可能</li>\n<li>CipherProfileを1.3専用に</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>CDNの未来</h4>\n    \n<ul>\n<li>Edgeの位置が変わるのでは\n<ul>\n<li>もっとユーザー寄りに</li>\n<li>電話会社とか、電柱とか</li>\n<li>不動産と同じでロケーションだけがカギ</li>\n</ul></li>\n<li>IoTが普及したら\n<ul>\n<li>MQTTにも対応したい</li>\n<li>よりレイテンシを下げる必要が出てきそう</li>\n</ul></li>\n<li>Webガバナンス強化のためのCDN\n<ul>\n<li>社外向けのドメインを束ねられる</li>\n<li>SSLのバージョンを一括管理できたり</li>\n<li>突然デカいファイルを貼られてもいいように</li>\n</ul></li>\n<li>サービスの設計時からキャッシュを考慮する\n<ul>\n<li>サービス開始ではなく、もっと前から使っていく</li>\n<li>キャッシュフレンドリーに作る</li>\n<li>ETag</li>\n</ul></li>\n<li>キャッシュ戦略をモデリングできないか考えてる\n<ul>\n<li>アプリ開発者のほうがこのあたりはいいアイデアを持ってるかも</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>質疑</h4>\n    \n<ul>\n<li>WAFに組み込めるSDKみたいなのあればいいのでは？\n<ul>\n<li>その通りですね</li>\n</ul></li>\n<li>標準化のWGに名前が出てこないけど・・？\n<ul>\n<li>WGのことは知らなかったけど、他社との協力はやってます</li>\n</ul></li>\n<li>Edgeでできることが増えると、CDNの引越しがつらそう、学習コストとかもあるので標準化できない？\n<ul>\n<li>他社とすりあわせることはなさそう</li>\n<li>それぞれのCDNの独自性や競争力にもなるので</li>\n</ul></li>\n<li>Akamaiのキャッシュパージ遅くない？\n<ul>\n<li>昔は遅かったが今は5秒</li>\n<li>やり方は言えないけど、内部的にがんばってる</li>\n</ul></li>\n<li>ServerPushでクライアントの状況を把握するのはどういう具合？\n<ul>\n<li><a href=\"https://tools.ietf.org/html/draft-ietf-httpbis-cache-digest-04\">draft-ietf-httpbis-cache-digest-04 - Cache Digests for HTTP/2</a> みたいなのもあるけど</li>\n<li>機械学習でよしなにやってます</li>\n</ul></li>\n</ul><p>宣伝: 6/21にAkamai Tech Summitってのをやります！</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>from Fastly</h3>\n    \n    <blockquote>\n        <p><a href=\"https://speakerdeck.com/kazuho/fastlyfalsepuroguramakarajian-tacdn\">Fastly&#x306E;&#x30D7;&#x30ED;&#x30B0;&#x30E9;&#x30DE;&#x304B;&#x3089;&#x898B;&#x305F;CDN // Speaker Deck</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h4>Fastly</h4>\n    \n<ul>\n<li>2011年創業</li>\n<li>社員は400人くらい</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>PoP設計</h4>\n    \n<ul>\n<li>CDNを使うからには\n<ul>\n<li>Cacheのヒット率を上げたい</li>\n</ul></li>\n<li>Fastlyは50</li>\n<li>PoP設計は2パターン\n<ul>\n<li>コンビニモデル: よりユーザーの近くにたくさん</li>\n<li>スーパーマーケットモデル: 狙ったところに巨大なものを</li>\n<li>Akamaiが前者、Fastlyは後者</li>\n</ul></li>\n<li>1つでTbps級のネットワークを処理できる</li>\n<li>ルータレス・ルーティング\n<ul>\n<li><a href=\"https://www.fastly.com/blog/building-and-scaling-fastly-network-part-1-fighting-fib\">Building and scaling the Fastly network, part 1: Fighting the FIB</a></li>\n</ul></li>\n<li>ステートレス・ロードバランス\n<ul>\n<li>サーバーのクラスタ自体が全体で協調してロードバランスする</li>\n</ul></li>\n<li>独自のfsでSSDの書き込みを最適化したり、各種チューニングはもちろん</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>全世界的な分散KVS</h4>\n    \n<ul>\n<li>VCL(VarnishControlLanguage)でロジックを書ける\n<ul>\n<li>リクエストのルーティング・書き換え・再送</li>\n<li>レスポンスヘッダの書き換え</li>\n</ul></li>\n<li>URLで参照・キャッシュ\n<ul>\n<li>リクエストを書き換えて、任意のキーでキャッシュするKVS</li>\n<li>サロゲートキーでもってパージしたりも</li>\n</ul></li>\n<li>Shieldingというリクエストをまとめる技術\n<ul>\n<li>より上位のPoPにキャッシュがあるかも</li>\n<li>→ キャッシュヒット率に貢献</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Fastlyの機能</h4>\n    \n<ul>\n<li>Firewallもデフォルト</li>\n<li>DDoS対策\n<ul>\n<li>小規模のものなら問題にならない</li>\n<li>悪意のあるパケットをフィルタしたり</li>\n</ul></li>\n<li>画像最適化</li>\n<li>EdgeSideIncludesもできる\n<ul>\n<li>Akamaiと相互乗り換えできます</li>\n</ul></li>\n<li>MicroServiceをFastly上で構築\n<ul>\n<li>日経新聞の例</li>\n<li>高度な例だが事例は増えそう</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>プロトコルの進化とCDN</h4>\n    \n<ul>\n<li>1999年から2015年まで、進化に時間がかかった</li>\n<li>なぜ今なのか\n<ul>\n<li>プロトコルの制限（通信速度など）がボトルネックになってきた</li>\n<li>スマートフォンの圧倒的な普及</li>\n<li>スノーデン事件</li>\n<li>CDNの勃興（により、プロトコルの進化が進んだ）</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>進化の方向</h4>\n    \n<ul>\n<li>全通信の暗号化\n<ul>\n<li>プライバシー保護、硬直化対策</li>\n</ul></li>\n<li>より速く\n<ul>\n<li>0-RTTで返せるように</li>\n<li>Push, EarlyHints</li>\n</ul></li>\n<li>よりつながるように\n<ul>\n<li>ネットワークをまたいでも</li>\n<li>劣悪な環境でも</li>\n</ul></li>\n<li>CDNに関連するプロトコル拡張\n<ul>\n<li>DNS over HTTPS</li>\n<li>EarlyHints / CacheDigests for HTTP/2</li>\n<li>Server Timing</li>\n<li>Secondary Certificates</li>\n<li>Short Term Certs. / Delegated Creds.</li>\n<li>Variants</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>QUIC</h4>\n    \n<ul>\n<li>TCP/2と呼んではいけない</li>\n<li>0-1RTTで接続確立</li>\n<li>ヘッドオブラインブロッキング解決</li>\n<li>ネットワークをまたいでも途切れないように</li>\n<li>今後も進化できるプロトコルにするために</li>\n<li>進捗\n<ul>\n<li>トランスポート設計は固まりつつある</li>\n<li>ヘッダの詳細などはこれから</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>質疑</h4>\n    \n<ul>\n<li>Web Packagingあたりの話はどう思いますか？\n<ul>\n<li>AMPみたいなものですよね</li>\n<li>標準化な方向に進むのはよいと思います</li>\n</ul></li>\n<li>CDNだとネットワーク回線にも工夫があるのでは？\n<ul>\n<li>専用のハードウェアを作ったりはしないだろう</li>\n<li>ソフトウェア設計上の工夫は、話した通り</li>\n</ul></li>\n<li>Edgeで動かせるスクリプトを手軽にテストできる仕組みは？\n<ul>\n<li>開発用のツールはあるが、検証用のテスト環境はない</li>\n</ul></li>\n<li>暗号化が進むとデバッグなどがつらいのでは？\n<ul>\n<li>どこまで標準化するかが議論</li>\n<li>暗号化はするけど一部は見れるようにするとか検討されてる</li>\n</ul></li>\n<li>どこまでCDNに載せるか指針みたいのはある？\n<ul>\n<li>CDN屋としては全部載せてほしい・・</li>\n<li>が、基本的には共用サーバーなので重い処理はダメとか</li>\n</ul></li>\n<li>QUICはハードウェアオフロードやカーネルとは疎にしてく？\n<ul>\n<li>カーネルに関係なく動くようにしてる</li>\n<li>基本的にはユーザーランドで</li>\n</ul></li>\n</ul>\n</div>\n</div>"
}
