{
  "title": "Vagrantのsynced_folderはrsyncで",
  "html": "<p>環境は<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Vagrant\">Vagrant</a>で、でもコードはGitで、みたいな。<br />\nで、Gitのコードはホストにあるので、ゲストにはSynced Folderでーっていう。</p><p>ありますよね、こういう経験。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>synced_folder</h3>\n    <p>ホスト(＝自分のOS環境)と、ゲスト(＝<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Vagrant\">Vagrant</a>内)を同期してくれる便利な機能ですが、普通に使うとハマります。</p><p>ファイルの量が少ないならいいけど、だいたいのケースでそんなことないはず。</p>\n<pre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink><span class=\"synType\">Vagrant</span>.configure(<span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">2</span><span class=\"synSpecial\">&quot;</span>) <span class=\"synStatement\">do</span> |<span class=\"synIdentifier\">config</span>|\n  config.vm.synced_folder <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">~/path/to/your/git/folder</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">/home/vagrant/path/to/synced</span><span class=\"synSpecial\">&quot;</span>\n<span class=\"synStatement\">end</span>\n</pre><p>こんなふうにtypeに何も指定しないままだと、あれこれ重くてまったく仕事になりません。<br />\n特に<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Rails\">Rails</a>とかやってると顕著な気がするけど、</p>\n\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/rails\">rails</a> serverで何分もかかったり</li>\n<li>ページ開いてもSprocketsが1分/ファイルとか</li>\n</ul><p>このままではマジで使えないです。</p>\n\n</div>\n<div class=\"section\">\n    <h3>type: \"<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/rsync\">rsync</a>\"</h3>\n    <p>「<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Vagrant\">Vagrant</a> 重い」とかで検索すると、type: \"<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nfs\">nfs</a>\"で快適！みたいなのがよく引っかかります。<br />\nただ<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Mac\">Mac</a>でしか使えない上に、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3\">パーミッション</a>まわりで謎にハマることが多いので注意。(経験談)</p><p>そこでtype: \"<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/rsync\">rsync</a>\"！</p>\n<pre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink><span class=\"synType\">Vagrant</span>.configure(<span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">2</span><span class=\"synSpecial\">&quot;</span>) <span class=\"synStatement\">do</span> |<span class=\"synIdentifier\">config</span>|\n  config.vm.synced_folder <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">~/path/to/your/git/folder</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">/home/vagrant/path/to/synced</span><span class=\"synSpecial\">&quot;</span>,\n    <span class=\"synConstant\">type</span>: <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">rsync</span><span class=\"synSpecial\">&quot;</span>,\n    <span class=\"synConstant\">rsync__args</span>: [<span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">--verbose</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">--archive</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">--delete</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">--copy-links</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">--times</span><span class=\"synSpecial\">&quot;</span>, <span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">-z</span><span class=\"synSpecial\">&quot;</span>],\n    <span class=\"synConstant\">rsync__exclude</span>: [<span class=\"synSpecial\">&quot;</span><span class=\"synConstant\">.git/</span><span class=\"synSpecial\">&quot;</span>]\n<span class=\"synStatement\">end</span>\n</pre><p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/rsync\">rsync</a>に渡すオプションはご自由にですが、だいたいこんな感じでやるとすべてうまく行きます。</p>\n\n    <blockquote>\n        <p><a href=\"https://www.vagrantup.com/docs/synced-folders/rsync.html\">RSync - Synced Folders - Vagrant by HashiCorp</a></p>\n\n    </blockquote>\n<p>あとは`<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/vagrant\">vagrant</a> up`して、`<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/vagrant\">vagrant</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/rsync\">rsync</a>-auto`ってしとけば、リアルタイムに同期される！素敵！</p>\n\n</div>"
}
