{
  "title": "2015年、Speech synthesisは使えるやつなのか",
  "html": "<p>2015年も終わりですね。<br />\nさて、ふと思い立ってコレを調べてます。</p><p>去年くらいかな？当初、使えるようでまったく使えないイメージがあったこのAPIですが、<br />\nはたして年末になった今、使えるAPIになっているのでしょうか・・・！</p>\n\n    <blockquote>\n        <p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API#Speech_synthesis\">Web Speech API - Web APIs | MDN</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h3>はじめに</h3>\n    <p>Web Speech APIってのは実は2本柱で構成されます。</p>\n\n<ul>\n<li>Speech recogition</li>\n<li>Speech synthesis</li>\n</ul><p>Speech recogitionは、マイクで声を拾ってそれを文字列で扱えるようにするとこまで。<br />\nSpeech synthesisは文字列を実際に発するところ。</p><p>今回調べたのは後者の部分です。</p>\n\n</div>\n<div class=\"section\">\n    <h3>Speech synthesis</h3>\n    <p>ざっくり使い方。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> txt = <span class=\"synConstant\">'あのイーハトーヴォのすきとおった風'</span>;\n\n<span class=\"synIdentifier\">var</span> uttr = <span class=\"synStatement\">new</span> SpeechSynthesisUtterance(txt);\nuttr.lang = <span class=\"synConstant\">'ja-JP'</span>;\n\nspeechSynthesis.speak(uttr);\n</pre><p>わざわざspeechSynthesis.getVoices()してその中の1つをuttr.voiceに代入しなくても、日本語読んでくれる一見便利なAPIです。</p>\n\n<div class=\"section\">\n    <h4>読み上げる文字列はキューされる</h4>\n    <p>speak()すると、それがどんどんキューにpushされて、キューがなくなるまで読み上げ続ける。<br />\nこれが重要で、Web Audio APIみたく非同期に再生してくれるわけではない。</p>\n\n<ul>\n<li>speak: キューに追加</li>\n<li>cancel: 全キューを削除</li>\n<li>pause: 一時停止（キューには影響しない）</li>\n<li>resume: 一時停止の解除</li>\n</ul><p>window.speechSynthesisに生えてる↑のメソッドでコントロールする。</p>\n\n</div>\n<div class=\"section\">\n    <h4>読み上げ状態</h4>\n    \n<ul>\n<li>paused</li>\n<li>pending</li>\n<li>speaking</li>\n</ul><p>window.speechSynthesisに↑ってフラグがある。<br />\nこのへんはなんかHTML Audioと似た感じ。</p>\n\n</div>\n<div class=\"section\">\n    <h4>SpeechSynthesisUtterance</h4>\n    <p>speakするときに作ったこのインスタンスは、他にもいろいろ設定できる。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">var</span> uttr = <span class=\"synStatement\">new</span> SpeechSynthesisUtterance(<span class=\"synConstant\">'読みあげたい文字列'</span>);\n\n<span class=\"synComment\">// こっちでもok</span>\nuttr.text = <span class=\"synConstant\">&quot;読み上げたい文字列&quot;</span>;\n\n<span class=\"synComment\">// 読み上げ具合</span>\nuttr.pitch  = 1;\nuttr.rate   = 1;\nuttr.volume = 1;\n\n<span class=\"synComment\">// 言語とか声質とか</span>\nuttr.lang  = <span class=\"synConstant\">&quot;ja-JP&quot;</span>;\nuttr.voice = <span class=\"synStatement\">null</span>;\n\n<span class=\"synComment\">// コールバック系</span>\nuttr.onboundary = <span class=\"synStatement\">null</span>;\nuttr.onend      = <span class=\"synStatement\">null</span>;\nuttr.onerror    = <span class=\"synStatement\">null</span>;\nuttr.onmark     = <span class=\"synStatement\">null</span>;\nuttr.onpause    = <span class=\"synStatement\">null</span>;\nuttr.onresume   = <span class=\"synStatement\">null</span>;\nuttr.onstart    = <span class=\"synStatement\">null</span>;\n</pre><p>言語まわりを設定せずに、日本語らしき文字列を読ませようとすると、変な声が出ますｗ</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>使えないポイント</h3>\n    \n<div class=\"section\">\n    <h4>そもそも対応ブラウザが</h4>\n    \n    <blockquote>\n        <p><a href=\"http://caniuse.com/#feat=speech-synthesis\">http://caniuse.com/#feat=speech-synthesis</a></p>\n\n    </blockquote>\n<p>ChromeとSafariだけ。<br />\nそしてこの組み合わせ、絶対おなじ挙動にならん罠や・・。<br />\n<br />\n</p>\n\n</div>\n<div class=\"section\">\n    <h4>長い文字読ませると詰まる(ことがあった</h4>\n    <p>さっそくChromeでだけ発生するやつ。<br />\nだいたい70文字以上くらいになると、ぶつっと切れて読み上げが止まる。</p><p>そのくせにendのコールバックも呼ばれないしspeakingフラグは立ったまま。<br />\n次にspeakしても無視。</p><p>cancelしないととダメです。</p>\n\n    <blockquote>\n        <p>20160104: あらためて見たらなおってた・・・</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h4>日本語はむずかしい</h4>\n    \n<ul>\n<li>草はえる -> くさ わ える</li>\n<li>Node.js -> のーど じぇーえす</li>\n<li>ファンだった方も -> ふぁんだったほうも</li>\n<li>都心 -> みやこごころ</li>\n<li>36度5分 -> さんじゅうろくど ごふん</li>\n<li>骨粗鬆症 -> ほねあらすしょう(Safariのみ)</li>\n</ul><p>それなりに賢いが、完璧ではないので目をつぶる決断が必須。</p>\n\n</div>\n<div class=\"section\">\n    <h4>1ブラウザ1コンテキスト？</h4>\n    \n<ul>\n<li>ページAでspeak -> スタート</li>\n<li>その再生中に、ページB（違うタブ）でspeak</li>\n<li>ページAの分がspeakし終わったら、ページBでキューにためたヤツが読み上げられる</li>\n</ul><p>という感じで1ブラウザで1Synthesisっぽいので、まぁ被ることはないと思うけど注意・・。<br />\nあとリロードしても読み上げ止まらなかったりするし、細やかな挙動には期待してはいけない！</p>\n\n</div>\n<div class=\"section\">\n    <h4>英語なら？</h4>\n    <p>たしかに変な読み方はないし、日本語よりは流暢に喋ってくれますが・・。</p><p>それでも、</p>\n\n<ul>\n<li>イントネーションは決して自然ではない</li>\n<li>抑揚が弱くてすっごく聞き取りづらい</li>\n<li>日本語と同じで読み方間違ったりする</li>\n</ul><p>ので、どこまでを許容するか次第。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>おわりに</h3>\n    <p>うーん、惜しい。</p>\n\n</div>"
}
