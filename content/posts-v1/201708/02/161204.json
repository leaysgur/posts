{
  "title": "2017年版: getUserMedia()で画面のストリームを取得する",
  "html": "<p>間違ってたら教えてください。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a></h3>\n    <p>バージョン: 60.0.3112.78</p><p>あいかわらず要拡張。</p>\n\n<ul>\n<li><a href=\"https://github.com/muaz-khan/WebRTC-Experiment/tree/master/getScreenId.js\">WebRTC-Experiment/getScreenId.js at master &middot; muaz-khan/WebRTC-Experiment &middot; GitHub</a></li>\n<li><a href=\"https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk\">Screen Capturing - Chrome Web Store</a></li>\n</ul><p>例のごとくのこういう組合せ。<br />\n自作してもいいし、ありものを使ってもいい。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">{</span>\n  video: <span class=\"synIdentifier\">{</span>\n    mandatory: <span class=\"synIdentifier\">{</span>\n      chromeMediaSource:   <span class=\"synConstant\">'desktop'</span>,\n      chromeMediaSourceId: <span class=\"synConstant\">''</span>, <span class=\"synComment\">// 取れたscreenId</span>\n  <span class=\"synIdentifier\">}</span>,\n<span class=\"synIdentifier\">}</span>\n</pre><p>`desktop`固定でも、拡張からscreenIdをもらうときにダイアログで選べるので関係ないっぽい。</p><p>ただしCanaryだと、`--enable-usermedia-screen-capturing`で起動すれば`screen`のストリームは取れた。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>navigator.mediaDevices.getUserMedia(<span class=\"synIdentifier\">{</span> video: <span class=\"synIdentifier\">{</span> mandatory: <span class=\"synIdentifier\">{</span> chromeMediaSource: <span class=\"synConstant\">'screen'</span> <span class=\"synIdentifier\">}</span> <span class=\"synIdentifier\">}</span> <span class=\"synIdentifier\">}</span>)\n  .then(stream =&gt; <span class=\"synIdentifier\">{</span>\n    <span class=\"synComment\">// ...</span>\n  <span class=\"synIdentifier\">}</span>);\n</pre><p>指定できるのは`desktop`か`screen`で、それ以外を指定するとエラーになる。<br />\nただどっちを選んでもアラートが出て共有しますか？ってなるだけで、どのウィンドウとかは選べないし、外部モニタに出してたとして2つのスクリーンから選びたくても選べない謎・・(˘ω˘ )<br />\n<br />\n</p>\n\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a></h3>\n    <p>バージョン: 54.0.1</p><p>フラグ設定とか<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%DB%A5%EF%A5%A4%A5%C8%A5%EA%A5%B9%A5%C8\">ホワイトリスト</a>とか一切いらんくなってた。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>navigator.mediaDevices.getUserMedia(<span class=\"synIdentifier\">{</span> video: <span class=\"synIdentifier\">{</span> mediaSource: <span class=\"synConstant\">'window'</span> <span class=\"synIdentifier\">}</span> <span class=\"synIdentifier\">}</span>)\n  .then(stream =&gt; <span class=\"synIdentifier\">{</span>\n    <span class=\"synComment\">// ...</span>\n  <span class=\"synIdentifier\">}</span>);\n</pre><p>これだけ。</p><p>`mediaSource`に指定できるのはこの3つ。</p>\n\n<ul>\n<li>`window`</li>\n<li>`application`</li>\n<li>`screen`</li>\n</ul><p><br />\nNightlyでも一緒。</p><p>ただし、`<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/https\">https</a>`でしか使えなくて、`<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/localhost\">localhost</a>`でも使えない。<br />\n普通のカメラは使えるのに。</p>\n\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/IE\">IE</a> / Edge</h3>\n    <p>たぶん無理。</p>\n\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>(TP)</h3>\n    <p>たぶん無理。</p>\n\n</div>\n<div class=\"section\">\n    <h3>まとめ</h3>\n    <p>サポートされてるとは一言では言えない微妙な感じ。</p><p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/IE\">IE</a>とか<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>でも独自の<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D7%A5%E9%A5%B0%A5%A4%A5%F3\">プラグイン</a>をインストールすることで使えるようになるみたいなのもあったけど、どうなんやろうコレ。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/Temasys/AdapterJS\">GitHub - Temasys/AdapterJS: AdapterJS Javascript Polyfill and Tools for WebRTC - Skylink WebRTC</a></p>\n\n    </blockquote>\n\n</div>"
}
