{
  "title": "Androidで`getUserMedia()`したら`NotReadableError: could not start video source`",
  "html": "<p>なかなか懐かしい気分にさせてくれますが、特定の機種でのみ発生するエラーでした。</p><p>回避方法がちゃんとあるのでそれをメモっておきます。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>再現手順</h3>\n    \n<ul>\n<li>`getUserMedia({ video: true })`する</li>\n<li>取得した`MediaStream`をとっておく</li>\n<li>`enumeratedDevices()`して、違う`deviceId`を指定して`getUserMedia()`</li>\n</ul><p>これだけでエラーになる。</p>\n\n    <blockquote>\n        <p>NotReadableError: could not start video source</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>回避方法</h3>\n    <p>2度目の`deviceId`指定で`getUserMedia()`する前に、既存の`MediaStream`を開放する。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>stream.getTracks().forEach(track =&gt; track.stop());\n</pre><p>こうした後でなら、問題なくメディアをつかめる。<br />\nつかんでから開放するコードを書きがちなんやけど、それでは手遅れ。</p><p>ちなみに、別タブでメディアをつかんでいる場合もダメで、ブラウザごとに1つのカメラしかつかめないっぽい・・？</p>\n\n</div>\n<div class=\"section\">\n    <h3>再現した・しなかった機種</h3>\n    <p>再現しなかった機種。</p>\n\n<ul>\n<li>Pixel 4</li>\n<li>Pixel 3a</li>\n</ul><p>再現しなかった機種。</p>\n\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/HUAWEI\">HUAWEI</a> P20 lite</li>\n</ul><p>もしかしたらOSバージョンとか、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>バージョンとかの兼ね合いもあるかもしれない。</p>\n\n</div>"
}
