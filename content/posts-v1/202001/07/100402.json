{
  "title": "chrome://webrtc-internals ã®ã—ãã¿",
  "html": "<p>ãªã‚“ã¨ãªãã‚¢ãƒ†ã¯ã¤ã„ã¦ãŸã‘ã©ã€ä¸­èº«ãŒæ°—ã«ãªã‚‹ã¨ã„ã†è©±ã‚’èã„ãŸã®ã§èª¿ã¹ã¦ã¿ãŸã€‚</p><p>WebRTCã‚„ã£ã¦ã‚‹ã¿ãªã•ã‚“ãªã‚‰ãŠé¦´æŸ“ã¿ã®ã‚ã®ãƒšãƒ¼ã‚¸ã§ã™ã€‚<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>chrome://webrtc-internals</h3>\n    <p>WebRTCã®ãƒ‡ãƒãƒƒã‚°ã¨ã„ãˆã°ã“ã®ãƒšãƒ¼ã‚¸ã€‚</p><p>ç‰¹ã«ä½•ã‚‚ä»•è¾¼ã‚“ã§ãªã„ã®ã«ã€è¦‹ã¦ã‚‹ãƒšãƒ¼ã‚¸ã§`getUserMedia()`ã—ãŸã‚Š`RTCPeerConnection`ãŒä½œã‚‰ã‚Œã‚Œã°ãã®æ§˜å­ãŒè¦‹ãˆã‚‹ã—ã€å®Ÿéš›ã«æµã‚Œã¦ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ã‚„ãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ã¾ã§ã‚ã‹ã‚‹ã€‚</p><p>ã‚ã‚Œã£ã¦ã©ã†ã„ã†ã—ãã¿ï¼Ÿã£ã¦ã„ã†ã®ã‚’èª¿ã¹ã¦ã„ãã¾ã™ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>ãŸã ã®Webãƒšãƒ¼ã‚¸</h3>\n    <p>URLãŒ`chrome://`ã«ãªã£ã¦ã‚‹ã‘ã©ã€ã‚Œã£ãã¨ã—ãŸWebãƒšãƒ¼ã‚¸ã§ã™ã€‚</p><p>ãªã®ã§DevToolsã§Networkã‚¿ãƒ–è¦‹ã‚Œã°ã ã„ãŸã„ã‚ã‹ã‚‹ï¼ã¨ã„ã†ã‚ã‘ã§ã€‚</p><p>æ§‹æˆè¦ç´ ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚</p>\n\n<ul>\n<li>webrtc-internals.html\n<ul>\n<li>ãŸã ã®HTML/CSS</li>\n<li>ä»¥ä¸‹ã®2ã¤ã®JSã‚’èª­ã¿è¾¼ã‚“ã§ã‚‹</li>\n</ul></li>\n<li>util.js\n<ul>\n<li>ã“ã®ãƒšãƒ¼ã‚¸ã ã‘ã§ãªãã€ä»–ã®ãƒšãƒ¼ã‚¸ã§ã‚‚ä½¿ã‚ã‚Œã‚‹ç³»util</li>\n<li>ãŸã ã—`chrome://`ã§ã®ã¿ä½¿ãˆã‚‹æ¨¡æ§˜</li>\n</ul></li>\n<li>webrtc_internals.js\n<ul>\n<li>æœ¬ä½“</li>\n<li>ã“ã®è¨˜äº‹ã®ä¸»æ—¨</li>\n</ul></li>\n</ul><p>ã¡ãªã¿ã«DevToolsã§ã‚ã–ã‚ã–è§£æã—ãªãã¦ã‚‚ã€Chromeã®ã‚½ãƒ¼ã‚¹ã‚’æ¼ã‚Œã°å®Ÿã¯å‡ºã¦ãã‚‹ãƒ»ãƒ»ï¼</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/chromium/chromium/tree/master/content/browser/webrtc/resources\">chromium/content/browser/webrtc/resources at master &middot; chromium/chromium &middot; GitHub</a></p>\n\n    </blockquote>\n<p>ãŸã ã—ã“ã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã‚ˆã†ã«è¬ã®`include`è¦ç´ ãŒã‚ã£ã¦ã€ä¸€æ‹¬ã§èª­ã‚€ã«ã¯çµå±€DevToolsã‹ã‚‰è½ã¨ã™ã—ã‹ãªã‹ã£ãŸãƒ»ãƒ»ã€‚</p>\n\n    <blockquote>\n        <p><a href=\"https://gist.github.com/leader22/a7e8db88a5fb304be4e45b73424a1ff5\">Dump of chrome://webrtc-internals by Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36&quot; &middot; GitHub</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>util.js</h3>\n    <p>ã¾ãšã¯è»½ã„ã»ã†ã‹ã‚‰ã€‚</p>\n\n<ul>\n<li>`assert(condition, opt_message)`</li>\n<li>`$()`\n<ul>\n<li>`document.getElementById()`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹</li>\n</ul></li>\n<li>`appendParam(url, key, value)`</li>\n<li>`createElementWithClassName(type, className)`</li>\n<li>etc...</li>\n</ul><p>ãªã©ãªã©ã€Consoleãƒ‘ãƒãƒ«ã®Command Line APIã¨ã‚‚é•ã£ãŸã€ä¾¿åˆ©APIãŸã¡ã€‚</p><p>`chrome://`é…ä¸‹ã®ãƒšãƒ¼ã‚¸ã§ã ã‘èª­ã¿è¾¼ã¾ã‚Œã‚‹é–¢æ•°ç¾¤ã§ã‚ã‚Šã€ä»Šå›ã¯ã©ã†ã§ã‚‚ã„ã„ã‚„ã¤ã‚‰ã§ã™ã€‚</p><p>æ¬¡ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>webrtc_internals.js</h3>\n    <p>æœ¬ä¸¸ã¯åœ§å·»ã®3000è¡Œï¼</p>\n\n<div class=\"section\">\n    <h4>Overview</h4>\n    \n<ul>\n<li>ã²ãŸã™ã‚‰é–¢æ•°ã‚„ã‚¯ãƒ©ã‚¹å®šç¾©ãŒç¶šã„ã¦ã¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒè¦‹ã¤ã‘ã«ãã„\n<ul>\n<li>2700è¡Œç›®ãã‚‰ã„ã«ã‚ã‚‹`initialize()`ã£ã¦ã‚„ã¤ãŒãã†</li>\n</ul></li>\n<li>ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ES5æ™‚ä»£ã£ã½ãã€`class`ã§ã¯ãªã`prototype`ã‚’ä½œã£ã¦ã‚‹æ‡ã‹ã—ã„æ„Ÿã˜</li>\n<li>ã‚¿ãƒ–è¡¨ç¤ºã‚„ã‚°ãƒ©ãƒ•è¡¨ç¤ºãªã©UIçš„ãªã“ã¨ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚‚ã‚ã‚‹ã—\n<ul>\n<li>ã‚°ãƒ©ãƒ•ã¯`canvas`ãªã®ã§ãã®ã‚ãŸã‚Šã‚‚</li>\n</ul></li>\n<li>æ™‚ç³»åˆ—ã§æºœã¾ã£ã¦ã„ãstatsãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚‚ã‚ã‚‹\n<ul>\n<li>`getStats()`ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½è±¡åŒ–ã—ã¦ã‚‹ã‚„ã¤ã¨ã‹</li>\n</ul></li>\n<li>Dumpã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½ã¨ã‹ã‚‚ã“ã“</li>\n</ul><p>é †ã«èª­ã‚“ã§ã„ãã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>initialize()</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">function</span> initialize() <span class=\"synIdentifier\">{</span>\n  dumpCreator = <span class=\"synStatement\">new</span> DumpCreator($(<span class=\"synConstant\">&quot;content-root&quot;</span>));\n  $(<span class=\"synConstant\">&quot;content-root&quot;</span>).appendChild(createStatsSelectionOptionElements());\n\n  tabView = <span class=\"synStatement\">new</span> TabView($(<span class=\"synConstant\">&quot;content-root&quot;</span>));\n  ssrcInfoManager = <span class=\"synStatement\">new</span> SsrcInfoManager();\n  peerConnectionUpdateTable = <span class=\"synStatement\">new</span> PeerConnectionUpdateTable();\n  statsTable = <span class=\"synStatement\">new</span> StatsTable(ssrcInfoManager);\n\n  chrome.send(<span class=\"synConstant\">&quot;finishedDOMLoad&quot;</span>);\n\n  <span class=\"synComment\">// Requests stats from all peer connections every second.</span>\n  <span class=\"synStatement\">window</span>.setInterval(requestStats, 1000);\n<span class=\"synIdentifier\">}</span>\n<span class=\"synStatement\">document</span>.addEventListener(<span class=\"synConstant\">&quot;DOMContentLoaded&quot;</span>, initialize);\n</pre><p>ã“ã“ã‹ã‚‰ã¯ã˜ã¾ã‚‹ã€‚<br />\nã•ã£ããã•ã£ãã¿ãŸ`util.js`ã®`$()`ãŒä½¿ã‚ã‚Œã¦ã‚‹ï¼</p><p>ã‚„ã£ã¦ã‚‹ã“ã¨ã¨ã—ã¦ã¯ã€</p>\n\n<ul>\n<li>Create Dumpã®æ©Ÿèƒ½</li>\n<li>å„ç¨®ã‚¿ãƒ–ã®UIåˆæœŸåŒ–</li>\n<li>PeerConnectionã¨Statsã®Viewã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</li>\n<li>1ç§’ã”ã¨ã«Statsãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚</li>\n</ul><p>ã£ã¦æ„Ÿã˜ã€‚</p><p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ»ãƒ»ã¨ã‹ã§ã¯ãªãã€æ„šç›´ã«1ç§’ã”ã¨ã®ã‚¿ã‚¤ãƒãƒ¼ãŒé ‘å¼µã£ã¦ãŸã‚“ã§ã™ã­ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã‹ã‚‰ãã‚‹ã®ã‹</h4>\n    <p>`getUserMedia()`ã—ãŸã“ã¨ã¨ã‹ã€`RTCPeerConnection`ãŒä½œã‚‰ã‚ŒãŸã“ã¨ã¨ã‹ã€ãã†ã„ã†æƒ…å ±ã®å‡ºã©ã“ã‚ã¯ã©ã“ã‹ï¼Ÿ</p><p>`initialize()`ã§å‘¼ã‚“ã§ã‚‹1ç§’ã”ã¨ã®`requestStats()`ãŒä½•ã—ã¦ã‚‹ã‹ã‚’è¿½ãˆã°ã‚ã‹ã‚‹ã¯ãšãƒ»ãƒ»ãƒ»ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">function</span> requestStats() <span class=\"synIdentifier\">{</span>\n  <span class=\"synStatement\">if</span> (currentGetStatsMethod == OPTION_GETSTATS_STANDARD) <span class=\"synIdentifier\">{</span>\n    requestStandardStats();\n  <span class=\"synIdentifier\">}</span> <span class=\"synStatement\">else</span> <span class=\"synStatement\">if</span> (currentGetStatsMethod == OPTION_GETSTATS_LEGACY) <span class=\"synIdentifier\">{</span>\n    requestLegacyStats();\n  <span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>\n\n<span class=\"synComment\">/**</span>\n<span class=\"synComment\"> * Sends a request to the browser to get peer connection statistics from the</span>\n<span class=\"synComment\"> * standard getStats() API (promise-based).</span>\n<span class=\"synComment\"> */</span>\n<span class=\"synIdentifier\">function</span> requestStandardStats() <span class=\"synIdentifier\">{</span>\n  <span class=\"synStatement\">if</span> (<span class=\"synType\">Object</span>.keys(peerConnectionDataStore).length &gt; 0) <span class=\"synIdentifier\">{</span>\n    chrome.send(<span class=\"synConstant\">&quot;getStandardStats&quot;</span>);\n  <span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>\n</pre><p>ã¯ã„ã€‚</p><p>`getStats()`ã¯`Promise`ãƒ™ãƒ¼ã‚¹ã‹ãã†ã§ãªã„ã‹ã§è¿”ã‚Šå€¤ãŒå¤‰ã‚ã‚‹ä»•æ§˜å¤‰æ›´ãŒã‚ã£ãŸã€‚<br />\nãªã®ã§ãã‚Œã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§é¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¦ã€ã©ã¡ã‚‰ã«ã›ã‚ˆã€Œ`getStats()`ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãã ã•ã„ã€ã£ã¦ã„ã£ã¦ã‚‹ã€‚</p><p>`chrome.send(\"getStandardStats\")`ã™ã‚‹ã¨ã€ãã£ã¨ã©ã“ã‹ã§å¾…ã¡å—ã‘ã¦ã‚‹é–¢æ•°ã«ãã®ãƒ‡ãƒ¼ã‚¿ãŒæ”¾ã‚Šè¾¼ã¾ã‚Œã¦ãã‚‹ã£ã½ã„ã€‚</p><p>æ¬¡ã¯ãã®å—ã‘å£ã‚’æ¢ã™ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>æ¨ªé“: ã“ã‚ŒãŒä½¿ãˆã‚‹ãªã‚‰</h4>\n    <p>`chrome.send(\"getStandardStats\")`ãŒè‡ªç”±ã«ä½¿ãˆã‚‹ãªã‚‰ã€ã©ã‚“ãªãƒšãƒ¼ã‚¸ã§ã‚‚`getStats()`ã—æ”¾é¡Œãªã®ã§ã¯ï¼Ÿï¼æ—ã‚‹ã®ã§ã¯ï¼Ÿï¼</p><p>ã£ã¦æ€ã£ãŸã‘ã©ã€ã¾ãã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</p><p>Chromeã®å ´åˆã€`chrome`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ`window`ã«ã ã„ãŸã„ç”Ÿãˆã¦ã‚‹ã‚“ã§ã™ãŒã€é€šå¸¸ã®Webãƒšãƒ¼ã‚¸ã‚’ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ã—ã¦ã‚‹ã¨ãã¯è‚å¿ƒã®`chrome.send()`ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p><p>ã©ã†ã‚„ã‚‰`chrome://`é…ä¸‹ã®ãƒšãƒ¼ã‚¸ã§ã ã‘ä½¿ãˆã‚‹ã‚‚ã®ã‚‰ã—ã„ã€‚</p>\n\n    <blockquote>\n        <p><a href=\"https://stackoverflow.com/questions/44936584/accessing-chrome-send-method-in-chrome-web-browser-out-of-chromes-internal\">Accessing `chrome.send()` method in chrome web browser out of chrome&#39;s internal pages - Stack Overflow</a></p>\n\n    </blockquote>\n<p>æ®‹å¿µã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>ç¶šãƒ»ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã‹ã‚‰ãã‚‹ã®ã‹</h4>\n    <p>`chrome.send()`ã«å¯¾å¿œã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã¿ãŸã„ãªã‚„ã¤ãŒè¦‹å½“ãŸã‚‰ãªã„ã®ã§ã€ãã£ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¦‹ãˆã¦ã‚‹é–¢æ•°ã®ã©ã‚Œã‹ãŒãŠã‚‚ã‚€ã‚ã«å©ã‹ã‚Œã‚‹ã¯ãšã€‚ï¼ˆã“ã‚Œã¯å‹˜ï¼‰</p><p>æ€ªã—ã„é–¢æ•°ãªã„ã‹ãªãƒ¼ã¨è¦‹ã¦ãŸã‚‰è¦‹ã¤ã‘ãŸã“ã®2ã¤ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã€‚</p>\n\n<ul>\n<li>`userMediaRequests = []`</li>\n<li>`peerConnectionDataStore = {}`</li>\n</ul><p>å®Ÿéš›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹çŠ¶æ…‹ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰è¦‹ã¦ã‚‚ãã‚Œã‚‰ã—ã„å€¤ãŒå…¥ã£ã¦ãŸã®ã§ã€ã“ã“ãŒã™ã¹ã¦ã ã¨è¦‹ã¦ã‚ˆã•ãã†ã€‚</p><p>ã¡ãªã¿ã«ã€`userMediaRequests`ã«å…¥ã£ã¦ã‚‹ã®ã¯ã“ã‚“ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> userMediaRequests = <span class=\"synIdentifier\">[</span>\n  <span class=\"synIdentifier\">{</span>\n    origin: <span class=\"synConstant\">&quot;https://conf.webrtc.ecl.ntt.com&quot;</span>,\n    pid: 41455,\n    rid: 659,\n    timestamp: 1576114434316.34,\n    video: <span class=\"synConstant\">&quot;{deviceId: {exact: [&quot;</span>02c4f48cf9bfd27aa15f8d7b1483cb3aefdbed87f8b4a189e9814774316f8723<span class=\"synConstant\">&quot;]}}&quot;</span>\n  <span class=\"synIdentifier\">}</span>,\n<span class=\"synIdentifier\">]</span>\n</pre><p>å®Ÿéš›ã«internalsã§è¦‹ã‚Œã‚‹ã®ã¨ã»ã¼ä¸€ç·’ã§ãŠã‚‚ã—ã‚ã¿ã¯ãªã„ã€‚</p><p>`pid`ã”ã¨ã«èƒŒæ™¯ã®è‰²ã‚’å¤‰ãˆã‚‹ã¨ã‹ã—ã¦ã»ã—ã„ãªã¨ã„ã¤ã‚‚æ€ã£ã¦ã‚‹ã€‚<br />\n`rid`ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‹ã­ï¼Ÿ</p><p>`addGetUserMedia()`ã¨ã„ã†ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ãŒã“ã®é…åˆ—ã«å€¤ã‚’å…¥ã‚Œã¦ã‚‹ã®ã§ã€ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè²¼ã£ã¦ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãŸã©ã‚Œã°ã‚ã‹ã‚‹ã¨æ€ã£ãŸã‚‰ã€ã¾ã•ã‹ã®ã¦ã£ãºã‚“ã ã£ãŸãƒ»ãƒ»ã€‚</p><p>ã¨ã„ã†ã“ã¨ã¯ã€‚</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>webrtc-internalsã®ã—ãã¿</h3>\n    <p>JavaScriptã®ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã®ã¦ã£ãºã‚“ã§æ—¢ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã£ã¦ã“ã¨ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶å´ = C++ã‹ã‚‰å€¤ãŒæ¸¡ã•ã‚Œã¦ã‚‹ã¯ãšã€‚</p><p>ãã†æ€ã£ã¦C++ã®ã‚³ãƒ¼ãƒ‰è¦‹ãŸã‚‰ãƒ“ãƒ³ã‚´ã ã£ãŸã€‚</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/chromium/chromium/blob/master/content/browser/webrtc/webrtc_internals.cc\">chromium/webrtc_internals.cc at master &middot; chromium/chromium &middot; GitHub</a></p>\n\n    </blockquote>\n\n<ul>\n<li>JavaScriptã‹ã‚‰ã¯`chrome.send()`ã§ã‚·ã‚°ãƒŠãƒ«ã™ã‚‹</li>\n<li>ã™ã‚‹ã¨C++ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ãªé–¢æ•°ã«å¼•æ•°ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦å©ã</li>\n</ul><p>ã¨ã„ã†ã—ãã¿ã€‚</p><p>C++ã®ã‚³ãƒ¼ãƒ‰ã§ã„ã†`SendUpdate(key, data)`ã®`key`ãŒã€ã“ã®JSã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã«ãªã£ã¦ã‚‹ã€‚</p>\n\n<ul>\n<li>addPeerConnection</li>\n<li>removePeerConnection</li>\n<li>updatePeerConnection</li>\n<li>addStandardStats</li>\n<li>addLegacyStats</li>\n<li>addGetUserMedia</li>\n<li>eventLogRecordingsFileSelectionCancelled</li>\n<li>audioDebugRecordingsFileSelectionCancelled</li>\n<li>removeGetUserMediaForRenderer</li>\n</ul><p>ç¾çŠ¶ã§å®šç¾©ã•ã‚Œã¦ã‚‹`key`ã¯ã“ã‚Œã‚‰ã€‚</p><p>ã¨ã„ã†ã‚ã‘ã§ã€ã‚ã¨ã¯å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’è²¯ã‚ã¦ã€æ•´å½¢ã—ã¦ã€è¡¨ç¤ºã—ã¦ã‚‹ã ã‘ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>ä½¿ãˆãã†ãªã‚³ãƒ¼ãƒ‰ã¯ã‚ã‚‹ã‹</h3>\n    <p>internalsã§è¦‹ã‚Œã‚‹æƒ…å ±ã¯ä¾¿åˆ©ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€Chromeã§ã—ã‹ã‚‚ã¡ã‚ã‚“ä½¿ãˆãªã„ã—ã€è¦‹ã›æ–¹ã‚‚å°‘ã—å·¥å¤«ã—ãŸã„ï¼ˆå–æ¨é¸æŠã—ãŸã„ï¼‰ã“ã¨ãŒã‚ã‚‹ã€‚</p><p>ãªã®ã§ã“ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æ‹å€Ÿã™ã‚Œã°ã€ã‚ªãƒ¬ã‚ªãƒ¬internalsçš„UIã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¦ã€Firefoxã‚„Safariã§ã‚‚åŒã˜ã‚ˆã†ã«ä½¿ãˆã‚‹ã®ã§ã¯ï¼Ÿã¨ã„ã†ã€‚</p><p>ãã®ãŸã‚ã«ä½¿ãˆãã†ãªã‚³ãƒ¼ãƒ‰ç‰‡ãŒãªã„ã‹è¦‹ã¦ãŠãã€‚</p>\n\n<div class=\"section\">\n    <h4>StatsRatesCalculator</h4>\n    <p>`getStats()`ã®ãƒ‡ãƒ¼ã‚¿ã¯ã ã„ãŸã„å‰ã®ãƒ‡ãƒ¼ã‚¿ã¨æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ãŒå¤šã„ã‘ã©ã€æ­£ã«ãã†ã„ã†ã“ã¨ã‚’ã‚„ã£ã¦ã‚‹ã‚„ã¤ãŒã„ãŸã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">class</span> StatsRatesCalculator <span class=\"synIdentifier\">{</span>\n  constructor() <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">this</span>.previousReport = <span class=\"synStatement\">null</span>;\n    <span class=\"synIdentifier\">this</span>.currentReport = <span class=\"synStatement\">null</span>;\n  <span class=\"synIdentifier\">}</span>\n\n  addStatsReport(report) <span class=\"synIdentifier\">{</span>\n    <span class=\"synIdentifier\">this</span>.previousReport = <span class=\"synIdentifier\">this</span>.currentReport;\n    <span class=\"synIdentifier\">this</span>.currentReport = report;\n    <span class=\"synIdentifier\">this</span>.updateCalculatedMetrics_();\n  <span class=\"synIdentifier\">}</span>\n\n  <span class=\"synComment\">// Updates all &quot;calculated metrics&quot;, which are metrics derived from standard</span>\n  <span class=\"synComment\">// values, such as converting total counters (e.g. bytesSent) to rates (e.g.</span>\n  <span class=\"synComment\">// bytesSent/s).</span>\n  updateCalculatedMetrics_() <span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">const</span> statsCalculators = <span class=\"synIdentifier\">[</span>\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;data-channel&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          messagesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;messagesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          messagesReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;messagesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          bytesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          bytesReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>)\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;media-source&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          totalAudioEnergy: <span class=\"synStatement\">new</span> AudioLevelRmsCalculator()\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;track&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          framesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;framesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          framesReceived: <span class=\"synIdentifier\">[</span>\n            <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;framesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n            <span class=\"synStatement\">new</span> DifferenceCalculator(<span class=\"synConstant\">&quot;framesReceived&quot;</span>, <span class=\"synConstant\">&quot;framesDecoded&quot;</span>)\n          <span class=\"synIdentifier\">]</span>,\n          totalAudioEnergy: <span class=\"synStatement\">new</span> AudioLevelRmsCalculator(),\n          jitterBufferDelay: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;jitterBufferDelay&quot;</span>,\n            <span class=\"synConstant\">&quot;jitterBufferEmittedCount&quot;</span>,\n            CalculatorModifier.kMillisecondsFromSeconds\n          )\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;outbound-rtp&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          bytesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          packetsSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;packetsSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          totalPacketSendDelay: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;totalPacketSendDelay&quot;</span>,\n            <span class=\"synConstant\">&quot;packetsSent&quot;</span>,\n            CalculatorModifier.kMillisecondsFromSeconds\n          ),\n          framesEncoded: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;framesEncoded&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          totalEncodedBytesTarget: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;totalEncodedBytesTarget&quot;</span>,\n            <span class=\"synConstant\">&quot;timestamp&quot;</span>\n          ),\n          totalEncodeTime: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;totalEncodeTime&quot;</span>,\n            <span class=\"synConstant\">&quot;framesEncoded&quot;</span>,\n            CalculatorModifier.kMillisecondsFromSeconds\n          ),\n          qpSum: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;qpSum&quot;</span>, <span class=\"synConstant\">&quot;framesEncoded&quot;</span>),\n          codecId: <span class=\"synStatement\">new</span> CodecCalculator()\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;inbound-rtp&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          bytesReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          packetsReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;packetsReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          framesDecoded: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;framesDecoded&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          totalDecodeTime: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;totalDecodeTime&quot;</span>,\n            <span class=\"synConstant\">&quot;framesDecoded&quot;</span>,\n            CalculatorModifier.kMillisecondsFromSeconds\n          ),\n          qpSum: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;qpSum&quot;</span>, <span class=\"synConstant\">&quot;framesDecoded&quot;</span>),\n          codecId: <span class=\"synStatement\">new</span> CodecCalculator()\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;transport&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          bytesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          bytesReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>)\n          <span class=\"synComment\">// </span><span class=\"synTodo\">TODO</span><span class=\"synComment\">(https://crbug.com/webrtc/10568): Add packetsSent and</span>\n          <span class=\"synComment\">// packetsReceived once implemented.</span>\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>,\n      <span class=\"synIdentifier\">{</span>\n        type: <span class=\"synConstant\">&quot;candidate-pair&quot;</span>,\n        metricCalculators: <span class=\"synIdentifier\">{</span>\n          bytesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          bytesReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;bytesReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          <span class=\"synComment\">// </span><span class=\"synTodo\">TODO</span><span class=\"synComment\">(https://crbug.com/webrtc/10569): Add packetsSent and</span>\n          <span class=\"synComment\">// packetsReceived once implemented.</span>\n          requestsSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;requestsSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          requestsReceived: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;requestsReceived&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          responsesSent: <span class=\"synStatement\">new</span> RateCalculator(<span class=\"synConstant\">&quot;responsesSent&quot;</span>, <span class=\"synConstant\">&quot;timestamp&quot;</span>),\n          responsesReceived: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;responsesReceived&quot;</span>,\n            <span class=\"synConstant\">&quot;timestamp&quot;</span>\n          ),\n          consentRequestsSent: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;consentRequestsSent&quot;</span>,\n            <span class=\"synConstant\">&quot;timestamp&quot;</span>\n          ),\n          consentRequestsReceived: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;consentRequestsReceived&quot;</span>,\n            <span class=\"synConstant\">&quot;timestamp&quot;</span>\n          ),\n          totalRoundTripTime: <span class=\"synStatement\">new</span> RateCalculator(\n            <span class=\"synConstant\">&quot;totalRoundTripTime&quot;</span>,\n            <span class=\"synConstant\">&quot;responsesReceived&quot;</span>,\n            CalculatorModifier.kMillisecondsFromSeconds\n          )\n        <span class=\"synIdentifier\">}</span>\n      <span class=\"synIdentifier\">}</span>\n    <span class=\"synIdentifier\">]</span>;\n\n    statsCalculators.forEach(statsCalculator =&gt; <span class=\"synIdentifier\">{</span>\n      <span class=\"synIdentifier\">this</span>.currentReport.getByType(statsCalculator.type).forEach(stats =&gt; <span class=\"synIdentifier\">{</span>\n        <span class=\"synType\">Object</span>.keys(statsCalculator.metricCalculators).forEach(\n          originalMetric =&gt; <span class=\"synIdentifier\">{</span>\n            <span class=\"synIdentifier\">let</span> metricCalculators =\n              statsCalculator.metricCalculators<span class=\"synIdentifier\">[</span>originalMetric<span class=\"synIdentifier\">]</span>;\n            <span class=\"synStatement\">if</span> (!<span class=\"synType\">Array</span>.isArray(metricCalculators)) <span class=\"synIdentifier\">{</span>\n              metricCalculators = <span class=\"synIdentifier\">[</span>metricCalculators<span class=\"synIdentifier\">]</span>;\n            <span class=\"synIdentifier\">}</span>\n            metricCalculators.forEach(metricCalculator =&gt; <span class=\"synIdentifier\">{</span>\n              <span class=\"synIdentifier\">this</span>.currentReport.addCalculatedMetric(\n                stats.id,\n                originalMetric,\n                metricCalculator.getCalculatedMetricName(),\n                metricCalculator.calculate(\n                  stats.id,\n                  <span class=\"synIdentifier\">this</span>.previousReport,\n                  <span class=\"synIdentifier\">this</span>.currentReport\n                )\n              );\n            <span class=\"synIdentifier\">}</span>);\n          <span class=\"synIdentifier\">}</span>\n        );\n      <span class=\"synIdentifier\">}</span>);\n    <span class=\"synIdentifier\">}</span>);\n  <span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>\n</pre>\n<ul>\n<li>`RTCStartsReport`ã®`type`ã”ã¨ã«</li>\n<li>ã©ã†ã„ã†ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–ã‚ŠãŸã„ã‹ã‚’å®šç¾©ã—ã¦</li>\n<li>ãã®è¨ˆç®—ã‚’ã—ãŸæƒ…å ±ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹</li>\n</ul><p>ã“ã“ã«è¼‰ã›ã¦ã‚‹ä»¥å¤–ã«ä¾å­˜ã—ã¦ã‚‹`XxxCalculator`ã®ã‚³ãƒ¼ãƒ‰ã‚‚ã‚ã‚ã›ã‚Œã°ã€èª°ã§ã‚‚webrtc-internalsã§è¦‹ã‚Œã‚‹æƒ…å ±ã‚’ã‚·ãƒ¥ãƒƒã¨è¡¨ç¤ºã™ã‚‹rtcstats-wrapperãŒä½œã‚Œã‚‹ï¼</p><p>ã¾ã‚ã‹ãªã‚Šç„äººå‘ã‘ã®æƒ…å ±ã§ã¯ã‚ã‚‹ã®ã§ã€ã„ã„æ„Ÿã˜ã«è¨³ã™ãªã‚‰ã ã„ãŸã„è‡ªä½œã™ã‚‹ã‹ãªãƒ¼ã£ã¦æ„Ÿã˜ã§ã¯ã‚ã‚‹ã‘ã©ã€ã¨ã¦ã‚‚å‚è€ƒã«ãªã‚‹ã‚³ãƒ¼ãƒ‰ãªã¯ãšã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>TimelineGraphView</h4>\n    <p>ã‚ã®ã‚°ãƒ©ãƒ•ã‚’æç”»ã—ã¦ã‚‹ã‚¯ãƒ©ã‚¹ã€‚</p><p>å®Ÿè£…ã‚‚ãã®ã¾ã‚“ã¾ã§ã€`canvas`ã«å¯¾ã—ã¦ã„ã„æ„Ÿã˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚ç³»åˆ—ã§ãƒ—ãƒ­ãƒƒãƒˆã™ã‚‹ã ã‘ã€‚</p><p>ç¸¦è»¸ã®ç›®ç››ã‚Šã®å˜ä½ã‚’ãƒ‡ãƒ¼ã‚¿ã«å¿œã˜ã¦ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹å‡¦ç†ã¨ã‹å‚è€ƒã«ãªã‚Šã¾ã™ã­ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>DumpCreator.onDownloadData_</h4>\n    <p>ãƒ€ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã€‚</p><p>ãŸã ã‚„ã£ã¦ã‚‹ã“ã¨ã¯ãªã‚“ã¦ã“ã¨ãªãã¦ã€è²¯ã‚ã¦ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`JSON.stringify()`ã—ã¦`Blob`ã«ã—ã¦`a`è¦ç´ ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã¦ã‚‹ã ã‘ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>onDownloadData_: <span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n  <span class=\"synIdentifier\">var</span> dump_object = <span class=\"synIdentifier\">{</span>\n    getUserMedia: userMediaRequests,\n    PeerConnections: peerConnectionDataStore,\n    UserAgent: navigator.userAgent\n  <span class=\"synIdentifier\">}</span>;\n  <span class=\"synIdentifier\">var</span> textBlob = <span class=\"synStatement\">new</span> Blob(<span class=\"synIdentifier\">[</span>JSON.stringify(dump_object, <span class=\"synStatement\">null</span>, <span class=\"synConstant\">&quot; &quot;</span>)<span class=\"synIdentifier\">]</span>, <span class=\"synIdentifier\">{</span>\n    type: <span class=\"synConstant\">&quot;octet/stream&quot;</span>\n  <span class=\"synIdentifier\">}</span>);\n  <span class=\"synIdentifier\">var</span> URL = <span class=\"synStatement\">window</span>.URL.createObjectURL(textBlob);\n\n  <span class=\"synIdentifier\">var</span> anchor = <span class=\"synIdentifier\">this</span>.root_.getElementsByTagName(<span class=\"synConstant\">&quot;a&quot;</span>)<span class=\"synIdentifier\">[</span>0<span class=\"synIdentifier\">]</span>;\n  anchor.href = URL;\n  anchor.download = <span class=\"synConstant\">&quot;webrtc_internals_dump.txt&quot;</span>;\n  <span class=\"synComment\">// The default action of the anchor will download the URL.</span>\n<span class=\"synIdentifier\">}</span>,\n</pre><p>ã“ã‚Œã¨åŒã˜å½¢å¼ã§ãƒ€ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Œã°ã€è‡ªåˆ†ãŸã¡ã®SDKã‹ã‚‰ãƒ€ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã§ãã‚‹ã€‚</p><p>ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã¨ãƒ‘ã‚±ãƒƒãƒˆã®ãƒ€ãƒ³ãƒ—æ©Ÿèƒ½ã¯ã€`chrome.send()`ã—ã¦ã‚‹ã ã‘ã ã£ãŸã®ã§ã€ã©ã†ã‚„ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã‚„ã£ã¦ã‚‹æ¨¡æ§˜ã€‚</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>ã‚„ã£ã¦ã¿ãŸ</h3>\n    <p><blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Tweaked chrome://webrtc-internals on Firefox ğŸ˜‚ <a href=\"https://t.co/XwNaZ3nl0e\">pic.twitter.com/XwNaZ3nl0e</a></p>&mdash; ã‚Šãƒ (@leader22) <a href=\"https://twitter.com/leader22/status/1214452891555004416?ref_src=twsrc%5Etfw\">January 7, 2020</a></blockquote><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></p><p>é©å½“ã«`addPeerConnection()`ã—ã¦ã€`addStandardStats()`ã«`pc.getStats()`ã‚’ã¡ã‚‡ã£ã¨æ•´å½¢ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•ã’è¾¼ã‚ã°ã€ã„ã„æ„Ÿã˜ã«è¡¨ç¤ºã•ã‚ŒãŸã€‚</p><p>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯é¸ã°ãšã€`getStats()`ã—ãŸãƒ‡ãƒ¼ã‚¿ã•ãˆã‚ã‚Œã°ã€ã„ã¤ã§ã‚‚ã©ã“ã§ã‚‚`chrome://webrtc-internals`ã£ã½ã„UIã§è§£æã§ãã‚‹ãƒ»ãƒ»ï¼</p>\n\n</div>"
}
