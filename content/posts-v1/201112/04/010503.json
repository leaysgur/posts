{
  "title": "PHPで複数サイトのRSSをfavicon付きで取得する",
  "html": "<p>PHPで複数のサイトからRSSをfavicon付きで取得して、リストにする方法です。</p><p>PHPの関数でもできるらしいですが、各サイトのそれぞれの形式に対応するとか、文字コードとかなんやらかんやら面倒やったので、<br />\nMagpie RSS：<a href=\"http://magpierss.sourceforge.net/\">http://magpierss.sourceforge.net/</a>　を利用しました。</p>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>まず最初に参考にした偉大な先人のサイト</h3>\n    \n    <blockquote>\n        <p>参考：<a href=\"http://dezimo.com/web/rssphp.php\" target=\"_blank\" title=\"複数のRSSを統合して更新日時でソートする方法[PHP] | DEZIMO.COM - FireworksやWEBのことなど -\">複数のRSSを統合して更新日時でソートする方法[PHP] | DEZIMO.COM - FireworksやWEBのことなど -</a><br />\n参考：<a href=\"http://128bit.blog41.fc2.com/blog-entry-229.html\" target=\"_blank\" title=\"リンク先のFaviconを取得・表示できるWebサービス(API)とJavaScript・プラグインまとめ : web memo.Ver.2\">リンク先のFaviconを取得・表示できるWebサービス(API)とJavaScript・プラグインまとめ : web memo.Ver.2</a><br />\n参考：<a href=\"http://magpierss.sourceforge.net/#features\" target=\"_blank\" title=\"Magpie RSS - PHP RSS Parser\">Magpie RSS - PHP RSS Parser</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>ソース</h3>\n    \n    <pre class=\"code lang-php\" data-lang=\"php\" data-unlink>&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Transitional//EN&#34; &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#34;&gt;\n&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; lang=&#34;ja&#34; xml:lang=&#34;ja&#34;&gt;\n&lt;head&gt;\n&lt;meta type charset=&#34;UTF-8&#34;/&gt;\n&lt;title&gt;RSS Feeds Frame&lt;/title&gt;\n&lt;link rel=&#34;stylesheet&#34; href=&#34;style.css&#34; /&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;?php\nrequire_once(&#39;magpierss/rss_fetch.inc&#39;);  //MagpieRSSロード\ndefine(&#39;MAGPIE_OUTPUT_ENCODING&#39;,&#39;UTF-8&#39;);\n//読み込むRSSを配列に格納\n$rssUrl=array(\n\t&#34;http://nyanyanyanya.jp/feed&#34;,\n\t&#34;http://piyopiyopiyo.com/rss.xml&#34;\n);\n\n//表示する記事の&#34;総&#34;件数\n$num=20;\n$HTMLbody =&#34;&#34;;\nif($datacount !== 0){\n\n\tforeach ($rssUrl as $no =&gt; $rss_url) {\n\t\tif ($rss_url != &#39;&#39;) {\n\t\t\t//URLからRSSを取得\n\t\t\t$rss = @fetch_rss($rss_url);\n\t\t\t$rss-&gt;items = array_slice($rss-&gt;items, 0, 1);// 後ろの数字が各RSSから取得する記事数\n\t\t\tif ($rss != NULL) {\n\t\t\t\tfor ($i=0; $i&lt;count($rss-&gt;items); $i++) {\n\t\t\t\t\t//サイトのタイトルをitemsに格納\n\t\t\t\t\t$rss-&gt;items[$i][&#34;site_title&#34;] = $rss-&gt;channel[&#34;title&#34;];\n\t\t\t\t\t$rss-&gt;items[$i][&#34;site_link&#34;] = $rss-&gt;channel[&#34;link&#34;];\n\t\t\t\t}\n\t\t\t\t//itemsだけ別配列に格納\n\t\t\t\t$rssItemsArray[] = $rss-&gt;items;\n\t\t\t}\n\t\t}\n\t}\n\n\t$concatArray = array();\n\tif (is_array($rssItemsArray)) {\n\t\tfor($i=0;$i&lt;count($rssItemsArray);$i++){\n\t\t\t//配列を統合する\n\t\t\t$concatArray = array_merge($concatArray,$rssItemsArray[$i]);\n\t\t}\n\t\tforeach ($concatArray as $no =&gt; $values) {\n\n\t\t\t//「RSS広告は除外する」\n\t\t\tif(preg_match(&#34;/PR:/&#34;, $values[&#34;title&#34;])){\n\t\t\t}else{\n\t\t\t\t$title=$values[&#34;title&#34;];\n\t\t\t\t$link=$values[&#34;link&#34;];\n\t\t\t\t$site_link=$values[&#34;site_link&#34;];\n\t\t\t\t//記事ごとに必要な項目を抽出\n\t\t\t\t$rssArray[]=array($title, $link, $site_link);\n\t\t\t}\n\t\t}\n\n\t\t//配列をユーザー定義関数でソート\n\t\tif ($rssArray) { usort($rssArray, &#39;cmp&#39;); }\n\t\tif (count($rssArray) &gt; $num) {\n\t\t\t$count=$num;\n\t\t} else {\n\t\t\t$count=count($rssArray);\n\t\t}\n\t\t//必要な件数分だけHTML整形\n\t\t$HTMLbody =&#34;&lt;ul id=\\&#34;feed_body\\&#34;&gt;&#34;;\n\t\tfor ($i=0; $i&lt;$count; $i++) {\n\t\t\t$title=$rssArray[$i][0];\n\t\t\t$link=$rssArray[$i][1];\n\t\t\t$site_link=$rssArray[$i][2];\n\t\t\t$favicon=&#34;&lt;img src=\\&#34;http://favicon.hatena.ne.jp/?url=&#34;.$site_link.&#34;\\&#34; /&gt;&#34;;\n\t\t\t$HTMLbody .=&#34;&lt;li class=\\&#34;feed_list\\&#34;&gt;&#34;\n\t\t\t\t.$favicon.\n\t\t\t\t&#34;&lt;span class=\\&#34;entry_title\\&#34;&gt;\n\t\t\t\t  \t\t\t&lt;a href=\\&#34;&#34;.$link.&#34;\\&#34; target=\\&#34;_blank\\&#34;&gt;&#34;.$title.&#34;&lt;/a&gt;\n\t\t\t  \t\t&lt;/span&gt;\n\t\t\t&lt;/li&gt;&#34;;\n\t\t}\n\t\t$HTMLbody .=&#34;&lt;/ul&gt;&#34;;\n\t}\n}else{\n\t$HTMLbody .=&#34;まだ記事がありません。&#34;;\n}\n\n//=======================================================\n// 多次元配列ソート用比較関数\n// この場合は配列の1番目の項目を降順にソート\n//=======================================================\nfunction cmp($a, $b) {\n\tif ($a[0] == $b[0]) return 0;\n\treturn ($a[0] &gt; $b[0]) ? -1 : 1;\n}\n?&gt;\n&lt;?php echo $HTMLbody ?&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>\n<p>基本的には、</p>\n\n    <blockquote>\n        <p>参考：<a href=\"http://dezimo.com/web/rssphp.php\" target=\"_blank\" title=\"複数のRSSを統合して更新日時でソートする方法[PHP] | DEZIMO.COM - FireworksやWEBのことなど -\">複数のRSSを統合して更新日時でソートする方法[PHP] | DEZIMO.COM - FireworksやWEBのことなど -</a></p>\n\n    </blockquote>\n<p>こちらのものを転用しています。<br />\nありがとうございます！</p>\n\n</div>\n<div class=\"section\">\n    <h3>変更箇所</h3>\n    \n<ol>\n<li>各サイトからの記事数を制御できるようにしました。</li>\n<li>faviconを表示させてます。</li>\n<li>最終的に出力するHTMLの記述をひとつのul内に収めました。</li>\n</ol>\n<div class=\"section\">\n    <h4>各サイトからの記事数を制御する。</h4>\n    \n    <pre class=\"code lang-php\" data-lang=\"php\" data-unlink>$rss-&gt;items = array_slice($rss-&gt;items, 0, 1);// 後ろの数字が各RSSから取得する記事数\n//$rss-&gt;items = array_slice($rss-&gt;items, 0, 4);// 4件取得します。\n//$rss-&gt;items = array_slice($rss-&gt;items, 0, 10);// 10件取得します。</pre>\n<p>後ろの数字を変えることで、読み込み件数を制御できます。</p>\n\n</div>\n<div class=\"section\">\n    <h4>faviconを表示する。</h4>\n    <p>Magpie RSSのパラメータ？として、各サイトのフィードから取得するitemsという配列ですが、中身がこうなってます。</p>\n\n    <pre class=\"code lang-php\" data-lang=\"php\" data-unlink>array(\n\ttitle =&gt; &#39;Weekly Peace Vigil&#39;,\n\tlink =&gt; &#39;http://protest.net/NorthEast/calendrome.cgi?span=event&amp;ID=210257&#39;,\n\tdescription =&gt; &#39;Wear a white ribbon&#39;,\n\tdc =&gt; array (\n\t\t\tsubject =&gt; &#39;Peace&#39;\n\t\t),\n\tev =&gt; array (\n\t\tstartdate =&gt; &#39;2002-06-01T11:00:00&#39;,\n\t\tenddate =&gt; &#39;2002-06-01T12:00:00&#39;,\n\t\ttype =&gt; &#39;Protest&#39;,\n\t\tlocation =&gt; &#39;Northampton, MA&#39;\n\t)\n);</pre>\n<p>最初にchannelなる単位でサイトを取得して、そのサイト単位でitemsなる配列にデータを格納してるみたいです。</p><p>ということで、faviconが入ってなーい！<br />\nフィードの一覧なので、favicon無しはさみしい・・。</p><p>てなわけで。</p>\n\n    <blockquote>\n        <p>参考：<a href=\"http://128bit.blog41.fc2.com/blog-entry-229.html\" target=\"_blank\" title=\"リンク先のFaviconを取得・表示できるWebサービス(API)とJavaScript・プラグインまとめ : web memo.Ver.2\">リンク先のFaviconを取得・表示できるWebサービス(API)とJavaScript・プラグインまとめ : web memo.Ver.2</a></p>\n\n    </blockquote>\n<p>こちらから、はてなの非公式？faviconサービスAPIを。</p>\n\n    <pre class=\"code lang-php\" data-lang=\"php\" data-unlink>$favicon=&#34;&lt;img src=\\&#34;http://favicon.hatena.ne.jp/?url=&#34;.$site_link.&#34;\\&#34; /&gt;&#34;;</pre>\n\n    <pre class=\"code\" data-unlink>http://favicon.hatena.ne.jp/?url=[取得したいサイトのURL]</pre>\n<p>これを、imgタグのソースに指定します。</p><p>faviconが取得できなかったときに、デフォルト画像を返してくれるところも素晴らしいー！</p>\n\n</div>\n<div class=\"section\">\n    <h4>最終的なHTMLをulタグに収める。</h4>\n    <p>これは割愛。<br />\n最後のfor文の外に出すだけ。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>おわりに</h3>\n    <p>Magpie RSSの設置方法などは、色々なところで記事があるので書いてません。<br />\nいやー便利な世の中だわ。</p>\n\n</div>\n</div>"
}
