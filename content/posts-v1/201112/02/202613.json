{
  "title": "ハッスルサーバーのcronでPHPファイルを動かすときの注意",
  "html": "<p>わかんないことはネットで調べれば良いやーと、思ってた時期が私にもありました・・。</p><p>確かに大半のことは調べればわかります。<br />\nただ、その情報の真偽や、ほんとうに同じシチュエーションのものかなど、確認すべき点を忘れがちになります。</p><p>これは最近の自分への戒めじゃー・・・・。</p><p>というわけで、Twitterのbotを作った際に、ハッスルサーバーのcronでPHPを動かそうとしてハマった点、メモっときます。</p>\n\n<div class=\"section\">\n    <h3>やること</h3>\n    \n<ol>\n<li>動かすプログラムを作る</li>\n<li>cronで動かすシェルを作る</li>\n<li>管理画面で設定する</li>\n</ol><p>リストとしては簡単なのにね・・。<br />\n1は割愛します。<br />\n今回は、アクセスするとつぶやく「phpのファイル」を動かしたいケースです。</p>\n\n</div>\n<div class=\"section\">\n    <h3>シェル：.shファイルを作る</h3>\n    <p>最初の勘違い。</p><p>ハッスルサーバーにログインすると、←メニューの中に「cronの設定」っていうのがあります。<br />\nおもむろに設定するリンクをクリック。</p><p>起動させたい時間や条件を設定。<br />\nそして最後に、「実行するコマンド」を設定します。</p>\n\n    <blockquote>\n        <p>実行するコマンドは/home/(ユーザーID)/ から始まるものか /usr/local/bin などから始まるコマンド名を指定してください</p>\n\n    </blockquote>\n<p>結論から言うと、<b>ここに直接「動かしたいPHPファイルのパス」を書いてもダメ</b>です。<br />\nほんと無知ってこわい！</p><p>完全な先入観で、なんでもOKかと思ってたのですが、cronで何かをどうにか定期的に動かしたい場合、その「何かをどう動かすか」を記述したファイルが必要とのこと。<br />\nそれがシェルと呼ばれる拡張子が.shのファイル、と。</p>\n\n<div class=\"section\">\n    <h4>そしてそのシェルの書き方にもハマった！</h4>\n    <p>最終的に、こう書いて動作してくれました。</p>\n<pre class=\"code lang-sh\" data-lang=\"sh\" data-unlink><span class=\"synComment\">#!/bin/sh</span>\n<span class=\"synStatement\">cd</span> /home/<span class=\"synStatement\">[</span>自分のID<span class=\"synStatement\">]</span>/public/www/<span class=\"synStatement\">[</span>ファイルを置いてるディレクトリ<span class=\"synStatement\">]</span> ; /usr/<span class=\"synStatement\">local</span>/bin/php ./<span class=\"synStatement\">[</span>動かしたいやつ.php<span class=\"synStatement\">]</span>\n<span class=\"synStatement\">exit</span>\n</pre>\n<pre>www/[ファイルを置いてるディレクトリ]/**.sh <- シェル\n　　　　　　　　　　　　　　　　　　 /**.php <- 動かしたいやつ\n</pre><p>シェル自体、本来はwww直下に置かないべきものらしいので、他のケースは適宜対応すべし。<br />\nここで記述すべきは「動かしたい対象ファイルの情報」、ってことを覚えてればよさそう。</p><p>これをそのままコピペする場合、ディレクトリ構成もあわせてください。</p><p>1・3行目はお決まりなので深追いしません。<br />\n問題は2行目！</p>\n\n<ol>\n<li>動かしたいファイル置き場へcd</li>\n<li>動かすのはPHPなのでそれを指定（パスを通す？</li>\n<li>cdしてるので、相対パスで動かすファイルを指定</li>\n</ol><p>もしかしたら2行目って、</p>\n<pre class=\"code lang-sh\" data-lang=\"sh\" data-unlink>/usr/<span class=\"synStatement\">local</span>/bin/php /home/<span class=\"synStatement\">[</span>自分のID<span class=\"synStatement\">]</span>/public/www/<span class=\"synStatement\">[</span>ファイルを置いてるディレクトリ<span class=\"synStatement\">]</span>/<span class=\"synStatement\">[</span>動かしたいやつ.php<span class=\"synStatement\">]</span>\n</pre><p>って書けたりするんかな？<br />\n面倒で試せない・・・。</p>\n\n</div>\n<div class=\"section\">\n    <h4>改行コードでもハマる</h4>\n    <p>UNIXなので、改行コードは、「LF」にしてください。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>管理画面で設定</h3>\n    <p>今回のケースは、上述の通り動かしたいphpと同じところに。</p>\n\n<div class=\"section\">\n    <h4>パーミッションでもハマる</h4>\n    <p>初期状態だと動かないので、シェルファイルのパーミッションは、705にしてください。<br />\n調べると700でもOKってチラホラですが、動いてくれませんでした・・。</p><p>はてさて、これでやっと管理画面メニューのところに戻れます。<br />\nいわれてるとおり、指定。</p>\n<pre class=\"code\" data-lang=\"\" data-unlink>/home/[自分のID]/public/www//[ファイルを置いてるディレクトリ]/[動かしたいやつを動かすシェル.sh]</pre><p>これでOKです。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>動かない場合</h3>\n    <p>これはもうコツコツとデバッグするしかないと思います。<br />\nコツ？として、<br />\ncronの実行結果（エラー情報とか）は、メールで受信できます。<br />\npostmaster@・・・ってアドレスを設定できるので、そこを要確認。</p><p>コマンドラインでシェル起動とかできないので、最短の15分間隔で設定して、ひたすら試すしか無いです・・。</p><p>まとめるとー、</p>\n\n<ul>\n<li>.shファイルを忘れずに！</li>\n<li>改行コードをLFで。</li>\n<li>2行目のパスの書き方注意！</li>\n<li>パーミッションしっかり！</li>\n</ul><p><s><br />\n<a href=\"https://twitter.com/#!/yukutoshi_bot\" target=\"_blank\" title=\"ゆく年どせいさんbot (yukutoshi_bot)\">ゆく年どせいさんbot (yukutoshi_bot)</a>をどうぞよろしく。</s><br />\nもう運用してません。。</p>\n\n</div>"
}
