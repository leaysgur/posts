{
  "title": "Preactを使いたいのに使えない",
  "html": "<p>という気持ちが高まったので、とりえあず2020年末の情報として、書き残しておくことにした。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>Preactとは</h3>\n    <p><iframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fpreactjs.com%2F\" title=\"Preact\" class=\"embed-card embed-webcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;\"></iframe><cite class=\"hatena-citation\"><a href=\"https://preactjs.com/\">preactjs.com</a></cite></p><p>いわゆるReactの<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B8%A5%A7%A5%CD%A5%EA%A5%C3%A5%AF\">ジェネリック</a>で、`react-dom`が圧縮しないと130KBくらいあるところ、なんと3KB！というもの。</p><p>Reactとの互換レイヤーである`preact/compat`を使っても、余裕でお釣りがくるというわけで、ぜひとも使いたい！となる。</p><p>なんでそんなに軽いのかも書いておくと、</p>\n\n<ul>\n<li>`react-dom`がやってるイベントシステムを実装してない\n<ul>\n<li>DOMネイティブのを使ってる</li>\n</ul></li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B3%A1%BC%A5%C9%A5%B4%A5%EB%A5%D5\">コードゴルフ</a>がんばってる\n<ul>\n<li>読めばわかるけど、結構がんばってる</li>\n</ul></li>\n<li>VDOMの実装も最低限</li>\n</ul><p>というわけで、軽量さにフォーカスして書かれており好感が持てる。</p>\n\n</div>\n<div class=\"section\">\n    <h3>基本的にはよい</h3>\n    <p>Hooksも使えるし、基本的にはなんの問題もなく、そのうえ軽くてよい。</p><p>`className`って書かなくていいとか、`onChange`が本来のDOMの`onchange`と挙動が違うとか、なんでやねんReactみたいなところも解消されてる。</p><p>ちょっと規模が大きくなっても、全てのライブラリを自分で書く場合とか、Viewまわりに関して特に依存がない作りになってるなら問題ない。<br />\nこのラインの内側にいる間は、なんの憂いもなくReactを捨てられる。</p><p>ちなみに`preact/compat`だと、`Suspense`と`lazy`みたいなモッダーンな<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>まで生えてたりする。</p>\n\n</div>\n<div class=\"section\">\n    <h3>TypeScriptとエコシステム</h3>\n    <p>Preactは型定義もちゃんと提供されていて（たまにちょっとおかしいけど）、TypeScriptでも普通に使える。</p><p>なので、上述のような規模のものをTSで書く場合も、なんの問題も起きない。</p><p>ただし、Viewまわり（つまりReact）に依存したライブラリを使いたくなったときに、地獄がはじまるのである・・。</p><p>`preact/compat`は、ReactとPreact感のJSとしての<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>の互換性はあるものの、型定義はまったくの別もの。</p><p>なので、いわゆる「Reactを前提として書かれたライブラリ」のほとんどが、「ReactのXXXっていう型がない！」っていって<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB\">コンパイル</a>できなくなる。</p><p>そしてこの対応がほんとうにだるい・・。<br />\nPreactにしようと思ったけど、やっぱReactに戻すわ・・っていう意思決定をするくらいにはだるい。</p><p>`goober`みたいにReactでもPreactでも使えるように設計されてるものは本当に稀で、`react-`を冠するライブラリは基本的にそのまま使えないと思っていいと思う。</p><p>ありとあらゆるReactの型をPreactのそれに<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A8%A5%A4%A5%EA%A5%A2%A5%B9\">エイリアス</a>する独自の型ファイルを用意するしか道がない。</p><p>もしくは、その使いたいライブラリのPreact向けを自分で書く。</p><p>ただ、MobXのPreactの<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%F3%A5%C7%A5%A3%A5%F3%A5%B0\">バインディング</a>を書いてみた（そしてメンテするのを諦めた）身として、あまりおすすめしないかも・・とだけ書き残しておく。<br />\nPreactとReactの内部構造は違うので、React都合に寄ったコードを見たとき、どう扱っていいのか判断に困るから。（だいたい無駄かもしれないと思いながらも、そのままコピーしてしまう）</p><p>TypeScriptにしたい気持ちが高まってくる規模感のものを、型の問題の対処が面倒すぎるから<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/JavaScript\">JavaScript</a>で！っていう択を選べる人類は、そんなにいないのではないかなーと。</p>\n\n</div>\n<div class=\"section\">\n    <h3>Preactのこの先</h3>\n    <p>Reactの場合、Concurrent Mode（以下CM）ってのが実装される予定・・というロードマップがあるけど、Preactには来るのか？とか。</p><p>Preactの現メジャーバージョンは10で、11を出すにあたってどうする？っていうIssueにその答えがある！</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/preactjs/preact/issues/2621\">The road to Preact 11 &middot; Issue #2621 &middot; preactjs/preact &middot; GitHub</a></p>\n\n    </blockquote>\n<p>CM自体、既存のライブラリとの互換性の問題とかもあるし、そもそも本当に必要なのかまだはっきりしてない・・とのこと。</p><p>まあCMなんか実装しようものなら、サイズ爆増待ったなしでは？っていう気もするし、Preactには来ないのでは？という気がしてる。<br />\nあと冒頭でFast 3KB <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Alternative\">Alternative</a>って言ってるけど、地味にサイズは増えてきており、実はもう4KBくらいあるんやけど。</p><p>ただ実際のところ、Preactを使ってReactから125KBばかりのダイエットに成功したとしても、他のライブラリが軽くそれを取り返してきたりするし、いろいろと悩ましいな〜と思う今日このごろ。<br />\n本気でサイズを減らしたいなら、Svelteでいいのでは？ってなるし。</p>\n\n</div>"
}
