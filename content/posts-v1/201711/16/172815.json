{
  "title": "Jestã‚’ä½¿ã£ã¦ã¿ã¦ã®ãƒãƒã‚Šã©ã“ã‚ãƒ¡ãƒ¢",
  "html": "<p><iframe src=\"https://hatenablog-parts.com/embed?url=http%3A%2F%2Ffacebook.github.io%2Fjest%2F\" title=\"Jest Â· ğŸƒ Delightful JavaScript Testing\" class=\"embed-card embed-webcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;\"></iframe></p><p>Jestã„ã„ã§ã™ã‚ˆã­Jestã€‚<br />\nã‚ã‚Œã“ã‚Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã‹å…¥ã‚Œãªãã¦ã‚‚ã ã„ãŸã„ã®ã“ã¨ãŒã§ãã¦ã€‚</p><p>ã•ã¦ã€ã“ã®1ãƒ¶æœˆãã‚‰ã„ã²ãŸã™ã‚‰Jestã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãç¶šã‘ã¦ã€ãƒãƒã£ãŸã¨ã“ã‚’ãƒ¡ãƒ¢ã€‚<br />\né€†ã«è¨€ãˆã°ã€ã“ã“ã«æ›¸ã„ã¦ãªã„ã“ã¨ã§ã¯ä¸€åˆ‡å›°ã£ã¦ãªãã¦ã€Jestæœ€é«˜ã£ã¦æ„Ÿã˜ã€‚</p><p>Karmaã¿ãŸã„ãªãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆã™ã‚‹æ©Ÿèƒ½ã•ãˆã¤ã‘ã°ã‚‚ã†ä¸€ç”Ÿã¤ã„ã¦ã„ãã¾ã™æ„Ÿã™ã‚‰ã‚ã‚‹ã€‚<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>before / afterã§ã‚‚async</h3>\n    <p>Docsã«ãã‚Œã‚‰ã—ã„ã‚³ãƒ¼ãƒ‰ã¯ãªã„ã‘ã©ã§ãã‚‹ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>beforeAll(done =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synComment\">// some async tasks</span>\n  done();\n<span class=\"synIdentifier\">}</span>);\nbeforeEach(async () =&gt; <span class=\"synIdentifier\">{</span>\n  await asyncTask();\n<span class=\"synIdentifier\">}</span>);\nafterEach(async done =&gt; <span class=\"synIdentifier\">{</span>\n  await asyncTask();\n  asyncTask2(done);\n<span class=\"synIdentifier\">}</span>);\nafterAll(() =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synComment\">// some sync tasks</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>Mochaã¨ã‹ã ã¨`before` / `after`ã‚„ã‘ã©ã€Jestã¯`beforeAll` / `afterAll`ã§ã‚ã‚‹ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>Matcherã‚ã‚Œã“ã‚Œ</h3>\n    \n<div class=\"section\">\n    <h4>`toHaveProperty`ã®ã‚­ãƒ¼</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> obj = <span class=\"synIdentifier\">{</span>\n  arr: <span class=\"synIdentifier\">[</span>\n    <span class=\"synIdentifier\">{</span> x: 1 <span class=\"synIdentifier\">}</span>,\n    <span class=\"synIdentifier\">{</span> x: 2 <span class=\"synIdentifier\">}</span>,\n  <span class=\"synIdentifier\">]</span>,\n  <span class=\"synConstant\">'hyp-hen'</span>: <span class=\"synConstant\">'Hello'</span>\n<span class=\"synIdentifier\">}</span>;\n\nexpect(obj).toHaveProperty(<span class=\"synConstant\">'arr.1.x'</span>, 2);\nexpect(obj).toHaveProperty(<span class=\"synConstant\">'hyp-hen'</span>, <span class=\"synConstant\">'Hello'</span>);\n</pre><p>ã£ã¦ãªæ„Ÿã˜ã§æ•°å€¤ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚ãã®ã¾ã¾æ›¸ã‘ã°ã„ã„ã€‚<br />\nãƒã‚¤ãƒ•ãƒ³ã‚‚æ°—ã«ã›ãšæ›¸ã‘ã‚‹ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h4>`toHaveBeenCalledWith`</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> spy = jest.fn();\nspy(1);\nspy(3);\nspy(5);\n\nexpect(spy).toHaveBeenCalledWith(3);\nexpect(spy).toHaveBeenCalledWith(5);\nexpect(spy).toHaveBeenCalledWith(1);\n</pre><p>ç¶šã‘ã¦å‘¼ã¹ã°æ¬¡ã®`mock.calls`ã‚’è¦‹ã¦ãã‚Œã‚‹ãƒ»ãƒ»ã®ã§ã¯ãªãã€ãã®ãƒ¢ãƒƒã‚¯ãŒãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ãã®å¼•æ•°ã§å‘¼ã°ã‚ŒãŸã‹ã©ã†ã‹ãŒã‚ã‹ã‚‹ï¼ˆé †ä¸åŒï¼‰ã€‚<br />\nã©ã‚Œã‹ã²ã¨ã¤ã§ã‚‚å‘¼ã°ã‚Œã¦ã‚Œã°ã€ãƒ‘ã‚¹ã™ã‚‹ã€‚</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>`mockReturnValue`ã¨`mockImplementation`</h3>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> foo1 = jest.fn().mockReturnValue(<span class=\"synConstant\">'foo'</span>);\n<span class=\"synStatement\">const</span> foo2 = jest.fn().mockImplementation(() =&gt; <span class=\"synConstant\">'foo'</span>);\n</pre><p>ã“ã®2ã¤ã¯åŒã˜ã§ã¯ãªã„ã“ã¨ã«æ°—ã¥ã‹ãšãƒ‰ãƒãƒã‚Šã—ã¦ãŸã€‚<br />\n`mockReturnValue()`ã®ã»ã†ãŒçŸ­ãæ›¸ã‘ã¦ã„ã„ã‚„ã‚“ã€ã¨ã€‚</p><p>ã“ã®ã‚³ãƒ¼ãƒ‰ã«é™ã£ã¦ã„ãˆã°åŒã˜çµæœã«ãªã‚‹ã‘ã©ã€ç”¨é€”ã¨ã—ã¦ã¯é–“é•ã£ã¦ã‚‹ã“ã¨ã‚’çŸ¥ã‚‹ã®ãŒå¤§äº‹ã€‚<br />\nä¾‹ãˆã°ã“ã‚“ãªå ´åˆã«ãƒãƒã‚‹ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> err1 = jest.fn().mockReturnValue(Promise.reject(<span class=\"synStatement\">new</span> Error(<span class=\"synConstant\">'err'</span>)));\n<span class=\"synStatement\">const</span> err2 = jest.fn().mockImplementation(() =&gt; Promise.reject(<span class=\"synStatement\">new</span> Error(<span class=\"synConstant\">'err'</span>)));\n</pre><p>å‰è€…ã¯ã€é–¢æ•°ã‚’å‘¼ã¶ã¾ã§ã‚‚ãªãã‚¨ãƒ©ãƒ¼ãªã®ã§ã€ãƒ†ã‚¹ãƒˆãŒã‚³ã‚±ã¦ã€Œãªã‚“ã§ï¼Ÿï¼Ÿï¼Ÿã€ã£ã¦ãªã‚Šã¾ã™ã€‚</p><p>ãã®åã®é€šã‚Šã€</p>\n\n<ul>\n<li>`mockReturnValue()`ã¯å€¤ã‚’è¿”ã™ã ã‘ã§ã„ã„ã¨ã</li>\n<li>`mockImplementation()`ã¯é–¢æ•°ã‚’è¿”ã—ãŸã„ã¨ã\n<ul>\n<li>å¼•æ•°ã‚’ã•ã‚ã‚ŠãŸã„ã¨ã</li>\n</ul></li>\n</ul><p>ã«ä½¿ã„ã¾ã—ã‚‡ã†ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>`spyOn`ã™ã‚‹ã ã‘ã§ã¯ãƒ€ãƒ¡</h3>\n    \n    <blockquote>\n        <p>Note: By default, jest.spyOn also calls the spied method. This is different behavior from most other test libraries.</p>\n\n    </blockquote>\n<p>ã£ã¦ã€ <a href=\"http://facebook.github.io/jest/docs/en/jest-object.html#jestspyonobject-methodname\">The Jest Object &middot; Jest</a> ã«æ€ã„ã£ãã‚Šæ›¸ã„ã¦ã‚ã‚‹ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> obj = <span class=\"synIdentifier\">{</span>\n  foo() <span class=\"synIdentifier\">{</span> console.log(<span class=\"synConstant\">'foo!'</span>); <span class=\"synIdentifier\">}</span>,\n<span class=\"synIdentifier\">}</span>;\n\n<span class=\"synComment\">// spyOnã—ãŸã ã‘ã ã¨</span>\njest.spyOn(obj, <span class=\"synConstant\">'foo'</span>);\n<span class=\"synComment\">// å‘¼ã°ã‚Œã¡ã‚ƒã†</span>\nobj.foo(); <span class=\"synComment\">// foo!</span>\n\n<span class=\"synComment\">// å‘¼ã³ãŸããªã„ãªã‚‰å®Ÿè£…ã‚’ç”¨æ„ã™ã‚‹</span>\njest.spyOn(obj, <span class=\"synConstant\">'foo'</span>).mockImplementation();\nobj.foo(); <span class=\"synComment\">// ä½•ã‚‚èµ·ããªã„</span>\n</pre>\n</div>\n<div class=\"section\">\n    <h3>`useFakeTimers`ã¯Dateã‚’ãƒ¢ãƒƒã‚¯ã—ãªã„</h3>\n    \n    <blockquote>\n        <p><a href=\"https://github.com/facebook/jest/issues/2684\">Jest useFakeTimers should also handle Date &middot; Issue #2684 &middot; facebook/jest &middot; GitHub</a></p>\n\n    </blockquote>\n<p>ãªã®ã§ã€`setTimeout`ã¨ã‹ã«ã¯ä½¿ãˆã‚‹ã‘ã©ã€`Date`ã§æ™‚é–“ã‚’è¦‹ã¦ãƒ»ãƒ»ã¿ãŸã„ãªå‡¦ç†ã«ã¯ä½¿ãˆãªã„ã€‚<br />\nç¾æ™‚ç‚¹ã§Jestã¨ã—ã¦ã¯å¯¾å¿œã—ãªã„ã‚‰ã—ã„ã®ã§ã€ã©ã†ã«ã‹ã—ã¦ãƒ¢ãƒƒã‚¯ã™ã‚‹ã€‚</p><p>ãŠã™ã™ã‚ã¯ <a href=\"https://github.com/sinonjs/lolex\">https://github.com/sinonjs/lolex</a> ã§ã™ã€‚ã¨ã„ã†ã‹ã€ã“ã‚Œã—ã‹é¸æŠè‚¢ãªã•ãã†ã€‚</p>\n\n</div>\n<div class=\"section\">\n    <h3>`proxyquire`çš„ãªã“ã¨ãŒã—ãŸã„</h3>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synComment\">// api.js</span>\n<span class=\"synStatement\">const</span> request = require(<span class=\"synConstant\">'request-promise-native'</span>);\n\nmodule.exports = <span class=\"synIdentifier\">{</span>\n  getFoo() <span class=\"synIdentifier\">{</span>\n    <span class=\"synStatement\">return</span> request.get(<span class=\"synConstant\">'/foo'</span>);\n  <span class=\"synIdentifier\">}</span>\n<span class=\"synIdentifier\">}</span>;\n</pre><p>ã“ã†ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã«ã©ã†ã™ã‚‹ã‹ã€‚<br />\né¸æŠè‚¢ã¯ã„ãã¤ã‹ã‚ã‚‹ã€‚</p>\n\n<div class=\"section\">\n    <h4>`jest.mock`ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³</h4>\n    <p>`node_modules`ãªã‚„ã¤ãªã®ã§ã€`__mocks__`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ¢ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹ã€‚<br />\nãã†ã˜ã‚ƒãªã„ãªã‚‰ã€`jest.mock()`ã§ãƒ¢ãƒƒã‚¯ã™ã‚‹ã€‚</p><p>å€‹äººçš„ã«ã¯ã€å½±éŸ¿ç¯„å›²ãŒåºƒã™ãã¦ã‚ã¾ã‚Šå¥½ãã§ã¯ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‚ã€‚</p>\n\n    <blockquote>\n        <p><a href=\"http://facebook.github.io/jest/docs/en/manual-mocks.html\">Manual Mocks &middot; Jest</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h4>`spyOn`ã§å‡Œããƒ‘ã‚¿ãƒ¼ãƒ³</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synIdentifier\">let</span> getSpy;\nbeforeEach(async () =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synStatement\">const</span> request = require(<span class=\"synConstant\">'request-promise-native'</span>);\n  getSpy = jest.spyOn(request, <span class=\"synConstant\">'get'</span>);\n<span class=\"synIdentifier\">}</span>);\nafterEach(() =&gt; <span class=\"synIdentifier\">{</span>\n  getSpy.mockRestore();\n<span class=\"synIdentifier\">}</span>);\n\ntest(<span class=\"synConstant\">'should get foo'</span>, async () =&gt; <span class=\"synIdentifier\">{</span>\n  getSpy.mockImplementationOnce(() =&gt; Promise.resolve(<span class=\"synConstant\">'foo'</span>));\n\n  <span class=\"synStatement\">const</span> foo = await api.getFoo();\n  expect(foo).toBe(<span class=\"synConstant\">'foo'</span>);\n  expect(getSpy).toHaveBeenCalledTimes(1);\n<span class=\"synIdentifier\">}</span>);\n</pre><p>ã“ã®ã‚ˆã†ã«ã€å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹å‰ã«ã€ä¸­ã§ä½¿ã£ã¦ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’`spyOn`ã§ãƒ¢ãƒƒã‚¯ã™ã‚‹ã€‚<br />\nï¼ˆ`require()`ã™ã‚‹åº¦ã«é•ã†å‚ç…§ãŒè¿”ã£ã¦ãã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ç„¡ç†ã‚„ã‘ã©ãã‚“ãªã‚“ã¯ç¨€ãªã¯ãšï¼‰</p><p>åŸºæœ¬çš„ã«ã€</p>\n\n<ul>\n<li>æº–å‚™æ®µéšã§ã¯`mockImplementation()`</li>\n<li>å„ãƒ†ã‚¹ãƒˆæ®µéšã§ã¯`mockImplementationOnce()`</li>\n</ul><p>ã£ã¦æ„Ÿã˜ã®ä½¿ã„åˆ†ã‘ã«ã™ã‚‹ã®ãŒå¥½ãã€‚</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>autoMockã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ªãƒ•</h3>\n    <p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæƒ…å ±ã ã¨å¤ã„è¨˜äº‹ãŒå¼•ã£ã‹ã‹ã‚‹ã“ã¨ã‚‚å¤šãã¦ã€ç„¡é§„ãªæƒ…å ±ã§æ··ä¹±ã™ã‚‹ã€‚</p><p>ã‹ã¤ã¦ã®Jestã¯ã€`require()`ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåŸºæœ¬çš„ã«å…¨éƒ¨ãƒ¢ãƒƒã‚¯ã ã£ãŸã‚‰ã—ã„ã€‚<br />\nãªã®ã§ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã¶ãŸã³ã«`unmock()`ã—ãªã„ã¨ã„ã‘ãªãã¦ãƒ»ãƒ»ã¿ãŸã„ãªè¨˜äº‹ãŒã„ã£ã±ã„å‡ºã¦ãã‚‹ã€‚</p><p>ãŒã€v15ã‹ã‚‰ã¯ãã‚“ãªã“ã¨ã‚‚ãªãã€ä»–ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨åŒã˜ã‚ˆã†ã«ã€æ™®æ®µã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ã‚ˆã†ã«ä½•ã‚‚ã—ãªããªã£ã¦ã‚‹ã€‚</p>\n\n    <blockquote>\n        <p><a href=\"https://facebook.github.io/jest/blog/2016/09/01/jest-15.html#disabled-automocking\">Jest 15.0: New Defaults for Jest &middot; Jest</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>jest.xxx()ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—</h3>\n    <p>`jest.mock()`ã¨ã‹ã€`jest.useFakeTimers()`ã¨ã‹ã€‚</p><p>ãã—ã¦ã€è¨˜è¿°ã¯ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«å·»ãä¸Šã’ã‚‰ã‚Œã‚‹ã€‚<br />\nã“ã®æŒ™å‹•ãŒæœ¬å½“ã«ã‚­ãƒ¢ã§ã€ã“ã‚Œã‚’çŸ¥ã‚‰ãªã„ã¨ãƒ‰ãƒãƒãƒªã™ã‚‹ã¯ãšã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synComment\">// a.test.js</span>\ntest(<span class=\"synConstant\">'caseA-1'</span>, () =&gt; <span class=\"synIdentifier\">{</span>\n  jest.useFakeTimers();\n<span class=\"synIdentifier\">}</span>);\n\ntest(<span class=\"synConstant\">'caseA-2'</span>, () =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synComment\">// use FakeTimers</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ãŸãã¨é–¢ä¿‚ãªã„ã€‚</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synComment\">// b.test.js</span>\ntest(<span class=\"synConstant\">'caseB-1'</span>, () =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synComment\">// use RealTimers</span>\n<span class=\"synIdentifier\">}</span>);\n</pre>\n</div>\n<div class=\"section\">\n    <h3>CircleCIã§ã‚³ã‚±ã‚‹</h3>\n    <p>ã‚·ãƒªã‚¢ãƒ«ã§å®Ÿè¡Œã•ã›ãªã„ã¨éƒ½åˆã®æ‚ªã„ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ã¨ã‚³ã‚±ã‚‹ã®ã§ã€`--runInBand`ã‹`-i`ã®ã©ã¡ã‹ã‚‰ã‚’ã¤ã‘ã¦å®Ÿè¡Œã™ã‚‹ã€‚</p>\n\n</div>"
}
