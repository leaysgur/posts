{
  "title": "WebRTCのDataChannelをunreliableモードで使う",
  "html": "<p>Specによると、</p>\n\n    <blockquote>\n        <p>An RTCDataChannel can be configured to operate in different reliability modes.</p><p>A reliable channel ensures that the data is delivered at the other peer through retransmissions.<br />\nAn unreliable channel is configured to either limit the number of retransmissions ( maxRetransmits ) or set a time during which transmissions (including retransmissions) are allowed ( maxPacketLifeTime ).</p><p>These properties can not be used simultaneously and an attempt to do so will result in an error.<br />\nNot setting any of these properties results in a reliable channel.</p>\n\n    </blockquote>\n<p>というわけで、何も指定してない場合は、`reliable`モードになってる。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>オプションを渡すだけ</h3>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> pc = <span class=\"synStatement\">new</span> RTCPeerConnection();\n\n<span class=\"synComment\">// このどっちかが指定されてれば、`unreliable`になる</span>\npc.createDataChannel(<span class=\"synConstant\">'unreliable-dc'</span>, <span class=\"synIdentifier\">{</span>\n  maxRetransmits: 10,\n  maxPacketLifeTime: 10,\n<span class=\"synIdentifier\">}</span>);\n</pre>\n    <blockquote>\n        <p><a href=\"https://www.w3.org/TR/webrtc/#dom-rtcdatachannelinit\">WebRTC 1.0: Real-time Communication Between Browsers</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>どうやって確認するか</h3>\n    <p>ChromeとFirefoxだと、コードでわかる。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> pc = <span class=\"synStatement\">new</span> RTCPeerConnection();\n\n<span class=\"synStatement\">const</span> dc = pc.createDataChannel(<span class=\"synConstant\">'unreliable-dc'</span>, <span class=\"synIdentifier\">{</span>\n  maxRetransmits: 10,\n<span class=\"synIdentifier\">}</span>);\n\ndc.reliable; <span class=\"synComment\">// false</span>\n</pre><p>ただしこの`reliable`はSpecにも載ってないので、ご利用は計画的に・・。<br />\n少なくともSafariには生えてなかったので、その場合はどうやって確認すればいいんやろね？</p>\n\n    <blockquote>\n        <p><a href=\"https://www.w3.org/TR/webrtc/#dom-rtcdatachannel\">WebRTC 1.0: Real-time Communication Between Browsers</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>Chromeは罠あります</h3>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">const</span> pc = <span class=\"synStatement\">new</span> RTCPeerConnection();\n<span class=\"synStatement\">const</span> dc = pc.createDataChannel(<span class=\"synConstant\">'xxx'</span>, <span class=\"synIdentifier\">{</span>\n  maxRetransmits: <span class=\"synStatement\">null</span>,\n<span class=\"synIdentifier\">}</span>);\ndc.reliable; <span class=\"synComment\">// false in Chrome, true in Firefox</span>\n</pre><p>Chromeはなぜか「SpecにBooleanって書いてあっても、プロパティが渡るだけで有効化されちゃう」実装が多い気がする・・・。</p>\n\n</div>"
}
