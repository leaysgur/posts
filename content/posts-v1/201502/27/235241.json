{
  "title": "Velocity.jsはnwjs(node-webkit)のv0.8.6では使えない",
  "html": "<p>みんな大好きアニメーションライブラリのVelocity.jsですが、<br />\n残念なことにタイトル通りnwjsのv0.8.6では動きません。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>nwjs</h3>\n    <p>元node-<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/webkit\">webkit</a>ことnwjsは、20150221現在2つの安定版があります。</p>\n\n<ul>\n<li>v0.11.6</li>\n<li>v0.8.6</li>\n</ul><p>いわゆるlatestな方がnodeのv0.11(それでも11)を使っているので、<br />\nnodeの安定版であるv0.10.22をサポートしてるバージョンも同時運用されている、と。</p><p>latestな方ではエラーにならなかったので、特に問題なければlatestな方を。</p>\n\n</div>\n<div class=\"section\">\n    <h3>使えない理由</h3>\n    <p>まぁエラーが出るからなんですが。</p>\n<pre class=\"code\" data-lang=\"\" data-unlink>Uncaught TypeError: object is not a function velocity.js:3691\nUncaught TypeError: Property &#39;resolver&#39; of object #&lt;Object&gt; is not a function velocity.js:3681</pre><p>Velocity.jsは、Promiseが使える環境ではPromiseを使うようになっていて、<br />\nそれが幸か不幸か今回のエラーを引き起こすみたいです。</p><p>アニメーションの終わりのコールバックまわりでPromiseをresolveしようとするけどなんだかしかエラー。</p>\n\n</div>\n<div class=\"section\">\n    <h3>原因に迫る</h3>\n    <p>とりあえず色々調べてみたところ、nwjsのPromiseの実装がバージョンによって微妙に違うらしく、それでエラーになってる模様。</p><p><a href=\"http://img.ly/system/uploads/008/887/167/large_diff-promise.png\" class=\"http-image\" target=\"_blank\"><img src=\"http://img.ly/system/uploads/008/887/167/large_diff-promise.png\" class=\"http-image\" alt=\"http://img.ly/system/uploads/008/887/167/large_diff-promise.png\"></a></p><p>コレはnwjsの独自実装なんかな？</p><p>本家に<a href=\"https://github.com/julianshapiro/velocity/issues/445\" target=\"_blank\" title=\"Is nwjs(node-webkit) supported? · Issue #445 · julianshapiro/velocity\">Issue</a>立てて聞いてみたけど、<br />\nそれはこっちの問題じゃねーっす！とのこと。</p><p>まぁごもっともなんですけど・・・、<br />\nコード読む限り、window.PromiseがtrueなだけでPromise使うってちょっと脆すぎやしねーかと思いつつ、<br />\nまあ取り付く島もない雰囲気を察したので諦めました。</p>\n\n    <blockquote>\n        <p>もっと枯れてる<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>ならともかく、あのPromiseですよーなんかいまいち納得できんぜよー</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>対処方法</h3>\n    <p>私のケースはちょっと特殊で、上記Issueに書いた通りiframeで埋めた先でVelocityを使ってて、<br />\nその中のPromiseに手が届かなくてダメだったのですが、<br />\nそうじゃないならまだなんとかなります。</p>\n\n<div class=\"section\">\n    <h4>Promiseをなかったことにする</h4>\n    <pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>Velocity.Promise = <span class=\"synStatement\">null</span>;\n</pre><p>ライブラリのロード後になかったことにする。<br />\n過激派かも知れんけどどのみちモバイルサイトとかでPromise実装されてるわけない + 使ってないならアリかも？</p>\n\n</div>\n<div class=\"section\">\n    <h4>Polyfillで</h4>\n    <p><a href=\"https://github.com/petkaantonov/bluebird\">petkaantonov/bluebird &middot; GitHub</a>や<a href=\"https://github.com/cujojs/when\">cujojs/when &middot; GitHub</a>を使って、</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>Velocity.Promise = require(<span class=\"synConstant\">'bluebird'</span>);\n</pre><p>まあ普通はこうすれば良いのでは！</p>\n\n</div>\n</div>"
}
