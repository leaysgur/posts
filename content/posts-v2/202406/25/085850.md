---
title: Rustã§UTF-16å˜ä½ã®æ–‡å­—ã‚’æ‰±ã†
---

ã‚ã‚‰ã™ã˜ã¨ã—ã¦ã¯ã€

- Rustã§JavaScriptã®RegExpãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æ›¸ã„ã¦ãŸ
- `RegExp`ã¯ã€`u`ã‹`v`ãƒ•ãƒ©ã‚°ãŒã¤ãã¨ã€æ­£è¦è¡¨ç¾ã‚’Unicodeå˜ä½ã§å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
- ãã†ã§ãªã„å ´åˆã€UTF-16ã®ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆå˜ä½ã§å‡¦ç†ã™ã‚‹

```js
/^.{1}$/.test('ğ ®·');  // false
/^.{1}$/u.test('ğ ®·'); // true
/^.{1}$/v.test('ğ ®·'); // true
```

ã“ã‚Œã‚’Rustã§ã‚„ã‚‹ã«ã¯ãƒ»ãƒ»ãƒ»ï¼Ÿã¨ã„ã†è©±ã€‚

## Rustã®`char`ã¯Unicode scalar value

> char - Rust
> https://doc.rust-lang.org/std/primitive.char.html

ã¾ãŸã®åã‚’ã€Unicodeã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã®ã“ã¨ã€‚

Rustã§æ–‡å­—ã¨ã„ãˆã°`chars()`ã£ã¦ã“ã¨ã§ã€ã“ã‚Œã‚’ãã®ã¾ã¾ä½¿ã£ãŸå ´åˆã“ã†ãªã‚‹ã€‚

```rs
let s = "Hello, ğŸ‘ˆğŸ»ğ ®·é‡å®¶ã‚ã£ã¡/xyz";

let chars = s.chars().collect::<Vec<_>>();
println!("{chars:?}");
```

å‡ºåŠ›ã•ã‚Œã‚‹ã®ã¯ã€`['H', 'e', 'l', 'l', 'o', ',', ' ', 'ğŸ‘ˆ', 'ğŸ»', 'ğ ®·', 'é‡', 'å®¶', 'ã‚', 'ã£', 'ã¡', '/', 'x', 'y', 'z']`ã¨ã„ã†æ–‡å­—ãŸã¡ã€‚

Emojiã®Skin toneã¨ã‹å›½æ——ã¨ã‹ã¯ãƒãƒ©ã‘ã‚‹ã‘ã©ã€å‰é‡å®¶ã®"ã‚ˆã—"ã¯ã¡ã‚ƒã‚“ã¨åœŸã‹ã‚“ã‚€ã‚Šã§1ã¤ã«ãªã£ã¦ã‚‹ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€Unicodeãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚‹ãªã‚‰ã€`char`ã‚’ã“ã®ã¾ã¾ä½¿ãˆã°ã‚ˆã•ãã†ã€‚
ï¼ˆè¤‡é›‘ãªçµµæ–‡å­—ã‚’è¦‹ãŸã¾ã¾åˆ†å‰²ã™ã‚‹ã®ã¯ã€JSã§ã‚‚`Intl.Segmenter`ã¨ã‹ãã†ã„ã†å®Ÿè£…ãŒãªã„ã¨ã§ããªã„ã—ã€‚ï¼‰

ãã—ã¦`char`ã¯å†…éƒ¨çš„ã«`u32`ãã®ã¾ã¾ã‚‰ã—ã„ã®ã§ã€å ´åˆã«ã‚ˆã£ã¦ã¯`as u32`ã—ã¦å–ã‚Šå›ã™ã»ã†ãŒä¾¿åˆ©ã‹ã‚‚ã—ã‚Œãªã„ã€‚

> https://doc.rust-lang.org/std/primitive.char.html#method.from_u32

## UTF-16å˜ä½

Unicodeãƒ¢ãƒ¼ãƒ‰ã˜ã‚ƒãªã„å ´åˆã¯ã€`encode_utf16()`ã¨ã„ã†APIã§å¤‰æ›ã—ã¦ã‹ã‚‰æ‰±ã†ã€‚

```rs
let s = "Hello, ğŸ‘ˆğŸ»ğ ®·é‡å®¶ã‚ã£ã¡/xyz";
let s = s.encode_utf16();
```

ã“ã‚Œã§`u16`ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒå–å¾—ã§ãã‚‹ã€‚

ãŸã ã“ã£ã¡ã®å ´åˆã€ãƒ«ãƒ¼ãƒ—ã—ã¦ã‚‹1ã¤ã¯ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã®ä¸€éƒ¨ã§ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãšã€ã‚‚ã¯ã‚„`char`ã¨ã—ã¦å¾©å…ƒã§ãã‚‹ä¿è¨¼ã¯ãªããªã£ã¦ã—ã¾ã†ã€‚

`u16`ã¯`as u32`ã«å¤‰æ›ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã®ã§ã€ç”»ä¸€çš„ã«æ‰±ã„ãŸã„ãªã‚‰ã°ãã†ã™ã‚‹ã€‚

## ã¾ã¨ã‚

```rs
fn main() {
    let s = "Hello, ğŸ‘ˆğŸ»ğ ®·é‡å®¶ã‚ã£ã¡/xyz";
    let count = 20;

    println!("--- char(= unicode scalar value) ---");
    // `chars()` returns a `char`, which is a Unicode scalar value, not a Unicode code point.
    // It can be converted to a `u32`(internally `u32`) to see the code point.
    for i in 0..=count {
        let cp = s.chars().nth(i).map(|c| c as u32);
        let ch = cp.and_then(char::from_u32); // Always `Some`
        println!("[{i}]: {:?} = {:?}", cp, ch);
    }

    println!("--- utf16 code unit ---");
    // `encode_utf16()` returns a `u16`, which is a UTF-16 code unit.
    // It can be converted to a `u32`(just extend) to see the code point.
    for i in 0..=count {
        let cp = s.encode_utf16().nth(i).map(|c| c as u32);
        let ch = cp.and_then(char::from_u32); // May be `None`
        println!("[{i}]: {:?} = {:?}", cp, ch);
    }
}
```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã®ã¯ã“ã‚Œã€‚

```
--- char(= unicode scalar value) ---
[0]: Some(72) = Some('H')
[1]: Some(101) = Some('e')
[2]: Some(108) = Some('l')
[3]: Some(108) = Some('l')
[4]: Some(111) = Some('o')
[5]: Some(44) = Some(',')
[6]: Some(32) = Some(' ')
[7]: Some(128072) = Some('ğŸ‘ˆ')
[8]: Some(127995) = Some('ğŸ»')
[9]: Some(134071) = Some('ğ ®·')
[10]: Some(37326) = Some('é‡')
[11]: Some(23478) = Some('å®¶')
[12]: Some(12354) = Some('ã‚')
[13]: Some(12387) = Some('ã£')
[14]: Some(12385) = Some('ã¡')
[15]: Some(47) = Some('/')
[16]: Some(120) = Some('x')
[17]: Some(121) = Some('y')
[18]: Some(122) = Some('z')
[19]: None = None
[20]: None = None

--- utf16 code unit ---
[0]: Some(72) = Some('H')
[1]: Some(101) = Some('e')
[2]: Some(108) = Some('l')
[3]: Some(108) = Some('l')
[4]: Some(111) = Some('o')
[5]: Some(44) = Some(',')
[6]: Some(32) = Some(' ')
[7]: Some(55357) = None
[8]: Some(56392) = None
[9]: Some(55356) = None
[10]: Some(57339) = None
[11]: Some(55362) = None
[12]: Some(57271) = None
[13]: Some(37326) = Some('é‡')
[14]: Some(23478) = Some('å®¶')
[15]: Some(12354) = Some('ã‚')
[16]: Some(12387) = Some('ã£')
[17]: Some(12385) = Some('ã¡')
[18]: Some(47) = Some('/')
[19]: Some(120) = Some('x')
[20]: Some(121) = Some('y')
```

UTF-16ã®ã»ã†ã¯ã€`char`ã«å¤‰æ›ã§ãã¦ãªã„å ´åˆãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚
