---
import { getCollection } from "astro:content";
import { toPath } from "../libs/utils";
import RootLayout from "../components/root-layout/index.astro";
import PostList from "../components/post-list/list.astro";
import PostListItem from "../components/post-list/item.astro";

const NUM_OF_RECENT_POSTS = 12;

const [allPostsV1, allPostsV2] = await Promise.all([
  // In the near future, only posts-v2 posts will be used for recent
  getCollection("posts-v1", (p) => p.id.startsWith("2023")),
  getCollection("posts-v2"),
]);

const allPosts = [
  ...allPostsV1.map((p) => ({
    path: toPath(p.id),
    title: p.data.title,
  })),
  ...allPostsV2.map((p) => ({
    path: toPath(p.slug),
    title: p.data.title,
  })),
]
  .reverse()
  .slice(0, NUM_OF_RECENT_POSTS);
---

<RootLayout>
  <main>
    <h1>最近の記事</h1>
    <PostList>
      {allPosts.map((post) => <PostListItem {...post} />)}
    </PostList>
  </main>
</RootLayout>
