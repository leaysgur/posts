{
  "title": "Babelで top level this が undefinedになって困った件",
  "html": "\n<ul>\n<li>ES6使いたいしBabelでやろう</li>\n<li>でも実行環境は今と同じ</li>\n<li>よってnodeでもブラウザでも動くようにしたい</li>\n</ul><p>よーし、</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>;(<span class=\"synIdentifier\">function</span>(global) <span class=\"synIdentifier\">{</span>\n  \n  <span class=\"synStatement\">class</span> Foo <span class=\"synIdentifier\">{}</span>;\n\n  <span class=\"synIdentifier\">let</span> isNode    = <span class=\"synConstant\">'process'</span>  <span class=\"synStatement\">in</span> global,\n      isBrowser = <span class=\"synConstant\">'document'</span> <span class=\"synStatement\">in</span> global;\n  \n  <span class=\"synStatement\">if</span> (isNode) <span class=\"synIdentifier\">{</span>\n    module.exports = Foo;\n  <span class=\"synIdentifier\">}</span>\n  <span class=\"synStatement\">else</span> <span class=\"synStatement\">if</span> (isBrowser) <span class=\"synIdentifier\">{</span>\n    global.Foo = Foo;\n  <span class=\"synIdentifier\">}</span>\n  \n<span class=\"synIdentifier\">}</span>(<span class=\"synIdentifier\">this</span>.<span class=\"synStatement\">self</span> || global)); <span class=\"synComment\">// このグローバルなthisがバベるとundefinedになる・・・</span>\n</pre><p>さて困りました。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>仕様です</h3>\n    <p><blockquote class=\"twitter-tweet\" lang=\"ja\"><p>top level this が undefined になっちゃう振る舞いは仕様上正しいんだけど、 babel がやるバグだと思ってissueあげちゃう人が多くて、 フラストレーション溜まってるらしいから上げないようにしようね。 <a href=\"https://t.co/3Wm6OKqbza\">https://t.co/3Wm6OKqbza</a></p>&mdash; Yosuke FURUKAWA (@yosuke_furukawa) <a href=\"https://twitter.com/yosuke_furukawa/status/592604148492701698\">2015, 4月 27</a></blockquote><script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></p><p></p>\n\n</div>\n<div class=\"section\">\n    <h3>どうすれば</h3>\n    <p>仕様なのはわかったけど結構困る。</p><p><s>結局、うまいやり方が思いつかんかったのでこうしました。</s><br />\nコメントでナイスなやり方を教えていただきましたのでそれを。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>(<span class=\"synIdentifier\">function</span> (global) <span class=\"synIdentifier\">{</span>\n\n  <span class=\"synComment\">// 今まで通り書ける！</span>\n\n<span class=\"synIdentifier\">}</span>)(<span class=\"synStatement\">typeof</span> global !== <span class=\"synConstant\">'undefined'</span> ? global : <span class=\"synStatement\">window</span>);\n</pre><p><s>もっと分岐が必要になったらもっとtry/catchすればええんや！！1</s></p><p>うまいやり方あったら教えてください。</p>\n\n</div>"
}
