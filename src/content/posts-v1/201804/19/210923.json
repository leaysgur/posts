{
  "title": "SkyWay UG Tokyo #3 に行ってきたメモ #WebRTCSkyWay",
  "html": "\n    <blockquote>\n        <p><a href=\"https://skyway.connpass.com/event/83052/\">SkyWay UG Tokyo #3 - connpass</a></p>\n\n    </blockquote>\n<p>今回はDEJIMAというスペースにて。めっちゃおしゃれ空間やった。<br />\n品川から歩いて20分くらい。</p>\n\n    <blockquote>\n        <p><a href=\"https://dejima.space/\">Innovation Space DEJIMA</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h3>SkyWay初心者からステップアップしよう by @Tukimikage</h3>\n    \n    <blockquote>\n        <p><a href=\"https://qiita.com/yusuke84/items/13fab1d0f97c466e4d4b\">SkyWay&#x521D;&#x5FC3;&#x8005;&#x304B;&#x3089;&#x30B9;&#x30C6;&#x30C3;&#x30D7;&#x30A2;&#x30C3;&#x30D7;&#x3057;&#x3088;&#x3046; - Qiita</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h4>お知らせ</h4>\n    \n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C0%A5%C3%A5%B7%A5%E5\">ダッシュ</a>ボードから利用状況が見えるようになったよ\n<ul>\n<li>直近2ヶ月が見れる</li>\n<li>だいたい1時間ごとに更新</li>\n</ul></li>\n<li>Enterprizeへ移行できるように\n<ul>\n<li>戻せません</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>通信モデル</h4>\n    \n<ul>\n<li>`Peer`が中心となる\n<ul>\n<li>PeerID: <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>キーごとに一意</li>\n</ul></li>\n<li>電話モデルとルームモデル\n<ul>\n<li>電話は1:1で相手にコールする</li>\n<li>ルームはその部屋にジョインする</li>\n</ul></li>\n<li>ルーム\n<ul>\n<li>フルメッシュか<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SFU\">SFU</a>か</li>\n<li>部屋を明示的に消す方法は今のところない</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>通信要件</h4>\n    \n<ul>\n<li>管理系は2つ</li>\n<li>ディスパッチャ\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SDK\">SDK</a>が最初にアクセスする</li>\n<li>複数台ある<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B7%A5%B0%A5%CA%A5%EA%A5%F3%A5%B0\">シグナリング</a>サーバーを選ぶために</li>\n</ul></li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B7%A5%B0%A5%CA%A5%EA%A5%F3%A5%B0\">シグナリング</a>サーバー\n<ul>\n<li>Socket.IO</li>\n</ul></li>\n<li>WebRTC系</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/P2P\">P2P</a>\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/UDP\">UDP</a>ハイポートレンジ内でランダム</li>\n</ul></li>\n<li>STUN\n<ul>\n<li>UDP3478(= STUN<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%C8%A5%B3%A5%EB\">プロトコル</a>)</li>\n</ul></li>\n<li>TURN\n<ul>\n<li>TCP443 or UDP443</li>\n<li>TURNの通信パターンは3つ</li>\n<li>AさんとBさんが<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/P2P\">P2P</a>する場合\n<ul>\n<li>Aのみ（Bのみ）</li>\n<li>AとBが同じTURN</li>\n<li>AとBが別のTURN</li>\n</ul></li>\n<li>できればTURNを使わないネットワーク設計が吉\n<ul>\n<li>エンプラ用途や<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/UDP\">UDP</a>が禁止されてる場合などは仕方ない </li>\n</ul></li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>通信確立まで</h4>\n    \n<ul>\n<li>`Peer`を<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9\">インスタンス</a>化して、`open`イベントを待つ\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B7%A5%B0%A5%CA%A5%EA%A5%F3%A5%B0\">シグナリング</a>サーバーとはSocketでつながりっぱなし</li>\n</ul></li>\n<li>実際のメディアは`stream`イベントから</li>\n<li>実際の通信をモニタするには\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SDK\">SDK</a>では提供してない</li>\n<li>ブラウザの開発者ツールを使う</li>\n</ul></li>\n<li>`<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/chrome\">chrome</a>://webrtc-internals`\n<ul>\n<li>接続シーケンスがリアルタイムに出る</li>\n<li>`iceConnectionState`の状態遷移とかも</li>\n<li>メディアが流れてる場合は、太字のログがあるはず\n<ul>\n<li>`bytesSent` / `bytesReceived`でバイト数を</li>\n</ul></li>\n</ul></li>\n<li>実際の通信容量\n<ul>\n<li>動きの少ない映像の場合</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/QVGA\">QVGA</a>だと450kbps前後</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D5%A5%EBHD\">フルHD</a>までは最大でも1.6Mbps程度</li>\n<li>4Kだと2Mbps前後</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>動作保証ブラウザ</h4>\n    \n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a> / <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>: 最新2バージョン\n<ul>\n<li>今の<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>なら66と65</li>\n</ul></li>\n<li>Edge\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SFU\">SFU</a>ルームの対応予定はナシ</li>\n<li>EdgeがMultiStreamできないから</li>\n</ul></li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SFU\">SFU</a>ルームに非対応</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SFU\">SFU</a>がVP8しか流せないので</li>\n<li>コーデック選択機能を載せる予定</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Tips</h4>\n    \n<ul>\n<li>受信のみモード\n<ul>\n<li>ストリームを渡さずに`joinRoom()`すると、受信のみモードに</li>\n<li>`videoReceiveEnabled` / `audiReceiveEnabled`で個別に受信のみもできる</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SFU\">SFU</a>の場合は<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%EF%A1%BC%A5%AF%A5%A2%A5%E9%A5%A6%A5%F3%A5%C9\">ワークアラウンド</a>が必要</li>\n<li><a href=\"https://support.skyway.io/hc/ja/community/posts/115000612268-%E5%8F%97%E4%BF%A1%E3%81%AE%E3%81%BF%E3%83%A2%E3%83%BC%E3%83%89%E3%82%92%E4%BD%B5%E7%94%A8%E3%81%97%E3%81%9F%E5%A4%9A%E4%BA%BA%E6%95%B0%E3%81%A7%E3%81%AESFU%E3%81%AE%E5%88%A9%E7%94%A8\">&#x53D7;&#x4FE1;&#x306E;&#x307F;&#x30E2;&#x30FC;&#x30C9;&#x3092;&#x4F75;&#x7528;&#x3057;&#x305F;&#x591A;&#x4EBA;&#x6570;&#x3067;&#x306E;SFU&#x306E;&#x5229;&#x7528; &ndash; SkyWay &#x30B5;&#x30DD;&#x30FC;&#x30C8;</a></li>\n</ul></li>\n</ul>\n</div>\n</div>\n<div class=\"section\">\n    <h3>WebRTCリリースで辛かったこと by @jumbOrNot</h3>\n    \n    <blockquote>\n        <p><a href=\"https://speakerdeck.com/jumbo_ken/webrtcririsudexin-katutakoto\">WebRTC&#x30EA;&#x30EA;&#x30FC;&#x30B9;&#x3067;&#x8F9B;&#x304B;&#x3063;&#x305F;&#x3053;&#x3068; // Speaker Deck</a></p>\n\n    </blockquote>\n\n<div class=\"section\">\n    <h4>はじめに</h4>\n    \n<ul>\n<li>レアジョブ英会話はSkyWayを使ってます\n<ul>\n<li>それまでは<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Skype\">Skype</a></li>\n</ul></li>\n<li>リリースして1ヶ月くらい経ったけど辛い</li>\n<li>その「辛み」とどう付き合っていくか</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Skype\">Skype</a>でできたなら</h4>\n    \n<ul>\n<li>なんでもできると思われている・・（社内外から）</li>\n<li>実際はそんなことない\n<ul>\n<li>Edgeだけでなく不安定</li>\n<li>社内ネットワークでつながらないとか</li>\n</ul></li>\n<li>絵文字とかメッセ機能とか通知とかアカウント管理とか\n<ul>\n<li>完全再現は大変</li>\n<li>工夫でカバー</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>デ<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\">バイス</a>差異・複数クライアント</h4>\n    \n<ul>\n<li>クライアント共通部分は共通のコードにする</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>作っておきたい体制</h4>\n    \n<ul>\n<li>「つながらない」というお問い合わせに対して\n<ul>\n<li>絶対にくる</li>\n<li>どういう環境でどういう部分がどのようにダメなのか</li>\n</ul></li>\n<li>各種タイミングをログに落とす\n<ul>\n<li>re:dashとkibanaを使ってます</li>\n</ul></li>\n<li><a href=\"https://www.callstats.io/\">https://www.callstats.io/</a>\n<ul>\n<li>UIはわかりにくいけど・・</li>\n</ul></li>\n</ul>\n</div>\n</div>\n<div class=\"section\">\n    <h3>AngularJS with SkyWay by Mr.Albert from RareJob Philippine</h3>\n    <p>LT1つ目。</p>\n\n<div class=\"section\">\n    <h4>どうやって自動テストするか</h4>\n    \n<ul>\n<li>忘れられがちだけども大切なトピック</li>\n<li>ProtractorでE2Eしてる\n<ul>\n<li>あとJasmine</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>Tips</h4>\n    \n<ul>\n<li>フェイクメディアを使う<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%DE%A5%F3%A5%C9%A5%E9%A5%A4%A5%F3\">コマンドライン</a>引数を使う\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3\">パーミッション</a>のダイアログを回避するために</li>\n<li>実際のカメラを使わないために</li>\n</ul></li>\n<li>`video.readyState === 4`を見る\n<ul>\n<li>ストリームが届いて、再生されたことをチェック</li>\n</ul></li>\n<li>ブラウザは<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Selenium\">Selenium</a>で操作\n<ul>\n<li>他のブラウザでもテストできる</li>\n</ul></li>\n</ul><p>Angularの話はなかったｗ</p><p>自動テストに関してのノウハウは共感できるとこ多かったけど、テストに関してはTestCafeの勝ちですね。（俺の中では）</p>\n\n    <blockquote>\n        <p><a href=\"https://lealog.hateblo.jp/entry/2018/03/23/101954\">WebRTC&#x306A;&#x30B3;&#x30FC;&#x30C9;&#x3092;E2E&#x30C6;&#x30B9;&#x30C8;&#x3059;&#x308B; - console.lealog();</a></p>\n\n    </blockquote>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>SkyWayで作る日本初の在宅遠隔医療システム / 非同期アプリケーション開発とSkyWay by @dynamitter</h3>\n    \n<div class=\"section\">\n    <h4>遠隔在宅医療 w/ SkyWay</h4>\n    \n<ul>\n<li>Telemedicine</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C6%A3%C2%F4%BB%D4\">藤沢市</a>での在宅医療の実証プロジェクト</li>\n<li>テレビ x テレビリモコンを使って簡単に診察を受けられる</li>\n<li>TVを核にしたシステム構想\n<ul>\n<li>全世代で親和性の高いUI</li>\n<li>TVに外付けPTZカメラをつけて4Kで配信</li>\n<li>対面と同じクオリティでないと診察できない</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>実装の困難</h4>\n    \n<ul>\n<li>病院</li>\n<li>患者宅にある母艦となる箱を置く</li>\n<li>その中でWebSocketのサーバーをたてて、各デ<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9\">バイス</a>とつなぐ\n<ul>\n<li>スポットライトをつけたり輝度変えたり</li>\n<li>スピーカーから音出したり</li>\n<li>テレビのON/OFFとか</li>\n<li>カメラのPTZの操作とか</li>\n<li>8Kカメラで撮影とか</li>\n</ul></li>\n</ul><p>すごい情報量で、「ハードウェアから何から何までハックして、なんとか遠隔操作できるようにしました」っていう話だったｗ</p>\n\n</div>\n<div class=\"section\">\n    <h4>実証した結果</h4>\n    \n<ul>\n<li>8Kまでいくと、直接見るより色々とわかりやすい</li>\n<li>SkyWayにしてよかった\n<ul>\n<li>コストが低く使える</li>\n<li>実績と<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/SLA\">SLA</a>がある\n<ul>\n<li>ただし医療分野だとSLA99.99%でも低い</li>\n</ul></li>\n<li>4K映像も流せる</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>SkyWayで困った</h4>\n    \n<ul>\n<li>SDPにTURNが含まれない場合があった\n<ul>\n<li>原因不明</li>\n</ul></li>\n<li>`replaceStream()`がうまく動かなかった\n<ul>\n<li>画面共有や別カメラの切り替えの時</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/JavaScript\">JavaScript</a>で非同期</h4>\n    \n<ul>\n<li>コール<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D0%A5%C3%A5%AF%A5%B9%A5%BF%A5%A4%A5%EB\">バックスタイル</a>は使わない\n<ul>\n<li>Promise / Asyncを</li>\n</ul></li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%A4%A5%D9%A5%F3%A5%C8%A5%CF%A5%F3%A5%C9%A5%E9\">イベントハンドラ</a>直差しもしない\n<ul>\n<li>`addEventListener()`を</li>\n</ul></li>\n<li>SkyWayの`Peer`は`EventEmitter`\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/jQuery\">jQuery</a>のソレの場合、`on()`とか`off()`とかある</li>\n<li>いろんなパターンがあって挙動も違ってわかりにくい</li>\n</ul></li>\n<li>DOMのイベントを使えば、DOMのイベントリスナーがそのまま使える\n<ul>\n<li>ダミーの`a`要素とかを持っておく</li>\n<li>第3引数の`once`とかも</li>\n</ul></li>\n<li>`readyState`をマネた実装をして、Promiseでラップする</li>\n<li>Async / Awaitは並列処理もフロー処理もできないので、そこは自分でやるしかない</li>\n</ul>\n</div>\n</div>\n<div class=\"section\">\n    <h3>SkyWayで一年間運用してきたけどWebRTCってつらいんじゃないの by @sbntaminif</h3>\n    <p>LT2つ目。</p>\n\n<div class=\"section\">\n    <h4><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Weblio\">Weblio</a>英会話でも</h4>\n    \n<ul>\n<li>WebRTCを使ってます</li>\n<li>つらいです</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>つながらない</h4>\n    \n<ul>\n<li>PCのみ、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>のみ、帯域も絞ってる</li>\n<li>のにつながらない</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>なんで</h4>\n    \n<ul>\n<li>ブラウザのバージョンでハマる</li>\n<li>Edgeを<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>と言ってくる人もいた</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4>WebRTCは昔のブラウザ</h4>\n    \n<ul>\n<li>ブラウザが独自実装にはしってたあの頃\n<ul>\n<li>DOMの<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>がバラバラで、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/jQuery\">jQuery</a>誕生待ち</li>\n</ul></li>\n<li>その点SkyWayは<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%AF%A5%ED%A5%B9%A5%D6%A5%E9%A5%A6%A5%B6\">クロスブラウザ</a>！</li>\n<li>みんなで使って知見をためよう</li>\n</ul>\n</div>\n</div>"
}
