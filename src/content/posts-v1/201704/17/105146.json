{
  "title": "ReactNativeでgetUserMedia()する",
  "html": "<p>端末カメラとマイクにアクセスできるWebRTCの`getUserMedia()`ですが、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>にはまだ未実装です。</p><p>なので、現時点ではReactNative的ななんらかの環境の上で動かすしかないです。<br />\nそしてReactNativeでも公式サポートされてるわけではなく、外部のライブラリに頼る必要があります。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/oney/react-native-webrtc\">GitHub - oney/react-native-webrtc: A WebRTC module for React Native.</a></p>\n\n    </blockquote>\n<p>そんな外部ライブラリの中でもWebRTCやるならコレ！っていうイチオシが、`react-native-webrtc`というわけで、これを使って`getUserMedia()`に至るまでのメモです。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>インス<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A1%BC%A5%EB\">トール</a></h3>\n    \n    <blockquote>\n        <p><a href=\"https://github.com/oney/react-native-webrtc/blob/master/Documentation/iOSInstallation.md\">react-native-webrtc/iOSInstallation.md at master &middot; oney/react-native-webrtc &middot; GitHub</a></p>\n\n    </blockquote>\n<p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a>も<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Android\">Android</a>もそれぞれ丁寧なドキュメントがあるけど、それでもつらい。<br />\n<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Xcode\">Xcode</a>力が低いとつらい。</p><p>とりあえずコードは一切書かずに、Build Succeededするまでがんばるしかない。</p><p>なんかよくわからなくなったら、いったん全消ししてやり直すが吉です。</p>\n\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3\">パーミッション</a></h3>\n    <p>`getUserMedia()`では端末のカメラとマイクにアクセスするんですが、権限がなかったり拒否してたりすると即クラッシュします。<br />\nメソッドを叩く前に、ちゃんと許可をとっておく必要があります。</p>\n\n    <blockquote>\n        <p><a href=\"https://github.com/yonahforst/react-native-permissions\">GitHub - yonahforst/react-native-permissions: Check and request user permissions in ReactNative (iOS and Android)</a></p>\n\n    </blockquote>\n<p>こういう便利なライブラリを使って、`camera`と`microphone`の<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3\">パーミッション</a>を。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink><span class=\"synStatement\">import</span> Permissions from <span class=\"synConstant\">'react-native-permissions'</span>;\n\nPromise.all(<span class=\"synIdentifier\">[</span>\n  Permissions.requestPermission(<span class=\"synConstant\">'camera'</span>),\n  Permissions.requestPermission(<span class=\"synConstant\">'microphone'</span>),\n<span class=\"synIdentifier\">]</span>)\n.then((<span class=\"synIdentifier\">[</span>cam, mic<span class=\"synIdentifier\">]</span>) =&gt; <span class=\"synIdentifier\">{</span>\n  <span class=\"synComment\">// do something...</span>\n<span class=\"synIdentifier\">}</span>);\n</pre><p>ちなみにこういうコードに加えて、</p><p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Xcode\">Xcode</a>の設定の`Info` -> `Custom <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> Target Properties`ってとこに、</p>\n\n<ul>\n<li>`Privacy - Camera Usage Description`</li>\n<li>`Privacy - Microphone Usage Description`</li>\n</ul><p>っのを追加しないとダメ。`Value`は空っぽでOK。</p><p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Xcode\">Xcode</a>まじ難しい。<br />\n<br />\n</p>\n\n</div>\n<div class=\"section\">\n    <h3>その他</h3>\n    \n<ul>\n<li>`RTCView`に幅高さを適切に指定してないと、`streamURL`があっても表示が出ない</li>\n<li>`getUserMedia()`は最新の<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>だと`Promise`ベースですが、このライブラリは未対応っぽい\n<ul>\n<li>PRはあったのでそのうち対応されそう</li>\n</ul></li>\n<li>`MediaStreamConstraints`で`video: true`ってするとクラッシュする\n<ul>\n<li>とりあえずONにしたい場合の最低限は、`video: { mandatory: {} }`らしい。謎。</li>\n</ul></li>\n</ul><p>そんなこんなのGistも置いておきます。</p>\n\n    <blockquote>\n        <p><a href=\"https://gist.github.com/leader22/3fbda9b8841bce267289c3f9de07fcec\">getUserMedia() w/ React Native WebRTC &middot; GitHub</a></p>\n\n    </blockquote>\n<p>`RTCPeerConnection`を使ったどうのこうのはまた今度。</p><p>ReactNativeやるくらいならSwiftやるわーってずっと思ってたけど、ここまで用意されてるならSwiftで0から頑張るよりもいいかな・・って気持ちになりますね。<br />\n<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C8%A1%BC\">トー</a>タルで見るとまだまだSwiftやるわーって感じやけど。</p>\n\n</div>"
}
