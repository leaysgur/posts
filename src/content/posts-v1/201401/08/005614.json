{
  "title": "gitで違うbranchにpushしちゃった！の対応",
  "html": "<p>いやー、すみません！<br />\nミスってまったく関係ない違うブランチにプッシュしてしまった！やばい！という時の対応。</p><p>以下、事故ログ。</p>\n\n<ul>\n<li>作業中のbranchAでcommit1</li>\n<li>作業中のbranchAでcommit2</li>\n<li>作業中のbranchAでcommit3</li>\n<li>pushするためにfetch</li>\n<li>関係ない本流branchMに誤ってpush</li>\n</ul>\n<div class=\"section\">\n    <h3>はじめに</h3>\n    <p>以下に示すのは、今回たまたま通用した手順であって、どんな場合でもベストというわけではないと思います。<br />\n実はもっとナイスな回避手段があったのかもしれない。</p>\n\n</div>\n<div class=\"section\">\n    <h3>まずは現況復帰</h3>\n    \n<div class=\"section\">\n    <h4>とりいそぎbranchMへのpushを遮断する</h4>\n    <p>そんなコマンドないので、開発メンバーに連絡。<br />\nほんとすみません！</p>\n\n</div>\n<div class=\"section\">\n    <h4>手元の変更を退避</h4>\n    <p>今回の手段に選ばれたのは、</p>\n\n    <blockquote>\n        <p>誤ったpushで詰まれたコミットたちを、「なかったことにする」コミットを積む作戦。</p>\n\n    </blockquote>\n<p>そのために、手元の変更を一旦逃します。</p>\n<pre class=\"code\" data-unlink>git checkout -b temp\ngit checkout branchA</pre><p>ターゲット指定なしなので、今いるbranchAから。</p><p>そして事件現場へ戻る。</p>\n\n</div>\n<div class=\"section\">\n    <h4>なかったことにするコミット</h4>\n    <pre class=\"code\" data-unlink>git log</pre><p>なかったことにしたいコミットたちのハッシュを確認＆メモ。</p>\n<pre class=\"code\" data-unlink>git revert -n commit3のハッシュ\ngit revert -n commit2のハッシュ\ngit revert -n commit1のハッシュ</pre><p>「新しいコミットから」順にrevertする。</p>\n\n<ul>\n<li>nオプション(--no-commit)は、とりあえず差分が発生する状態に戻すだけ。</li>\n</ul><pre class=\"code\" data-unlink>git commit</pre><p>そしたらなかった状態をコミット。</p>\n<pre class=\"code\" data-unlink>git push origin branchM</pre><p>pushできたら本流は元通り！</p>\n\n</div>\n<div class=\"section\">\n    <h4>開発メンバーにもう一声</h4>\n    <p>お待たせしました！作業完了っす！</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>ここからが本来のお仕事</h3>\n    \n<div class=\"section\">\n    <h4>汚れたブランチを捨てる</h4>\n    <pre class=\"code\" data-unlink>git checkout branchM\ngit branch -d branchA\ngit checkout -b branchA</pre><p>いったん手元のbranchAを消して、新たに生み出します。</p>\n\n</div>\n<div class=\"section\">\n    <h4>退避させたコミットを反映させる</h4>\n    <p>さっき逃したコミットたちを、今生まれたbranchAに戻します。</p>\n<pre class=\"code\" data-unlink>git cherry-pick commit1のハッシュ\ngit cherry-pick commit2のハッシュ\ngit cherry-pick commit3のハッシュ</pre><p>今度は古い順。<br />\ncherry-pickでコミットしないようにするには、同じく-nオプションを使うらしいがどっちでもよさげ。</p>\n<pre class=\"code\" data-unlink>git push origin branchA</pre><p>これでbranchAも晴れて元通り！</p><p>いやー、よかったよかった・・。</p>\n\n</div>\n</div>"
}
