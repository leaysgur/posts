{
  "title": "ページ遷移なしでコンテンツを更新したいとき",
  "html": "<p>どう実装するのがベターなんやろうと思って。<br />\nまず最初に思いついたのが、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/jQuery\">jQuery</a> Mobileです。</p><p>というわけで、どういう実装になってるか調べたのでそのメモ。</p>\n\n<div class=\"section\">\n    <h3>コード</h3>\n    \n    <blockquote>\n        <p>参考：<a href=\"http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.js\" target=\"_blank\" title=\"code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.js\">code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.js</a></p>\n\n    </blockquote>\n<p>↑のリンクのコードの、4292行あたり。</p>\n<pre class=\"code lang-javascript\" data-lang=\"javascript\" data-unlink>$.ajax(<span class=\"synIdentifier\">{</span>\n  url: fileUrl,\n  type: settings.type,\n  data: settings.data,\n  contentType: settings.contentType,\n  dataType: <span class=\"synConstant\">&quot;html&quot;</span>,\n  success: <span class=\"synIdentifier\">function</span>( html, textStatus, xhr ) <span class=\"synIdentifier\">{</span>\n    <span class=\"synComment\">//pre-parse html to check for a data-url,</span>\n    <span class=\"synComment\">//use it as the new fileUrl, base path, etc</span>\n    <span class=\"synIdentifier\">var</span> all = $( <span class=\"synConstant\">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span> ),\n\n      <span class=\"synComment\">//page title regexp</span>\n      newPageTitle = html.match( <span class=\"synConstant\">/&lt;title[^&gt;]*&gt;([^&lt;]*)/ </span>) &amp;&amp; <span class=\"synType\">RegExp</span>.$1,\n\n      <span class=\"synComment\">// </span><span class=\"synTodo\">TODO</span><span class=\"synComment\"> handle dialogs again</span>\n      pageElemRegex = <span class=\"synStatement\">new</span> <span class=\"synType\">RegExp</span>( <span class=\"synConstant\">&quot;(&lt;[^&gt;]+</span><span class=\"synSpecial\">\\\\</span><span class=\"synConstant\">bdata-&quot;</span> + $.mobile.ns + <span class=\"synConstant\">&quot;role=[</span><span class=\"synSpecial\">\\&quot;</span><span class=\"synConstant\">']?page[</span><span class=\"synSpecial\">\\&quot;</span><span class=\"synConstant\">']?[^&gt;]*&gt;)&quot;</span> ),\n      dataUrlRegex = <span class=\"synStatement\">new</span> <span class=\"synType\">RegExp</span>( <span class=\"synConstant\">&quot;</span><span class=\"synSpecial\">\\\\</span><span class=\"synConstant\">bdata-&quot;</span> + $.mobile.ns + <span class=\"synConstant\">&quot;url=[</span><span class=\"synSpecial\">\\&quot;</span><span class=\"synConstant\">']?([^</span><span class=\"synSpecial\">\\&quot;</span><span class=\"synConstant\">'&gt;]*)[</span><span class=\"synSpecial\">\\&quot;</span><span class=\"synConstant\">']?&quot;</span> );\n\n\n    <span class=\"synComment\">// data-url must be provided for the base tag so resource requests can be directed to the</span>\n    <span class=\"synComment\">// correct url. loading into a temprorary element makes these requests immediately</span>\n    <span class=\"synStatement\">if</span> ( pageElemRegex.test( html ) &amp;&amp;\n        <span class=\"synType\">RegExp</span>.$1 &amp;&amp;\n        dataUrlRegex.test( <span class=\"synType\">RegExp</span>.$1 ) &amp;&amp;\n        <span class=\"synType\">RegExp</span>.$1 ) <span class=\"synIdentifier\">{</span>\n      url = fileUrl = path.getFilePath( $( <span class=\"synConstant\">&quot;&lt;div&gt;&quot;</span> + <span class=\"synType\">RegExp</span>.$1 + <span class=\"synConstant\">&quot;&lt;/div&gt;&quot;</span> ).text() );\n    <span class=\"synIdentifier\">}</span>\n    <span class=\"synComment\">//dont update the base tag if we are prefetching</span>\n    <span class=\"synStatement\">if</span> ( base &amp;&amp; ( <span class=\"synStatement\">typeof</span> options === <span class=\"synConstant\">&quot;undefined&quot;</span> || <span class=\"synStatement\">typeof</span> options.prefetch === <span class=\"synConstant\">&quot;undefined&quot;</span> )) <span class=\"synIdentifier\">{</span>\n      base.set( fileUrl );\n    <span class=\"synIdentifier\">}</span>\n\n    <span class=\"synComment\">//workaround to allow scripts to execute when included in page divs</span>\n    all.get( 0 ).innerHTML = html;\n    page = all.find( <span class=\"synConstant\">&quot;:jqmData(role='page'), :jqmData(role='dialog')&quot;</span> ).first();\n\n    <span class=\"synComment\">//if page elem couldn't be found, create one and insert the body element's contents</span>\n    <span class=\"synStatement\">if</span> ( !page.length ) <span class=\"synIdentifier\">{</span>\n      page = $( <span class=\"synConstant\">&quot;&lt;div data-&quot;</span> + $.mobile.ns + <span class=\"synConstant\">&quot;role='page'&gt;&quot;</span> + ( html.split( /&lt;<span class=\"synIdentifier\">\\</span>/?body<span class=\"synIdentifier\">[</span>^&gt;<span class=\"synIdentifier\">]</span>*&gt;/gmi )<span class=\"synIdentifier\">[</span>1<span class=\"synIdentifier\">]</span> || <span class=\"synConstant\">&quot;&quot;</span> ) + <span class=\"synConstant\">&quot;&lt;/div&gt;&quot;</span> );\n    <span class=\"synIdentifier\">}</span>\n\n    <span class=\"synStatement\">if</span> ( newPageTitle &amp;&amp; !page.jqmData( <span class=\"synConstant\">&quot;title&quot;</span> ) ) <span class=\"synIdentifier\">{</span>\n      <span class=\"synStatement\">if</span> ( ~newPageTitle.indexOf( <span class=\"synConstant\">&quot;&amp;&quot;</span> ) ) <span class=\"synIdentifier\">{</span>\n        newPageTitle = $( <span class=\"synConstant\">&quot;&lt;div&gt;&quot;</span> + newPageTitle + <span class=\"synConstant\">&quot;&lt;/div&gt;&quot;</span> ).text();\n      <span class=\"synIdentifier\">}</span>\n      page.jqmData( <span class=\"synConstant\">&quot;title&quot;</span>, newPageTitle );\n    <span class=\"synIdentifier\">}</span>\n\n    <span class=\"synComment\">//rewrite src and href attrs to use a base url</span>\n    <span class=\"synStatement\">if</span> ( !$.support.dynamicBaseTag ) <span class=\"synIdentifier\">{</span>\n      <span class=\"synIdentifier\">var</span> newPath = path.get( fileUrl );\n      page.find( <span class=\"synConstant\">&quot;[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]&quot;</span> ).each(<span class=\"synIdentifier\">function</span>() <span class=\"synIdentifier\">{</span>\n        <span class=\"synIdentifier\">var</span> thisAttr = $( <span class=\"synIdentifier\">this</span> ).is( <span class=\"synConstant\">'[href]'</span> ) ? <span class=\"synConstant\">'href'</span> "
}
