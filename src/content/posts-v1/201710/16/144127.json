{
  "title": "iOS SafariのカメラストリームをChromeにWebRTCで送ってMediaRecorderでWebMにするとおかしな動画が撮れる",
  "html": "<p>またもニッチなケースを踏みましたというメモです。<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>経緯</h3>\n    <p>弊社の開発合宿で作ろうとしてたものが（正確にはいまも合宿中なのでing）あります。</p>\n\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>で`getUserMedia()`</li>\n<li>WebRTCで飛ばす</li>\n<li>PCの<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>で受け取る</li>\n<li>MediaRecorderで`.webm`に</li>\n</ul><p>ざっくりこんな感じ。<br />\n本当にやりたかった要件はまだ続きがあるけど、とりあえず問題に必要な手順がコレ。</p>\n\n</div>\n<div class=\"section\">\n    <h3>おかしな動画</h3>\n    <p><blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"ja\" dir=\"ltr\">こういう風になる<a href=\"https://t.co/j2LQe3PBA3\">https://t.co/j2LQe3PBA3</a> <a href=\"https://t.co/OqzaYOr3CX\">pic.twitter.com/OqzaYOr3CX</a></p>&mdash; りぃ (@leader22) <a href=\"https://twitter.com/leader22/status/919794669373894656?ref_src=twsrc%5Etfw\">October 16, 2017</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script> </p><p>こんなん。</p><p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>から飛んでくるストリームは縦長なのに、そのままの縦長ではなくこのようにアス比1の領域を繰り返すように録画される・・。</p>\n\n</div>\n<div class=\"section\">\n    <h3>原因は・・？</h3>\n    \n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>で見えるもの: 問題なし</li>\n<li>WebRTC経由で<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>に届いたもの: 問題なし</li>\n<li>MediaRecorderで生成したもの: おかしい</li>\n</ul><p>という感じで、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>のMediaRecorderのバグなんだろうか・・？</p><p>ちなみに<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>のローカルでストリームを縦長にして、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iOS\">iOS</a> <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Safari\">Safari</a>と同じアス比を再現してみても問題なかった。<br />\n<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>でリモートストリームを縦長にして再現してみても問題なかった。<br />\n<br />\n</p>\n\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>のMediaRecorderがバグってる</h3>\n    <p>自信はないけど、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>のバグだと思う。<br />\nというのも、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>のMediaRecorderであれば問題なく録画できたから。</p><p><blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"ja\" dir=\"ltr\"><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>・・おまえ・・・ <a href=\"https://t.co/D1qAyZCo1w\">pic.twitter.com/D1qAyZCo1w</a></p>&mdash; りぃ (@leader22) <a href=\"https://twitter.com/leader22/status/919803162487242752?ref_src=twsrc%5Etfw\">October 16, 2017</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script> </p><p>`.getSettings()`なんかアテにしてないとはいえ、明らかにおかしい<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\">Chrome</a>・・。</p><p>MediaRecorderやるなら<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Firefox\">Firefox</a>使おう！</p>\n\n</div>"
}
