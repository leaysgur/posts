{
  "title": "さくらVPS借りて最初にやったメモ",
  "html": "<p>さくらVPSを借りて、何をしたかの備忘録メモです。</p><p>今まで512のプランを借りてたのですが、こないだ規約変更があって、同じ値段でメモリ1GBになりました。<br />\nクラウドが難航しているみたいですが、太っ腹ですね！<br />\nぜひみなさんもどうぞ。</p>\n\n    <blockquote>\n        <p>参考：<a href=\"http://vps.sakura.ad.jp/news/sakurainfo/newsentry.php?id=620\">「さくらのVPS」リニューアルのお知らせ</a></p>\n\n    </blockquote>\n<p>さて。</p>\n\n    <blockquote>\n        <p>まとまった時間がないと作業ができないと思ってるあなた！<br />\n心配しなくとも、だいたい30分くらいあれば一息つけます。<br />\n最初のゴールは、「<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>で、その端末からのみ接続できるサーバーにする。」です。</p>\n\n    </blockquote>\n\n<div class=\"seemore\">\n    \n<div class=\"section\">\n    <h3>パスワードじゃなくて、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>で接続するようにする。</h3>\n    \n<div class=\"section\">\n    <h4>何よりもまず、作業ユーザーを作成</h4>\n    \n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>adduser\npsswd</pre>\n<p>rootでもできるけど、基本的には使わない。<br />\nWindowsのAdministratorとは比較にならないほど重要。</p>\n\n</div>\n<div class=\"section\">\n    <h4><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>でつなぐポート番号を変えておく。</h4>\n    <p>/etc/<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>/sshd_configを編集。<br />\n今はポート番号だけ変える。<br />\n後でいろいろ変えます。<br />\n<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>_configっていう紛らわしいのがいるので注意。<br />\n編集するのは、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>[d]_configです。</p><p>修正しただけじゃ反映されないので、反映するために<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>担当を再起動。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>/etc/init.d/sshd restart</pre>\n\n</div>\n<div class=\"section\">\n    <h4>ssh用の公開鍵を作る。</h4>\n    <p>Mac側で作業。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>ssh-keygen\ncd $h / cd ~\ncd .ssh</pre>\n<p>id_rsa<br />\nid_rsa.pub</p><p>この.pubってついてるのが公開鍵なので、サーバー側に置く。<br />\nサーバー側も同じ場所。</p>\n\n</div>\n<div class=\"section\">\n    <h4>サーバーに送る</h4>\n    <p>送る場所を先に作る。<br />\nサーバー側で。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>cd ~\nmkdir .ssh</pre>\n<p>引き続きMacで。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>scp -P **** ~/.ssh/id_rsa.pub hoge@example.com:~/.ssh/authorized_keys</pre>\n<p>[****]は、さっき変更したポート<br />\nauthorized_keysという名前はお約束。<br />\n中を覗くとわかるように、ここに載ってる鍵を持ってる端末の接続を許可します。<br />\n複数台から接続する場合は、このファイルに追記していく感じ。</p>\n\n    <blockquote>\n        <p>参考：<a href=\"http://lealog.hateblo.jp/entry/2012/02/19/235700\">複数のパソコンから、単一のサーバーにssh接続する</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h4>このファイルに権限を設定</h4>\n    <p>サーバー側で。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>chmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys</pre>\n\n</div>\n<div class=\"section\">\n    <h4>ログイン周りの設定をまとめて変更</h4>\n    <p>さっきのsshd_configを修正します。<br />\nrootのログイン拒否、パスワード拒否、空っぽ拒否などなど。</p><p>修正しただけじゃ反映されないので、反映するために<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ssh\">ssh</a>担当を再起動。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>/etc/init.d/sshd restart</pre>\n<p>これでsshでのみ接続可、この端末のみ接続可になったはず。<br />\nひとまず安心なので休憩！</p>\n\n</div>\n<div class=\"section\">\n    <h4>システムを更新しておく</h4>\n    \n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>yum update</pre>\n<p>Windows Updateみたいなやつ。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>とりあえず再起動</h3>\n    \n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>reboot</pre>\n\n    <blockquote>\n        <p>ここまでやれば一安心ですが、以下も同日にやっておくとさらに安心とのこと。</p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>sudoとパス</h3>\n    \n    <blockquote>\n        <p>参考：<a href=\"http://akabeko.sakura.ne.jp/blog/2010/09/%E3%81%95%E3%81%8F%E3%82%89%E3%81%AEvps-%E3%82%92%E4%BD%BF%E3%81%84%E3%81%AF%E3%81%98%E3%82%81%E3%82%8B-2/\" target=\"_blank\" title=\"さくらのVPS を使いはじめる 2 – sudo と SSH ポート変更 | アカベコマイリ\">さくらのVPS を使いはじめる 2 – sudo と SSH ポート変更 | アカベコマイリ</a></p>\n\n    </blockquote>\n\n</div>\n<div class=\"section\">\n    <h3>ファイアウォールの設定</h3>\n    <p><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/iptables\">iptables</a>なる仕組みを利用します。</p>\n\n<div class=\"section\">\n    <h4>インストールされてないならインストール</h4>\n    \n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>yum install iptables</pre>\n\n</div>\n<div class=\"section\">\n    <h4>設定ファイルを編集</h4>\n    \n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>vi /etc/sysconfig/iptables</pre>\n<p>こいつも修正しただけじゃ反映されないので、反映するために担当を再起動。</p>\n\n    <pre class=\"code lang-linux\" data-lang=\"linux\" data-unlink>/etc/rc.d/init.d/iptables restart</pre>\n\n    <blockquote>\n        <p>参考：<a href=\"http://akabeko.sakura.ne.jp/blog/2010/09/%e3%81%95%e3%81%8f%e3%82%89%e3%81%aevps-%e3%82%92%e4%bd%bf%e3%81%84%e3%81%af%e3%81%98%e3%82%81%e3%82%8b-3/\" target=\"_blank\" title=\"さくらのVPS を使いはじめる 3 – iptables を設定する | アカベコマイリ\">さくらのVPS を使いはじめる 3 – iptables を設定する | アカベコマイリ</a></p>\n\n    </blockquote>\n<p>ここの通りにやろうとしても、私の場合は設定ファイルがありませんでした・・。</p><p>でも、なかったら作っちゃってOK。<br />\n指定の名前で同じ場所に保存すれば、ちゃんと動きます。</p>\n\n</div>\n</div>\n<div class=\"section\">\n    <h3>あとは</h3>\n    <p>あちこち検索してみて、やっときなさい系エントリにあるとすれば・・。</p>\n\n<ul>\n<li>不要なサービスを止める</li>\n<li>監視の仕組みをいれる</li>\n</ul><p>くらいでしょうか。</p>\n\n</div>\n</div>"
}
