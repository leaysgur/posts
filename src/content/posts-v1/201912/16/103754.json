{
  "title": "WebAudioでの音声信号処理 〜入門以前〜",
  "html": "<p>今までずっと雰囲気でやってました。</p><p>`ScriptProcessor`や`AudioWorkletProcessor`をさわったことはあっても、そこで成されている処理自体を具体的に考えたことはなかった。</p><p>波形がどうとか、周波数がどうとか、PCMがどうとか、サンプリングレートがどうとか、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D5%A1%BC%A5%EA%A5%A8%CA%D1%B4%B9\">フーリエ変換</a>がどうとか、なんとなーくそれぞれの用語はわかってるつもりではいたが、線の理解にはなってなかった。</p><p>それをあらためて学び直したのがこの記事です。（間違ってたら教えてください）<br />\n<br />\n</p>\n\n<div class=\"section\">\n    <h3>音のデジタル化</h3>\n    \n<ul>\n<li>音は空気の振動である\n<ul>\n<li>糸電話的なイメージ</li>\n<li>これはもちろんアナログ</li>\n</ul></li>\n<li>あの振動をデジタル化することで、プログラミングで音声処理できるようにする\n<ul>\n<li>このデジタル化をPCM(Pulse Code Modulation)という</li>\n<li>PCMはデジタル化の方式のなかの1つで、他にもやり方はあるらしい</li>\n</ul></li>\n<li>WebAudioで扱える音声の生データもこのPCMデータ\n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%EA%A5%CB%A5%A2PCM\">リニアPCM</a>というやつらしい</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3>PCMデータ</h3>\n    \n<ul>\n<li>デジタル化して得られた生データ\n<ul>\n<li>言わずもがなビット列</li>\n<li>端的には時系列に並ぶ音量の配列</li>\n<li>プロットすると、いわゆる波形になる</li>\n</ul></li>\n<li>いつでもアナログにも戻せるし加工もできる\n<ul>\n<li>無限のリソースでデジタル化できればいいけど、そうもいかない</li>\n</ul></li>\n<li>元の音声にどれだけ近づけられるかのパラメータとしては2つある\n<ul>\n<li>サンプリングレート</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CE%CC%BB%D2%B2%BD\">量子化</a>ビット数</li>\n</ul></li>\n<li>プロットするとき、X/Y軸がより細かいほうが、よりなめらかに波形を再現できる\n<ul>\n<li>サンプリングレートは横軸の細かさ</li>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CE%CC%BB%D2%B2%BD\">量子化</a>ビット数は縦軸の細かさ</li>\n</ul></li>\n<li>どれくらいの頻度で、どれくらいの詳細度でサンプリングするかという話</li>\n<li>得られたPCMデータの配列の1つが、1つのオーディオサンプルとなる</li>\n</ul>\n<div class=\"section\">\n    <h4>サンプリングレート</h4>\n    \n<ul>\n<li>標本化の回数</li>\n<li>単位はHz</li>\n<li>8000Hzならば、1秒に8000回サンプリングするということ\n<ul>\n<li>サンプリングレートが大きいほど、より忠実に原音を再現できる</li>\n</ul></li>\n<li>ただし高すぎても実用的ではない\n<ul>\n<li>聴くのが人間なら、聞こえない音を保存する必要がないから</li>\n<li>なのでCDとかは44.1kHzに決まってる</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h4><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CE%CC%BB%D2%B2%BD\">量子化</a>ビット数</h4>\n    \n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CE%CC%BB%D2%B2%BD\">量子化</a>の程度\n<ul>\n<li>1サンプルの精度</li>\n</ul></li>\n<li>各音量の値をどれだけ細かく表現できるか</li>\n<li>これも精度が高いほうが、より忠実に再現できる\n<ul>\n<li>16bitなら65536段階の細かさ</li>\n<li>WebAudioだと32bitで、値は実数になってる</li>\n</ul></li>\n<li>この振れ幅のことをダイナミックレンジという</li>\n</ul>\n</div>\n</div>\n<div class=\"section\">\n    <h3>波形とPCMデータ</h3>\n    \n<ul>\n<li>PCMデータをプロットしていくと波形のグラフができた\n<ul>\n<li>Xは時間、Yは音量</li>\n</ul></li>\n<li>波形はその形で音の性質が変わる\n<ul>\n<li>間隔の狭く高い波 = 高周波 = 高い音</li>\n<li>間隔の広く低い波 = <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C4%E3%BC%FE%C7%C8\">低周波</a> = 低い音</li>\n</ul></li>\n<li>サンプリングレートが充分にある場合\n<ul>\n<li>どんな間隔の狭さでも、余すこと無く再現できる</li>\n<li>つまり<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C4%E3%BC%FE%C7%C8\">低周波</a>から高周波まできっちり取れる</li>\n</ul></li>\n<li>逆にレートが低い場合\n<ul>\n<li>低い頻度では間隔の狭い波を取りこぼすことになる</li>\n<li>なので<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C4%E3%BC%FE%C7%C8\">低周波</a>しかうまくデジタル化できない</li>\n<li>波の動きが細かくなる高周波が削られるから</li>\n</ul></li>\n<li>つまりサンプリングレートが低いと、高音域が取れない</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3>PCMと周波数成分</h3>\n    \n<ul>\n<li>PCMの波形は、あらゆる高さの周波数があわさった最終形\n<ul>\n<li>あらゆる音の合算値である</li>\n</ul></li>\n<li>そしてPCMデータには音量の情報しかない\n<ul>\n<li>定数的に計算して返すと音量が変わる</li>\n<li>定数的な計算であれば、波形のフォルムに変化はない（= 音質は変わらない）から</li>\n</ul></li>\n<li>音質、つまりは周波数成分を変えるにはどうするのか\n<ul>\n<li>音質を変えるためには、一律ではないダイナミックな処理で、波形の形状を変化させる必要がある</li>\n</ul></li>\n<li>たとえばローパスフィルター（高周波数帯をカットして、<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C4%E3%BC%FE%C7%C8\">低周波</a>のみ残す）\n<ul>\n<li>この場合、高周波の特徴である狭く高い波を、なだらかにできればよいということ</li>\n<li>そのために、直前の値と<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B0%DC%C6%B0%CA%BF%B6%D1\">移動平均</a>を取るなどすればよい</li>\n</ul></li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D5%A1%BC%A5%EA%A5%A8%CA%D1%B4%B9\">フーリエ変換</a></h3>\n    \n<ul>\n<li><a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D5%A1%BC%A5%EA%A5%A8%CA%D1%B4%B9\">フーリエ変換</a>という処理を介すことで、PCMデータから周波数成分を抜き出せる\n<ul>\n<li>逆<a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D5%A1%BC%A5%EA%A5%A8%CA%D1%B4%B9\">フーリエ変換</a>で戻すこともできる</li>\n</ul></li>\n<li>なので周波数成分に変換してから処理をすることでも、音質は変えられる\n<ul>\n<li>ただし変換コストがかかる</li>\n</ul></li>\n<li>波形が表すのは、そのサンプルにおいてのあらゆる周波数の合算値なので\n<ul>\n<li>そもそも8000Hzでサンプリングした音</li>\n<li>より高いレートでサンプリングしてから、8000Hz以上の周波数成分を削った音</li>\n</ul></li>\n<li>この2つは微妙に違うはず（後者で巻き添えになって削られる8000Hz以下の音があるかも）</li>\n</ul>\n</div>\n<div class=\"section\">\n    <h3>というわけで</h3>\n    <p>次はWebAudio <a class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\">API</a>を使って音声処理を実際にやってくところについて書きます。</p>\n\n</div>"
}
